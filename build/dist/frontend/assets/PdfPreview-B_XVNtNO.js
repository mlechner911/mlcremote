import{_ as v,a as P}from"./index-BuDqA3bG.js";import{R as n,j as a}from"./vendor-react-DS53xkUv.js";import"./vendor-prism-DR-dfdyj.js";import"./vendor-html2canvas-k0ITeQhV.js";import"./vendor-scheduler-CWG1rEj-.js";function _({path:l}){const[d,x]=n.useState(null),[s,p]=n.useState(null),[r,f]=n.useState(1),[o,g]=n.useState(null),[w,h]=n.useState(!1),m=n.useRef(null);return n.useEffect(()=>{let e=!0;return(async()=>{try{const t=await v(()=>import("./vendor-pdfjs-dist-2-CDpXphMs.js"),[]);if(t.GlobalWorkerOptions.workerSrc="/pdf.worker.mjs",!e)return;x(t)}catch(t){console.error("Failed to load pdfjs",t)}})(),()=>{e=!1}},[]),n.useEffect(()=>{if(!d)return;let e=!1;return(async()=>{h(!0);try{const t=await P(`/api/file?path=${encodeURIComponent(l)}`);if(!t.ok)throw new Error("fetch failed");const i=await t.arrayBuffer(),u=await d.getDocument({data:i}).promise;if(e)return;p(u),g(u.numPages||null),f(1)}catch(t){console.error("Failed to load PDF",t),e||p(null)}finally{e||h(!1)}})(),()=>{e=!0}},[d,l]),n.useEffect(()=>{if(!s||!m.current)return;let e=!0;return(async()=>{try{const t=await s.getPage(r),i=t.getViewport({scale:1.25}),c=m.current,u=c.getContext("2d");c.width=Math.min(i.width,window.innerWidth*.9),c.height=i.height;const j={canvasContext:u,viewport:i};await t.render(j).promise}catch(t){e&&console.error("PDF render failed",t)}})(),()=>{e=!1}},[s,r]),d?w&&!s?a.jsx("div",{className:"muted",children:"Loading PDF…"}):a.jsxs("div",{style:{padding:12},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("button",{className:"btn",onClick:()=>f(e=>Math.max(1,e-1)),disabled:r<=1,children:"Prev"}),a.jsxs("span",{children:[r,o?` / ${o}`:""]}),a.jsx("button",{className:"btn",onClick:()=>f(e=>Math.min(o||1/0,e+1)),disabled:o?r>=o:!1,children:"Next"}),a.jsx("a",{className:"link",href:`/api/file?path=${encodeURIComponent(l)}`,download:l.split("/").pop(),children:"Download"})]}),a.jsx("div",{style:{marginTop:8},children:s?a.jsx("canvas",{ref:m,style:{maxWidth:"100%",borderRadius:6,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}):a.jsx("div",{className:"muted",children:"No preview"})})]}):a.jsx("div",{className:"muted",children:"Loading PDF support…"})}export{_ as default};
