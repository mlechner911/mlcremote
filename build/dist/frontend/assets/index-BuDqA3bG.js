const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PdfPreview-B_XVNtNO.js","assets/vendor-react-DS53xkUv.js","assets/vendor-scheduler-CWG1rEj-.js","assets/vendor-prism-DR-dfdyj.js","assets/vendor-prism-Cg1sXqY3.css","assets/vendor-html2canvas-k0ITeQhV.js","assets/ShellView-Bdk8KEPj.js","assets/TerminalTab-C7K2ji48.js","assets/vendor-xterm-BXin3HzJ.js","assets/vendor-xterm-DFuMZ0ql.css"])))=>i.map(i=>d[i]);
import{j as e,R as r,r as Oe,c as rt}from"./vendor-react-DS53xkUv.js";import{P as Ee}from"./vendor-prism-DR-dfdyj.js";import{h as it}from"./vendor-html2canvas-k0ITeQhV.js";import"./vendor-scheduler-CWG1rEj-.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const a of d.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(l){if(l.ep)return;l.ep=!0;const d=i(l);fetch(l.href,d)}})();const at="modulepreload",ot=function(t){return"/"+t},ze={},ge=function(s,i,o){let l=Promise.resolve();if(i&&i.length>0){let p=function(w){return Promise.all(w.map(L=>Promise.resolve(L).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");l=p(i.map(w=>{if(w=ot(w),w in ze)return;ze[w]=!0;const L=w.endsWith(".css"),b=L?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${b}`))return;const T=document.createElement("link");if(T.rel=L?"stylesheet":at,L||(T.as="script"),T.crossOrigin="",T.href=w,u&&T.setAttribute("nonce",u),document.head.appendChild(T),L)return new Promise((j,x)=>{T.addEventListener("load",j),T.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${w}`)))})}))}function d(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return l.then(a=>{for(const u of a||[])u.status==="rejected"&&d(u.reason);return s().catch(d)})},lt=200,me=[],fe=[];function He(t,s){const i={ts:new Date().toISOString(),level:t,msg:s};for(me.push(i);me.length>lt;)me.shift();fe.forEach(o=>o())}function B(t){He("info",t)}function xe(t){He("warn",t)}function ct(){return me.slice().reverse()}function dt(t){return fe.push(t),()=>{const s=fe.indexOf(t);s>=0&&fe.splice(s,1)}}function ut(){me.length=0,fe.forEach(t=>t())}function Le(){try{return localStorage.getItem("mlcremote_token")}catch{return null}}function Ae(t){try{localStorage.setItem("mlcremote_token",t)}catch{}}async function re(t,s){const i=Le(),o=new Headers(s?.headers);i&&o.set("X-Auth-Token",i);const l={...s||{},headers:o},d=await fetch(t,l);if(d.status===401){try{localStorage.removeItem("mlcremote_token")}catch{}try{window.dispatchEvent(new CustomEvent("mlcremote:auth-failed",{detail:{url:typeof t=="string"?t:t.url}}))}catch{}}return d}async function ht(t){B("POST /api/login");const s=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})});if(B(`/api/login => ${s.status}`),!s.ok)throw new Error("login failed");const i=await s.json();if(i&&i.token)return Ae(i.token),i.token;throw new Error("no token in response")}async function Ne(){B("GET /health");const t=await re("/health");if(B(`/health => ${t.status}`),!t.ok)throw xe("/health not ok"),new Error("health failed");return t.json()}function mt(){try{const s=new URLSearchParams(window.location.search).get("token");if(s)return Ae(s),!0}catch{}return!1}async function Pe(){try{return(await re("/api/auth/check")).status===200}catch{return!1}}async function Be(t="",s){const i=new URLSearchParams;t&&i.set("path",t),s?.showHidden&&i.set("showHidden","1");const o=i.toString()?`?${i.toString()}`:"";B(`GET /api/tree${o}`);const l=await re(`/api/tree${o}`);if(B(`/api/tree${o} => ${l.status}`),!l.ok)throw xe("/api/tree not ok"),new Error("tree failed");return l.json()}async function Me(t){B(`GET /api/file?path=${t}`);const s=await re(`/api/file?path=${encodeURIComponent(t)}`);if(B(`/api/file?path=${t} => ${s.status}`),!s.ok)throw xe("/api/file read failed"),new Error("read failed");return s.text()}async function ae(t){B(`GET /api/stat?path=${t}`);const s=await re(`/api/stat?path=${encodeURIComponent(t)}`);if(B(`/api/stat?path=${t} => ${s.status}`),!s.ok)throw new Error("stat failed");return s.json()}async function ft(t,s){B(`POST /api/file path=${t} size=${s.length}`);const i=await re("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,content:s})});if(B(`/api/file POST => ${i.status}`),!i.ok)throw xe("/api/file save failed"),new Error("save failed")}async function pt(t){B(`DELETE /api/file?path=${t}`);const s=await re(`/api/file?path=${encodeURIComponent(t)}`,{method:"DELETE"});if(B(`/api/file delete => ${s.status}`),!s.ok)throw xe("/api/file delete failed"),new Error("delete failed")}const O=({name:t,className:s,title:i,size:o=16})=>{if(!t)return null;const l=`#${t}`;return e.jsxs("svg",{className:s,width:o,height:o,"aria-hidden":i?void 0:"true",role:i?"img":void 0,children:[i?e.jsx("title",{children:i}):null,e.jsx("use",{href:l})]})},gt={js:"icon-js",json:"icon-json",home:"icon-home",log:"icon-log",svg:"icon-image",upload:"icon-upload",shell:"icon-terminal",md:"icon-markdown",jpeg:"icon-image",cfg:"icon-settings",zip:"icon-archive",gz:"icon-archive",mjs:"icon-js",settings:"icon-settings",run:"icon-play",minus:"icon-minus",x:"icon-close",info:"icon-info",tar:"icon-archive",pdf:"icon-pdf",jpg:"icon-image",search:"icon-search",cl:"icon-chevron-left",sun:"icon-sun",close:"icon-close",warn:"icon-warning",sh:"icon-terminal",stop:"icon-stop",cr:"icon-chevron-right",plus:"icon-plus",screenshot:"icon-screenshot",trash:"icon-trash",png:"icon-image",up:"icon-up",user:"icon-user",server:"icon-server",markdown:"icon-markdown",bz2:"icon-archive",download:"icon-download",refresh:"icon-refresh",view:"icon-view",moon:"icon-moon",dir:"icon-folder",gif:"icon-image",txt:"icon-text"};function ce(t){if(t)return gt[t.toLowerCase()]}function We(t,s){if(s){const i=s.lastIndexOf(".");if(i>=0&&i<s.length-1){const o=s.slice(i+1).toLowerCase();return ce(o)}}}function pe(t){return ce(t)||"icon-text"}function xt(){return pe("dir")}function yt(){return pe("shell")}function H(t){switch(t){case"folder":return xt();case"terminal":return yt();case"close":return"icon-close";case"settings":return pe("cfg");case"screenshot":return"icon-screenshot";case"info":return"icon-info";case"moon":return pe("moon");case"sun":return pe("sun");case"download":return"icon-download";case"view":return"icon-view";default:return"icon-text"}}function jt({onSelect:t,showHidden:s,onToggleHidden:i,autoOpen:o=!0,onView:l,onBackendActive:d,onChangeRoot:a,canChangeRoot:u,selectedPath:p,activeDir:w,onDirChange:L,focusRequest:b,reloadSignal:T}){const[j,x]=r.useState(""),[z,ie]=r.useState([]),[P,y]=r.useState(!1),[Z,U]=r.useState(""),[ee,Q]=r.useState(null),[G,K]=r.useState(!1),m=r.useCallback(async h=>{y(!0),U("");try{const N=await Be(h,{showHidden:s});ie(N),x(h);try{I.current!==h&&(L?.(h),I.current=h)}catch{}d?.();try{const D=te.current;D&&requestAnimationFrame(()=>{const R=Y.current;if(R)try{const W=R.querySelector(`[data-path="${CSS.escape(D)}"]`);W&&(W.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),W.focus())}catch{}})}catch{}}catch(N){U(N.message||"failed to list")}finally{y(!1)}},[s,d,L]),I=r.useRef("");r.useEffect(()=>{typeof w>"u"||w!==j&&m(w)},[w,j,m]),r.useEffect(()=>{m("")},[m]),r.useEffect(()=>{m(j||"")},[j,m,T]);const C=()=>{if(!j||j==="/"){m("");return}const h=j.split("/").filter(Boolean);h.pop();const N=`/${h.join("/")}`;m(N||"")},E=async(h,N)=>{if(!(!N||N.length===0)){K(!0),U("");try{const D=new FormData;for(let q=0;q<N.length;q++)D.append("file",N[q],N[q].name);const R=`?path=${encodeURIComponent(h)}`;if(!(await fetch(`/api/upload${R}`,{method:"POST",body:D})).ok)throw new Error("upload failed");await m(h)}catch(D){U(D.message||"upload failed")}finally{K(!1)}}},k=(h,N)=>{h.preventDefault(),Q(null),E(N,h.dataTransfer.files)},M=(h,N)=>{h.preventDefault(),Q(N)},X=h=>{h.preventDefault(),Q(null)},Y=r.useRef(null),te=r.useRef("");return r.useEffect(()=>{te.current=p||""},[p]),r.useEffect(()=>{if(p)try{const h=Y.current;if(!h)return;const N=h.querySelector(`li[key="${CSS.escape(p)}"]`),D=h.querySelector(`[data-path="${p}"]`),R=N||D;if(R){R.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"});const W=R.querySelector("button.entry");W&&W.focus()}}catch{}},[p,j]),r.useEffect(()=>{if(b)try{const h=p||"";if(!h)return;const N=Y.current;if(!N)return;const D=CSS.escape(h),R=N.querySelector(`[data-path="${D}"]`);R&&(R.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),R.focus())}catch{}},[b]),e.jsxs("div",{className:"explorer",children:[e.jsxs("div",{className:"explorer-header",children:[e.jsx("strong",{className:"hidden",children:e.jsx(O,{name:H("dir")})}),e.jsx("div",{className:"explorer-controls",children:u&&typeof a=="function"&&e.jsx("button",{className:"link icon-btn","aria-label":"Change root",title:"Change root",onClick:async()=>{try{const h=await Promise.resolve(a(""))}catch{}},children:e.jsx(O,{name:H("dir")})})}),e.jsxs("div",{className:"breadcrumbs",children:[e.jsx("button",{type:"button",className:"link",onClick:()=>m(""),children:"root"}),j&&j.split("/").filter(Boolean).map((h,N,D)=>{const R=`/${D.slice(0,N+1).join("/")}`;return e.jsxs("span",{children:[" / ",e.jsx("button",{className:"link",onClick:()=>m(R),children:h})]},R)})]})]}),e.jsxs("div",{className:"explorer-body",onDrop:h=>k(h,j||""),onDragOver:h=>M(h,j||""),onDragLeave:X,children:[P&&e.jsx("div",{className:"muted",children:"Loading..."}),Z&&e.jsx("div",{className:"error",children:Z}),G&&e.jsx("div",{className:"muted",children:"Uploading..."}),!P&&!Z&&e.jsxs("ul",{className:"entry-list",ref:Y,children:[j&&j!=="/"&&e.jsx("li",{children:e.jsx("button",{type:"button",className:"entry",onClick:C,children:".."})},"up"),z.map(h=>e.jsx("li",{children:h.isDir?e.jsxs("button",{"data-path":h.path,type:"button",className:"entry"+(p===h.path?" selected":""),onClick:()=>{m(h.path),t(h.path,!0)},onDrop:N=>k(N,h.path),onDragOver:N=>M(N,h.path),onDragLeave:X,children:[e.jsx("span",{className:"icon",children:e.jsx(O,{name:ce("dir")||H("dir")})})," ",h.name,ee===h.path?e.jsx("span",{style:{marginLeft:8,fontSize:12,color:"#888"},children:"Drop to upload"}):null]}):e.jsxs("div",{style:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs("button",{"data-path":h.path,type:"button",className:"entry",style:{flex:1,textAlign:"left"},onClick:()=>{if(o===!1){t(h.path,!1);return}t(h.path,!1)},children:[e.jsx("span",{className:"icon",children:e.jsx(O,{name:We(void 0,h.name)||ce(h.name.split(".").pop()||"")||H("view")||"icon-text"})})," ",h.name]}),o?null:e.jsx("button",{className:"btn",onClick:()=>l?l(h.path):t(h.path,!1),title:"View file",children:e.jsx(O,{name:H("view")})}),e.jsx("a",{className:"btn",href:`/api/file?path=${encodeURIComponent(h.path)}`,download:h.name,style:{whiteSpace:"nowrap"},title:"Download","aria-label":`Download ${h.name}`,children:e.jsx(O,{name:H("download")})})]})},h.path))]})]})]})}function vt({autoOpen:t,showHidden:s,onToggleAutoOpen:i,onToggleShowHidden:o,showLogs:l,onToggleLogs:d,hideServerName:a,onToggleHideServerName:u,hideMemoryUsage:p,onToggleHideMemoryUsage:w,onClose:L}){const[b,T]=Oe.useState(a),[j,x]=Oe.useState(p);return e.jsx("div",{style:{position:"absolute",right:12,top:40,zIndex:60},children:e.jsxs("div",{style:{width:320,background:"var(--bg)",border:"1px solid var(--muted)",borderRadius:6,boxShadow:"0 6px 20px rgba(0,0,0,0.12)",padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Settings"}),e.jsx("button",{"aria-label":"Close settings",title:"Close",onClick:L,style:{background:"transparent",border:"none",cursor:"pointer"},children:e.jsx(O,{name:H("close"),title:"Close",size:16})})]}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:t,onChange:z=>i(z.target.checked)})," ","Auto open files"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:s,onChange:z=>o(z.target.checked)})," ","Show hidden files"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:l,onChange:z=>d(z.target.checked)})," Show server logs"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:z=>{T(z.target.checked),u(z.target.checked)}})," Hide server name in header"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:j,onChange:z=>{x(z.target.checked),w(z.target.checked)}})," Hide memory usage gauge"]})})]})})}function wt(){const[t,s]=r.useState(null),[i,o]=r.useState(!1),l=r.useCallback(async()=>{o(!0);try{const u=await re("/api/trash/recent");if(!u.ok)throw new Error("fetch failed");const p=await u.json();Array.isArray(p)&&p.length>0?s(p[0]):s(null)}catch(u){console.warn("Failed to fetch trash",u)}finally{o(!1)}},[]);if(r.useEffect(()=>{l();const u=setInterval(l,1e4);return()=>clearInterval(u)},[l]),i&&!t)return e.jsx("div",{className:"muted",children:"Loading trash…"});if(!t)return e.jsx("div",{className:"muted",children:"Trash is empty"});const d=t.originalPath.split("/").pop()||t.originalPath,a=We(void 0,d)||ce(d.split(".").pop()||"")||"icon-trash";return e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx(O,{name:a,size:20}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{fontWeight:600},children:d}),e.jsx("div",{className:"muted",style:{fontSize:12},children:new Date(t.deletedAt).toLocaleString()})]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsxs("div",{className:"muted",children:["Original path: ",t.originalPath]}),e.jsxs("div",{className:"muted",children:["Trash path: ",t.trashPath]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("button",{className:"btn",disabled:!0,children:"Undo (coming)"}),(()=>{const u=Le(),p=`/api/file?path=${encodeURIComponent(t.trashPath)}`+(u?`&token=${encodeURIComponent(u)}`:"");return e.jsx("a",{className:"btn",style:{marginLeft:8},href:p,download:d,children:"Download"})})()]})]})}function ne(t){if(!t||t<=0)return"0 B";const s=1024,i=s*1024,o=i*1024;return t>=o?`${(t/o).toFixed(2)} GB`:t>=i?`${(t/i).toFixed(2)} MB`:t>=s?`${(t/s).toFixed(2)} KB`:`${t} B`}const bt=new Set(["txt","md","markdown","yaml","yml","json","js","ts","jsx","tsx","html","css","env","ini","cfg","conf","csh","gitignore","dockerfile","sql"]),qe=new Set(["zip","gz","tar","rar","exe","dll","so","bin","jpg","jpeg","png","gif","webp","pdf"]);function ve(t){const s=t.split("/"),i=s[s.length-1]||"",o=i.lastIndexOf(".");return o===-1?"":i.slice(o+1).toLowerCase()}function Ve(t){const s=ve(t);return!s||bt.has(s)?!0:!qe.has(s)}function St(t){const s=ve(t);return!(!s||qe.has(s))}async function Fe(t){if(!t)return{mime:"application/octet-stream",isText:!1,ext:""};try{const s=`?path=${encodeURIComponent(t)}`,i=await re(`/api/filetype${s}`);if(!i.ok)throw new Error("probe failed");return await i.json()}catch{const i=ve(t);return{mime:"application/octet-stream",isText:Ve(t),ext:i}}}function kt(t){const s=Ee.languages;switch(t){case"jsx":return s.jsx;case"tsx":return s.tsx;case"java":return s.java;case"ini":return s.ini;case"js":return s.javascript;case"ts":return s.typescript;case"go":return s.go;case"php":return s.php;case"json":return s.json;case"yaml":case"yml":return s.yaml;case"toml":return s.toml||s.markup;case"md":case"markdown":return s.markdown;case"c":return s.c;case"cpp":return s.cpp;case"py":return s.python;case"sh":case"bash":return s.bash;case"xml":case"xml-doc":return s["xml-doc"];case"html":case"htm":return s.markup;case"css":case"sass":case"scss":return s.sass;case"sql":return s.sql;default:return s.javascript}}function he(t){switch(t){case"js":case"jsx":return"javascript";case"ts":case"tsx":return"typescript";case"go":return"go";case"php":return"php";case"json":return"json";case"yaml":case"yml":return"yaml";case"toml":return"toml";case"ini":return"ini";case"md":case"markdown":return"markdown";case"c":return"c";case"cpp":case"cxx":case"c++":return"cpp";case"py":return"python";case"sh":case"bash":case"csh":return"bash";case"xml":case"xml-doc":return"xml-doc";case"html":case"htm":return"markup";case"sass":case"scss":return"sass";case"sql":return"sql";case"less":case"css":return"css";default:return"text"}}function Ue(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Nt(t,s){try{const i=kt(s),o=he(s);return i?Ee.highlight(t,i,o):Ue(t)}catch(i){return console.warn("Prism highlight failed",i),Ue(t)}}function Ct({content:t,setContent:s,origContent:i,ext:o,alias:l,textareaId:d}){const a=r.useRef(null),u=r.useRef(null);return r.useEffect(()=>{const p=l||he(o);u.current&&u.current.setAttribute("data-grammar",p),a.current&&a.current.setAttribute("data-grammar",p);try{const w=u.current?.querySelector("code");w&&Ee.highlightElement(w)}catch{}},[l,t,o]),r.useEffect(()=>{a.current&&u.current&&(u.current.scrollTop=a.current.scrollTop,u.current.scrollLeft=a.current.scrollLeft)},[t]),e.jsxs("div",{className:"editor-edit-area",children:[e.jsx("pre",{"aria-hidden":!0,className:`highlight-wrap language-${l||he(o)}`,"data-grammar":l||he(o),ref:p=>{u.current=p},children:e.jsx("code",{className:`language-${l||he(o)}`,dangerouslySetInnerHTML:{__html:Nt(t||"",o)}})}),e.jsx("textarea",{ref:a,className:"textarea",wrap:"off",value:t,name:d||"editor",id:d,"data-grammar":l,onChange:p=>s(p.target.value),onScroll:()=>{a.current&&u.current&&(u.current.scrollTop=a.current.scrollTop,u.current.scrollLeft=a.current.scrollLeft)},placeholder:"Open or create a file to edit",spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",autoComplete:"off"})]})}function Et({path:t,onDimensions:s}){const i=Le(),o=`/api/file?path=${encodeURIComponent(t)}${i?`&token=${encodeURIComponent(i)}`:""}`,[l,d]=r.useState(null),a=r.useRef(null);return e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"},children:e.jsx("img",{ref:a,src:o,alt:t.split("/").pop(),style:{maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",borderRadius:6,boxShadow:"0 2px 8px rgba(0,0,0,0.4)"},onLoad:()=>{try{const u=a.current;if(u&&u.naturalWidth&&u.naturalHeight){d({w:u.naturalWidth,h:u.naturalHeight});try{s&&s(u.naturalWidth,u.naturalHeight)}catch{}}}catch{}}})}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("a",{className:"link",href:o,download:t.split("/").pop(),children:"Download"}),l?e.jsxs("span",{className:"muted",style:{marginLeft:8},children:[l.w," × ",l.h]}):null]})]})}const Lt=r.lazy(()=>ge(()=>import("./PdfPreview-B_XVNtNO.js"),__vite__mapDeps([0,1,2,3,4,5])));function Tt({path:t}){return e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading PDF preview…"}),children:e.jsx(Lt,{path:t})})}r.lazy(()=>ge(()=>import("./PdfPreview-B_XVNtNO.js"),__vite__mapDeps([0,1,2,3,4,5])));const It=r.lazy(()=>ge(()=>import("./ShellView-Bdk8KEPj.js"),__vite__mapDeps([6,1,2,3,4,7,8,9,5])));function Dt({path:t,onSaved:s,settings:i,reloadTrigger:o,onUnsavedChange:l,onMeta:d}){const[a,u]=r.useState(""),[p,w]=r.useState(""),[L,b]=r.useState(""),[T,j]=r.useState(!1),[x,z]=r.useState(null),[ie,P]=r.useState(!1),[y,Z]=r.useState(null),[U,ee]=r.useState(null),[Q,G]=r.useState(null),[K,m]=r.useState(null),[I,C]=r.useState(!1),E=r.useRef(null),k=r.useRef(null),M=r.useRef(null),X=r.useCallback(async(S=!1)=>{if(t){j(!0),b("");try{const _=await ae(t);if(z(_),typeof d=="function"&&d(_),!S&&Q&&K&&_.modTime!==K&&!confirm("File has been modified externally. Reload?")){j(!1);return}m(_.modTime);const F=await Fe(t);if(Z(F),F.mime&&F.mime.startsWith("image/")){u(""),b(""),j(!1);return}if(F.mime&&F.mime==="application/pdf"){u(""),b(""),j(!1);return}if(!F.isText){u(""),b("no preview available — unsupported file type, use Download"),j(!1);return}const J=await Me(t);u(J),w(J),G(Date.now()),C(!1)}catch{b("Failed to load"),C(!0),G(null)}finally{j(!1)}}},[t]),Y=10*1024*1024,te=async(S,_=64*1024)=>{if(t){P(!0);try{const F=`?path=${encodeURIComponent(t)}&offset=${S}&length=${_}`,J=await fetch(`/api/file/section${F}`);if(!J.ok)throw new Error("section fetch failed");const de=await J.text();u(de),w(de)}catch{b("Failed to load section")}finally{P(!1)}}},N=y&&y.ext?y.ext:ve(t),D=void 0,R=y&&y.ext?y.ext:"text",q=(S=>S?"editor-"+S.replace(/[^a-z0-9_-]/gi,"-").replace(/-+/g,"-"):"editor")(t||"");r.useEffect(()=>{X()},[X]),r.useEffect(()=>{let S=!0;return(async()=>{if(!(!x||!x.isDir||!t))try{const _=await Be(t);if(!S)return;u(""),w(_.map(F=>F.name).join(`
`))}catch{}})(),()=>{S=!1}},[x,t]),r.useEffect(()=>{o&&o>0&&X(!0)},[o]),r.useEffect(()=>{E.current&&k.current&&(k.current.scrollTop=E.current.scrollTop,k.current.scrollLeft=E.current.scrollLeft)},[a]),r.useEffect(()=>{if(E.current&&k.current){const S=window.getComputedStyle(k.current),_=S.lineHeight,F=S.paddingTop,J=S.paddingBottom;_&&(E.current.style.lineHeight=_),F&&(E.current.style.paddingTop=F),J&&(E.current.style.paddingBottom=J)}},[a,t]),r.useEffect(()=>{k.current&&k.current.setAttribute("data-grammar",R),E.current&&(E.current.setAttribute("data-grammar",R),q&&(E.current.id=q));try{const S=k.current?.querySelector("code");S&&Prism.highlightElement(S)}catch{}},[R,a,q]),r.useEffect(()=>{if(!l)return;const S=a!==p;if(M.current===null||M.current!==S){try{l(t,S)}catch(_){console.warn("onUnsavedChange threw",_)}M.current=S}},[a,p,l,t]);const we=async()=>{if(t){b("Saving...");try{await ft(t,a),b("Saved"),w(a),s&&s();try{const S=await ae(t);z(S),typeof d=="function"&&d(S)}catch{}}catch{b("Save failed")}}},ye=async()=>{if(t&&confirm(`Delete ${t}? This will move the file to the server-side trash.`)){b("Deleting...");try{await pt(t),b("Deleted"),u("")}catch{b("Delete failed")}}},be=async()=>{if(t&&!(a!==p&&!confirm("You have unsaved changes. Reloading will discard them. Continue?"))){b("Reloading...");try{const S=await Fe(t);if(Z(S),!S.isText){u(""),!S.mime||!S.mime.startsWith("image/")?b("?Binary or unsupported file type — use Download"+S.mime):b("");return}const _=await Me(t);u(_),w(_),b("Reloaded")}catch{b("Reload failed")}}};return e.jsxs("div",{className:"editor",children:[e.jsxs("div",{className:"editor-header",children:[e.jsx("strong",{children:"Editor"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{className:"muted",children:x&&x.absPath?x.absPath:t||"Select a file"}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"muted",style:{fontSize:11},children:[x.isDir?"directory":y&&y.mime&&y.mime.startsWith("image/")?"image":y&&y.mime==="application/pdf"?"pdf":y&&y.isText?"text":x.mime&&x.mime!=="text/plain"?x.mime:y&&y.mime?y.mime:x.mime||"file","· ",x.mode," · ",new Date(x.modTime).toLocaleString()," ",x.size?`· ${ne(x.size)}`:""]}),y&&y.mime&&y.mime.startsWith("image/")&&U?e.jsxs("span",{style:{fontSize:11,marginLeft:8},className:"muted",children:[U.w," × ",U.h]}):null]})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",onClick:be,disabled:!t,children:"Reload"}),t&&a!==p&&e.jsx("button",{className:"btn",onClick:we,children:"Save"}),i&&i.allowDelete?e.jsx("button",{className:"btn btn-danger",onClick:ye,disabled:!t,children:"Delete"}):null]}),x&&x.size&&x.size>Y?e.jsxs("div",{style:{marginLeft:12},children:[e.jsxs("div",{className:"muted",style:{fontSize:12},children:["File is large (",ne(x.size),"). Full edit disabled."]}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>te(0,64*1024),children:"View head"}),e.jsx("button",{className:"btn",onClick:()=>te(Math.max(0,(x.size||0)-64*1024),64*1024),children:"View tail"}),e.jsx("button",{className:"btn",onClick:()=>{const S=Math.max(0,Math.floor((x.size||0)/2));te(S,64*1024)},children:"View middle"})]}),ie&&e.jsx("div",{className:"muted",children:"Loading section..."})]}):null,L&&e.jsx("div",{className:"muted",children:L})]}),e.jsx("div",{className:"editor-body",children:T?e.jsx("div",{className:"muted",children:"Loading..."}):x&&x.isDir?e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{fontWeight:600},children:["Directory: ",t]}),e.jsxs("div",{className:"muted",style:{marginTop:6},children:[p?p.split(`
`).length:"0"," entries"]}),e.jsx("pre",{style:{marginTop:8,maxHeight:240,overflow:"auto",padding:8,background:"var(--panel)"},children:p})]}):(y?.isText??Ve(t))||St(t)?e.jsx(Ct,{content:a,setContent:u,origContent:p,ext:N,alias:D,textareaId:q}):e.jsx("div",{children:t&&t.startsWith("shell-")?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading shell…"}),children:e.jsx(It,{path:t})}):y&&y.mime&&y.mime==="application/pdf"?e.jsx(Tt,{path:t}):y&&y.mime&&y.mime.startsWith("image/")?e.jsx(Et,{path:t,onDimensions:(S,_)=>ee({w:S,h:_})}):t?e.jsx("div",{style:{marginTop:8,display:"flex",gap:8},children:e.jsx("a",{className:"link",href:`/api/file?path=${encodeURIComponent(t)}`,download:t.split("/").pop(),children:"Download"})}):null})})]})}function Rt({path:t}){const[s,i]=r.useState(null),[o,l]=r.useState(null);return r.useEffect(()=>{let d=!0;return(async()=>{if(!t){i(null);return}try{const a=await ae(t);if(!d)return;i(a),l(null)}catch(a){if(!d)return;l(a?.message||"failed to fetch metadata"),i(null)}})(),()=>{d=!1}},[t]),t?e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:t.split("/").pop()}),e.jsx("div",{className:"muted",style:{fontSize:12},children:t})]}),e.jsx("div",{children:e.jsx("a",{className:"link",href:`/api/file?path=${encodeURIComponent(t)}`,download:t.split("/").pop(),children:"Download"})})]}),e.jsxs("div",{style:{marginTop:12},children:[o?e.jsx("div",{className:"error",children:o}):null,s?e.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{width:160,padding:6},className:"muted",children:"Full path"}),e.jsx("td",{style:{padding:6},children:s.path||t})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"MIME"}),e.jsx("td",{style:{padding:6},children:s.mime||"unknown"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Size"}),e.jsx("td",{style:{padding:6},children:s.size?ne(s.size):"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Mode"}),e.jsx("td",{style:{padding:6},children:s.mode||"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Last Modified"}),e.jsx("td",{style:{padding:6},children:s.modTime?new Date(s.modTime).toLocaleString():"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Is Dir"}),e.jsx("td",{style:{padding:6},children:s.isDir?"yes":"no"})]})]})}):e.jsx("div",{className:"muted",children:"Loading metadata…"})]})]}):e.jsx("div",{style:{padding:12},className:"muted",children:"No file selected"})}function _t({openFiles:t,active:s,onActivate:i,onClose:o,onCloseOthers:l,onCloseLeft:d,titles:a,fullPaths:u,types:p,evictedTabs:w=[],onRestoreEvicted:L}){const[b,T]=r.useState(null),j=r.useRef(null),x=r.useRef(null),[z,ie]=r.useState(!1),[P,y]=r.useState(!1),[Z,U]=r.useState(!1),[ee,Q]=r.useState(null),G=()=>{const m=x.current;if(!m){ie(!1),y(!1);return}ie(m.scrollLeft>0),y(m.scrollWidth>m.clientWidth+m.scrollLeft+1)},K=m=>{const I=x.current;I&&(I.scrollBy({left:m,behavior:"smooth"}),setTimeout(G,220))};return r.useEffect(()=>{function m(C){j.current&&(C.target instanceof Node&&j.current.contains(C.target)||T(null))}function I(C){C.key==="Escape"&&T(null)}return document.addEventListener("click",m),document.addEventListener("keydown",I),()=>{document.removeEventListener("click",m),document.removeEventListener("keydown",I)}},[]),r.useEffect(()=>{G();function m(){G()}window.addEventListener("resize",m);function I(){const C=x.current,E=140;if(!C){Q(null);return}const k=C.clientWidth,M=Math.max(1,Math.floor(k/E));Q(M)}return window.addEventListener("resize",I),I(),()=>{window.removeEventListener("resize",m),window.removeEventListener("resize",I)}},[t]),e.jsxs("div",{className:"tabbar",ref:j,children:[(()=>{const I=x.current?x.current.clientWidth:600,C=ee??Math.max(1,Math.floor(I/140)),E=t.length>C?t.slice(0,t.length-C):[];return E.length===0?null:e.jsxs("div",{className:"tab-evicted-dropdown",style:{display:"flex",alignItems:"center",marginRight:8,position:"relative"},children:[e.jsx("button",{className:"btn",onClick:()=>U(k=>!k),children:"⋯"}),Z&&e.jsx("div",{style:{position:"absolute",left:0,top:"100%",background:"var(--bg)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",padding:8,zIndex:50},children:E.map(k=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 8px"},children:[e.jsx("button",{className:"link",onClick:()=>{L&&L(k),U(!1)},style:{flex:1,textAlign:"left"},children:a&&a[k]||k.split("/").pop()}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{className:"btn btn-small",title:"Restore",onClick:()=>{L&&L(k),U(!1)},children:"↺"}),e.jsx("button",{className:"btn btn-small",title:"Close",onClick:()=>{o&&o(k),U(!1)},children:"✕"}),e.jsx("button",{className:"btn btn-small",title:"Close Others",onClick:()=>{E.filter(M=>M!==k).forEach(M=>o&&o(M)),U(!1)},children:"⋯"})]})]},k))})]})})(),z&&e.jsx("button",{className:"tab-scroll tab-scroll-left","aria-label":"scroll left",onClick:()=>K(-200),children:"◀"}),e.jsx("div",{className:"tab-scroll-area",ref:x,onScroll:G,children:t.map((m,I)=>e.jsx("div",{className:"tab-item",style:{display:"flex",alignItems:"center",gap:8,padding:"4px 8px"},children:e.jsxs("button",{className:m===s?"btn":"link",onClick:()=>i(m),onContextMenu:C=>{C.preventDefault(),T(I)},style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{className:"tab-icon",children:(()=>{if((p&&p[m])==="shell")return e.jsx(O,{name:H("terminal")});if((p&&p[m])==="dir")return e.jsx(O,{name:H("folder")});const C=(m.split(".").pop()||"").toLowerCase(),E=ce(C);return e.jsx(O,{name:E})})()},`${p?.[m]||"file"}-${m}`),(()=>{const C=a&&a[m]||m.split("/").pop()||m,E=C.length>10?C.slice(0,10)+"…":C,k=a&&a[m]&&a[m].startsWith("*")?"tab-title tab-unsaved":"tab-title";return e.jsx("span",{title:u?.[m]||C,className:k,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:120},children:E})})()]})},m))}),b!==null&&(()=>{const m=t[b];if(!m)return null;const I=j.current,C=x.current;let E={position:"absolute",right:8,top:40,padding:8,display:"flex",flexDirection:"column",gap:6};try{const k=C?.querySelectorAll(".tab-item"),M=k?k[b]:null;if(M&&I){const X=I.getBoundingClientRect(),Y=M.getBoundingClientRect();E={position:"absolute",left:Y.left-X.left,top:Y.bottom-X.top+6,padding:8,display:"flex",flexDirection:"column",gap:6}}}catch{}return e.jsxs("div",{className:"dropdown",style:E,children:[e.jsx("button",{ref:k=>{k&&k.focus()},className:"link",onClick:()=>{o?.(m),T(null)},children:"Close"}),e.jsx("button",{className:"link",onClick:()=>{l?.(m),T(null)},children:"Close Others"}),e.jsx("button",{className:"link",onClick:()=>{d?.(m),T(null)},children:"Close Left"})]})})(),P&&e.jsx("button",{className:"tab-scroll tab-scroll-right","aria-label":"scroll right",onClick:()=>K(200),children:"▶"})]})}function $t({visible:t=!0,onClose:s}){const[,i]=r.useState(0);if(r.useEffect(()=>dt(()=>i(a=>a+1)),[]),!t)return null;const o=ct().slice(0,100);function l(d){const a=[],u=/([\w\/\.\-]+:\d+)/g;let p=0,w;for(;(w=u.exec(d))!==null;)w.index>p&&a.push({text:d.slice(p,w.index)}),a.push({text:w[0],cls:"log-path"}),p=w.index+w[0].length;return p<d.length&&a.push({text:d.slice(p)}),a.map((L,b)=>L.cls?e.jsx("span",{className:L.cls,children:L.text},b):e.jsx("span",{children:L.text},b))}return e.jsxs("div",{className:"log-overlay",children:[e.jsxs("div",{className:"log-header",children:[e.jsx("strong",{children:"Logs"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn",onClick:()=>ut(),children:"Clear"}),e.jsx("button",{className:"btn",onClick:()=>s&&s(),style:{marginLeft:8},children:"Close"})]})]}),e.jsx("div",{children:o.map((d,a)=>e.jsxs("div",{className:`log-entry log-level-${(d.level||"").toLowerCase()}`,children:[e.jsxs("div",{className:"log-meta",children:[d.ts," ",e.jsx("span",{className:"log-level",children:d.level})]}),e.jsx("div",{className:"log-message",children:l(d.msg)})]},a))})]})}async function Ot(t,s="mlcremote-screenshot.png"){const i=await it(t,{backgroundColor:null,scale:2});return new Promise(o=>{i.toBlob(l=>{if(!l){o();return}const d=URL.createObjectURL(l),a=document.createElement("a");a.href=d,a.download=s,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(d),o()},"image/png")})}class zt{prefix;constructor(s=""){this.prefix=s}key(s){return`${this.prefix}${s}`}get(s,i,o=null){try{const l=localStorage.getItem(this.key(s)),d=i.read(l);return d===null?o:d}catch{return o}}getOrDefault(s,i,o){const l=this.get(s,i,null);return l===null?o:l}set(s,i,o){try{localStorage.setItem(this.key(s),o.write(i))}catch{}}remove(s){try{localStorage.removeItem(this.key(s))}catch{}}}const Ce={read:t=>t===null?null:t,write:t=>String(t)},V={read:t=>t===null?null:t==="1"||t==="true",write:t=>t?"1":"0"},A=new zt("mlc:"),Pt=r.lazy(()=>ge(()=>import("./TerminalTab-C7K2ji48.js"),__vite__mapDeps([7,1,2,3,4,8,9,5])));function Mt(){const[t,s]=r.useState(null),[i,o]=r.useState(null),[l,d]=r.useState(""),[a,u]=r.useState(""),p=r.useCallback(n=>u(n),[]),[w,L]=r.useState(0),[b,T]=r.useState(!0),[j,x]=r.useState([]),[z,ie]=r.useState([]),[P,y]=r.useState(""),[Z,U]=r.useState(null),[ee,Q]=r.useState(()=>A.getOrDefault("autoOpen",V,!0)),G=n=>{Q(n),A.set("autoOpen",n,V)},K=8;function m(n){x(f=>{if(f.includes(n))return f;const g=[...f,n];if(g.length<=K)return g;const c=g[0];try{ie(v=>v.includes(c)?v:[...v,c])}catch{}return g.slice(1)}),y(n),ae(n).then(f=>{Re(g=>({...g,[n]:f}))}).catch(()=>{})}const[I,C]=r.useState({}),[E,k]=r.useState(()=>A.getOrDefault("showHidden",V,!1)),M=n=>{k(n),A.set("showHidden",n,V)},[X,Y]=r.useState(!1),[te,h]=r.useState(()=>A.getOrDefault("showLogs",V,!1)),[N,D]=r.useState(!1),[R,W]=r.useState(!1),[q,we]=r.useState(()=>A.getOrDefault("hideServerName",V,!1)),[ye,be]=r.useState(()=>A.getOrDefault("hideMemoryUsage",V,!1)),[S,_]=r.useState(!1),[F,J]=r.useState(null),[de,Ge]=r.useState(300),[je,Ke]=r.useState(()=>A.getOrDefault("theme",Ce,"dark")),[Xe,Ye]=r.useState(new Date),[se,Te]=r.useState(navigator.onLine),[Je,Ft]=r.useState({}),[Ie,De]=r.useState(()=>{try{return mt()?Date.now():0}catch{return 0}}),[Ze,Qe]=r.useState({}),[Ut,Re]=r.useState({}),et=r.useCallback((n,f)=>{Qe(g=>({...g,[n]:f}))},[]),Se=r.useCallback(async()=>{if(se)try{const n=await Ne();s(n),o(Date.now())}catch{s(null)}},[se]);r.useEffect(()=>{const n=window.setInterval(()=>Ye(new Date),1e3);return()=>window.clearInterval(n)},[]),r.useEffect(()=>{let n=!0;async function f(){if(se)try{const c=await Ne();if(!n)return;s(c),o(Date.now()),await Pe()||(localStorage.removeItem("mlcremote_token"),c.password_auth?_e(!0):c.auth_required&&le(!0))}catch{if(!n)return;s(null)}}f();const g=setInterval(f,60*1e3);return()=>{n=!1,clearInterval(g)}},[se]);const[Ht,_e]=r.useState(!1),[tt,ke]=r.useState(!1),[st,oe]=r.useState(!1);r.useEffect(()=>{if(!t){oe(!1);return}const n=!!t.password_auth,f=!!t.auth_required&&!t.password_auth,g=localStorage.getItem("mlcremote_token");oe(!!((n||f)&&!g))},[t]),r.useEffect(()=>{const n=f=>oe(!0);return window.addEventListener("mlcremote:auth-failed",n),()=>window.removeEventListener("mlcremote:auth-failed",n)},[]),r.useEffect(()=>{try{localStorage.getItem("mlcremote_token")&&(oe(!1),ke(!1),le(!1))}catch{}},[Ie]);const[nt,le]=r.useState(!1);return r.useEffect(()=>{if(!t)return;const n=!!t.auth_required&&!t.password_auth,f=localStorage.getItem("mlcremote_token");le(!!(n&&!f))},[t]),r.useEffect(()=>{fetch("/api/settings").then(n=>n.json()).then(n=>{J(n),n&&typeof n.allowChangeRoot<"u"&&Y(!!n.allowChangeRoot)}).catch(()=>J({allowDelete:!1,defaultShell:"bash"}))},[]),r.useEffect(()=>{je==="light"?document.documentElement.classList.add("theme-light"):document.documentElement.classList.remove("theme-light")},[je]),r.useEffect(()=>{const n=()=>{Te(!0),Ne().then(async g=>{s(g),o(Date.now()),await Pe()||(localStorage.removeItem("mlcremote_token"),g.password_auth?_e(!0):g.auth_required&&le(!0))}).catch(()=>{s(null)})},f=()=>{Te(!1),s(null)};return window.addEventListener("online",n),window.addEventListener("offline",f),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",f)}},[]),e.jsxs("div",{className:"app",children:[e.jsxs("header",{className:"app-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("img",{src:"/logo.png",alt:"MLCRemote logo",style:{height:28,display:"block"},onLoad:()=>T(!0),onError:()=>T(!1)}),!b&&e.jsx("h1",{style:{margin:0},children:"MLCRemote"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:8},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:6,background:t&&t.host?"#10b981":se?"#f59e0b":"#ef4444",display:"inline-block"}}),!q&&e.jsx("button",{className:"link icon-btn",style:{marginLeft:0,fontSize:12,padding:0},onClick:()=>D(!0),children:t&&t.host?t.host:se?"connecting...":"browser offline"})]})]}),e.jsxs("div",{className:"status",children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[!se&&e.jsx("span",{className:t?"badge badge-ok":"badge badge-error",children:se?"":"offline"}),e.jsx("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:t&&t.server_time&&null})]}),!ye&&t&&t.sys_mem_total_bytes?(()=>{const n=t.sys_mem_total_bytes||1,f=t.sys_mem_free_bytes||0,g=n-f,c=Math.round(g/n*100);return e.jsxs("div",{style:{marginLeft:8,display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:120,height:10,background:"rgba(255,255,255,0.06)",borderRadius:6,border:"1px solid rgba(0,0,0,0.12)",overflow:"hidden"},children:e.jsx("div",{style:{width:`${c}%`,height:"100%",background:c>80?"#e11d48":"#10b981",borderRadius:6,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06)"}})}),e.jsxs("div",{className:"muted",style:{fontSize:12},title:`Memory usage: ${ne(g)} / ${ne(n)} (${c}%)`,children:[c,"%"]})]})})():null,e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(Xe)}),e.jsx("button",{className:"link icon-btn",onClick:async()=>{let n=l||"";try{if(n){const c=await ae(n);if(!c.isDir&&c.path){const v=c.path.split("/").filter(Boolean);v.pop(),n=v.length?`/${v.join("/")}`:""}}else if(P&&!P.startsWith("shell-"))try{const c=await ae(P);if(c.isDir)n=c.path||P;else if(c.path){const v=c.path.split("/").filter(Boolean);v.pop(),n=v.length?`/${v.join("/")}`:""}}catch{const v=P.split("/").filter(Boolean);v.pop(),n=v.length?`/${v.join("/")}`:""}}catch{}const f=`shell-${Date.now()}`;let g=n||"";if(g&&g.split("/").pop()?.includes(".")){const c=g.split("/").filter(Boolean);c.pop(),g=c.length?`/${c.join("/")}`:"/"}C(c=>({...c,[f]:g})),m(f)},title:"Open shell","aria-label":"Open shell",children:e.jsx(O,{name:H("terminal"),title:"Open shell",size:16})})]}),e.jsx("button",{className:"link icon-btn","aria-label":"Toggle theme",onClick:()=>{const n=je==="dark"?"light":"dark";Ke(n),A.set("theme",n,Ce),n==="light"?document.documentElement.classList.add("theme-light"):document.documentElement.classList.remove("theme-light")},children:je==="dark"?e.jsx(O,{name:H("moon"),title:"Dark theme",size:16}):e.jsx(O,{name:H("sun"),title:"Light theme",size:16})}),e.jsx("button",{className:"link icon-btn",title:"About","aria-label":"About",onClick:()=>D(!0),children:e.jsx(O,{name:H("info"),title:"About",size:16})}),e.jsx("button",{className:"link icon-btn ",title:"Screenshot","aria-label":"Screenshot",onClick:async()=>{const n=document.querySelector(".app");if(n)try{await Ot(n,"mlcremote-screenshot.png")}catch(f){console.error("Screenshot failed",f)}},children:e.jsx(O,{name:H("screenshot"),title:"Screenshot",size:16})}),e.jsx("button",{className:"link icon-btn","aria-label":"Open settings",title:"Settings",onClick:()=>W(n=>!n),children:e.jsx(O,{name:H("settings"),title:"Settings",size:16})}),e.jsx("button",{className:"link icon-btn",title:"Trash","aria-label":"Trash",onClick:()=>{j.includes("trash")||m("trash"),y("trash")},children:e.jsx(O,{name:"icon-trash",title:"Trash",size:16})})]}),R&&e.jsx(vt,{autoOpen:ee,showHidden:E,onToggleAutoOpen:n=>G(n),onToggleShowHidden:n=>M(n),showLogs:te,onToggleLogs:n=>{h(n),A.set("showLogs",n,V)},hideServerName:q,onToggleHideServerName:n=>{we(n),A.set("hideServerName",n,V)},hideMemoryUsage:ye,onToggleHideMemoryUsage:n=>{be(n),A.set("hideMemoryUsage",n,V)},onClose:()=>W(!1)})]}),e.jsxs("div",{className:"app-body",style:{alignItems:"stretch"},children:[e.jsx("aside",{className:"sidebar",style:{width:de},children:e.jsx(jt,{showHidden:E,autoOpen:ee,onToggleHidden:n=>M(n),selectedPath:l,activeDir:a,onDirChange:p,focusRequest:w,reloadSignal:Ie,onSelect:(n,f)=>{if(d(n),f){y(n);return}(async()=>{try{const g=await ae(n);if(!g.isDir&&g.mime&&!g.mime.startsWith("text/")&&!g.mime.startsWith("image/")&&g.mime!=="application/pdf"){j.includes("binary")||m("binary"),U(n),y("binary");return}}catch{}ee?m(n):y(n)})(),Se()},onView:n=>{j.includes(n)?y(n):m(n),d(n),Se()},onBackendActive:Se,onChangeRoot:async()=>{if(!X){alert("Changing root is not permitted by the server settings");return}const n=window.prompt("Enter the server directory path to use as new root (e.g. /home/user/project):",l||"/");if(!n)return;const f=n.trim();try{if(!(await ae(f)).isDir){alert("Selected path is not a directory");return}d(f);try{A.set("lastRoot",f,Ce)}catch{}try{const c=A.getOrDefault("showHidden",V,!1);A.set("showHidden",c,V)}catch{}}catch(g){alert("Cannot access selected path: "+(g?.message||g))}}})}),e.jsx("div",{className:"resizer",onMouseDown:n=>{const f=n.clientX,g=de;function c($){const ue=$.clientX-f;Ge(Math.max(160,Math.min(800,g+ue)))}function v(){window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",v)}window.addEventListener("mousemove",c),window.addEventListener("mouseup",v)},children:e.jsx("div",{className:"bar"})}),e.jsx("main",{className:"main",children:e.jsxs("div",{className:"main-content",children:[st&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Not Authenticated"}),e.jsx("p",{children:"You need to sign in or provide an access key to continue."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn",onClick:()=>{oe(!1),ke(!0)},children:"Sign in (password)"}),e.jsx("button",{className:"btn",onClick:()=>{oe(!1),le(!0)},children:"I have an access key"})]})]})}),tt&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Sign in"}),e.jsx("p",{children:"Please enter the server password to obtain an access token."}),e.jsx("input",{id:"mlc-login-pwd",type:"password",placeholder:"Password"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"btn",onClick:async()=>{const n=document.getElementById("mlc-login-pwd");if(n)try{const f=await ht(n.value);console.log("login token",f),ke(!1),De(Date.now())}catch(f){alert("Login failed: "+(f?.message||f))}},children:"Sign in"})})]})}),nt&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Enter Access Token"}),e.jsx("p",{children:"The server requires an access token. Paste it here to continue."}),e.jsx("input",{id:"mlc-token-input",type:"text",placeholder:"token"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"btn",onClick:async()=>{const n=document.getElementById("mlc-token-input");if(n)try{localStorage.setItem("mlcremote_token",n.value.trim()),le(!1),De(Date.now())}catch(f){alert("Failed to store token: "+(f?.message||f))}},children:"Use token"})})]})}),e.jsx("div",{}),j.length>0&&e.jsx("div",{children:e.jsx(r.Suspense,{fallback:null,children:(()=>{const n={};for(const c of j)if(c.startsWith("shell-")){const $=(I[c]||""||"/").split("/").filter(Boolean);let ue="/";if($.length){const $e=$[$.length-1];$e.includes(".")&&$.length>1?ue=$[$.length-2]:ue=$e}n[c]=ue}else{const v=c.split("/").pop()||c;n[c]=Ze[c]?`*${v}`:v}const f={},g={};for(const c of j)c.startsWith("shell-")?(f[c]="shell",g[c]=I[c]||"/"):(f[c]="file",g[c]=c);return e.jsx(_t,{openFiles:j,active:P,titles:n,fullPaths:g,types:f,onRestoreEvicted:c=>{x(v=>v.includes(c)?v:[c,...v].slice(0,K)),y(c),d(c),L(Date.now())},onActivate:c=>{if(c&&!c.startsWith("shell-")){const v=c.split("/").filter(Boolean);v.pop();const $=v.length?`/${v.join("/")}`:"";$!==a&&u($)}d(c),L(Date.now()),y(c)},onClose:c=>{x(v=>v.filter($=>$!==c)),P===c&&y(j.filter(v=>v!==c)[0]||"")},onCloseOthers:c=>{x(v=>v.filter($=>$===c||$===P))},onCloseLeft:c=>{x(v=>{const $=v.indexOf(c);return $<=0?v:v.slice($)})}})})()})}),j.map(n=>e.jsx("div",{style:{display:n===P?"block":"none",height:"100%"},children:n.startsWith("shell-")?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading terminal…"}),children:e.jsx(Pt,{shell:F&&F.defaultShell||"bash",path:I[n]||"",onExit:()=>{x(f=>f.filter(g=>g!==n)),P===n&&y(j.filter(f=>f!==n)[0]||""),C(f=>{const g={...f};return delete g[n],g})}},n)}):n==="trash"?e.jsx(wt,{}):n==="binary"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading…"}),children:e.jsx(Rt,{path:Z||void 0})}):e.jsx(Dt,{path:n,settings:F||void 0,onSaved:()=>{},reloadTrigger:Je[n]||0,onUnsavedChange:et,onMeta:f=>{f&&f.path&&Re(g=>({...g,[n]:f}))}})},n)),j.length===0&&e.jsxs("div",{className:"welcome-message",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-muted)",fontSize:"18px",textAlign:"center",padding:"20px"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:e.jsx(O,{name:H("folder"),size:48})}),e.jsx("div",{children:"Welcome to MLCRemote"}),e.jsx("div",{style:{fontSize:"14px",marginTop:"10px"},children:"Select a file from the explorer to start editing"})]})]})})]}),e.jsx($t,{visible:te,onClose:()=>h(!1)}),N&&e.jsx("div",{className:"about-backdrop",onClick:()=>D(!1),children:e.jsxs("div",{className:"about-modal",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"MLCRemote"}),e.jsx("button",{"aria-label":"Close about",title:"Close",onClick:()=>D(!1),style:{background:"transparent",border:"none",cursor:"pointer"},children:e.jsx(O,{name:"icon-close",size:16})})]}),e.jsxs("div",{style:{marginBottom:8},children:["Copyright © ",new Date().getFullYear()," Michael Lechner"]}),e.jsxs("div",{style:{marginBottom:8},children:["Version: ",t?`${t.status}@${t.version}`:"unknown"]}),t&&e.jsxs("div",{style:{maxHeight:"40vh",overflow:"auto",background:"#0b0b0b",color:"white",padding:12,borderRadius:6},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Host:"})," ",t.host]}),e.jsxs("div",{children:[e.jsx("strong",{children:"PID:"})," ",t.pid]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Version:"})," ",t.version]}),e.jsxs("div",{children:[e.jsx("strong",{children:"App Memory:"})," ",ne(t.go_alloc_bytes)," (alloc) / ",ne(t.go_sys_bytes)," (sys)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"System Memory:"})," ",ne((t.sys_mem_total_bytes||0)-(t.sys_mem_free_bytes||0))," / ",ne(t.sys_mem_total_bytes||0)," used"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"CPU:"})," ",Math.round((t.cpu_percent||0)*10)/10,"%"]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("strong",{children:"Server time:"})," ",t.server_time]}),e.jsxs("div",{style:{marginTop:4},children:[e.jsx("strong",{children:"Timezone:"})," ",t.timezone]}),e.jsxs("div",{className:"muted",style:{marginTop:8,fontSize:12},children:["Last refresh: ",i?new Date(i).toLocaleString():"n/a"]})]})]})})]})}(async()=>{try{const t=await ge(()=>import("./icons-sprite-BJH4FJcj.js"),[]),s=t&&(t.default||t);if(s&&typeof document<"u"){const i=document.createElement("div");i.style.width="0",i.style.height="0",i.style.position="absolute",i.style.visibility="hidden",i.innerHTML=s,document.body.insertBefore(i,document.body.firstChild)}}catch{}})();rt.createRoot(document.getElementById("root")).render(e.jsx(Mt,{}));export{ge as _,re as a,ae as s};
