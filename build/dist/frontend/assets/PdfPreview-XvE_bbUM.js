import{_ as y,a as P,m as b}from"./index-DMWgBA1Y.js";import{u as k,R as o,j as r}from"./vendor-react-Dv8eETpG.js";import"./vendor-prism-DmEJSkZI.js";import"./vendor-extend-BByqELpg.js";import"./vendor-html2canvas-BfYXEYrK.js";import"./vendor-xterm-DOcMqDAd.js";import"./vendor-i18next-BnqEsHlA.js";import"./vendor-i18next-browser-languagedetector-ClvlpAgo.js";import"./vendor-scheduler-DYLXRpC5.js";import"./vendor-devlop-Cl3hj7Sz.js";import"./vendor-unified-CN3Pc_0x.js";import"./vendor-bail-FqpXQuLt.js";import"./vendor-is-plain-obj-C1gvLhAf.js";import"./vendor-trough-B_b8ryxu.js";import"./vendor-vfile-BCWrK60u.js";import"./vendor-vfile-message-DqhD22jI.js";import"./vendor-unist-util-stringify-position-Ch_qCilz.js";import"./vendor-remark-parse-CNDkPE6C.js";import"./vendor-mdast-util-from-markdown-CHHsmDpx.js";import"./vendor-micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./vendor-micromark-util-decode-string-fHsnqYdj.js";import"./vendor-decode-named-character-reference-C3-224fz.js";import"./vendor-micromark-util-normalize-identifier-C9ANKk3v.js";import"./vendor-micromark-Dc687xHH.js";import"./vendor-micromark-util-combine-extensions-d8XJZrgA.js";import"./vendor-micromark-util-chunked-DrRIdSP-.js";import"./vendor-micromark-factory-space-BM4zcA-B.js";import"./vendor-micromark-util-character-Cn8n62xE.js";import"./vendor-micromark-core-commonmark-BEN53qso.js";import"./vendor-micromark-util-classify-character-Bc1Mydac.js";import"./vendor-micromark-util-resolve-all-PQCKh0dx.js";import"./vendor-micromark-util-subtokenize-BF1Jf29a.js";import"./vendor-micromark-factory-destination-QK-4WEtY.js";import"./vendor-micromark-factory-label-Bo_B4AwM.js";import"./vendor-micromark-factory-title-D-E2MfTG.js";import"./vendor-micromark-factory-whitespace-D8F2YPRT.js";import"./vendor-micromark-util-html-tag-name-DbKNfynz.js";import"./vendor-mdast-util-to-string-C_aolqmU.js";import"./vendor-remark-rehype-Eq-g-hA4.js";import"./vendor-mdast-util-to-hast-B4KFU5Q1.js";import"./vendor-ungap--gfxRhYI.js";import"./vendor-micromark-util-sanitize-uri-B-zxHmez.js";import"./vendor-unist-util-position-60F3QETU.js";import"./vendor-trim-lines-D8znQY54.js";import"./vendor-unist-util-visit-DyPrGnGc.js";import"./vendor-unist-util-visit-parents-CHe-IBUw.js";import"./vendor-unist-util-is-D9KQvrmg.js";import"./vendor-hast-util-to-jsx-runtime-48tnp6nG.js";import"./vendor-comma-separated-tokens-xMQ5YY98.js";import"./vendor-property-information-Bx45xMUt.js";import"./vendor-space-separated-tokens-DD3iYX1K.js";import"./vendor-style-to-js-CGcDVYOI.js";import"./vendor-style-to-object-COD_8__P.js";import"./vendor-inline-style-parser-CWBJcU5N.js";import"./vendor-hast-util-whitespace-D4Wp6AEg.js";import"./vendor-estree-util-is-identifier-name-BgBfM8ME.js";import"./vendor-html-url-attributes-D46m5wfe.js";function Et({path:p}){const{t:i}=k(),[l,g]=o.useState(null),[a,h]=o.useState(null),[n,u]=o.useState(1),[s,w]=o.useState(null),[j,x]=o.useState(!1),f=o.useRef(null);return o.useEffect(()=>{let t=!0;return(async()=>{try{const e=await y(()=>import("./vendor-pdfjs-dist-0-P3jM28GC.js"),[],import.meta.url);if(e.GlobalWorkerOptions.workerSrc="/pdf.worker.mjs",!t)return;g(e)}catch(e){console.error("Failed to load pdfjs",e)}})(),()=>{t=!1}},[]),o.useEffect(()=>{if(!l)return;let t=!1;return(async()=>{x(!0);try{const e=await P(`/api/file?path=${encodeURIComponent(p)}`);if(!e.ok)throw new Error("fetch failed");const m=await e.arrayBuffer(),c=await l.getDocument({data:m}).promise;if(t)return;h(c),w(c.numPages||null),u(1)}catch(e){console.error("Failed to load PDF",e),t||h(null)}finally{t||x(!1)}})(),()=>{t=!0}},[l,p]),o.useEffect(()=>{if(!a||!f.current)return;let t=!0;return(async()=>{try{const e=await a.getPage(n),m=e.getViewport({scale:1.25}),d=f.current,c=d.getContext("2d");d.width=Math.min(m.width,window.innerWidth*.9),d.height=m.height;const v={canvasContext:c,viewport:m};await e.render(v).promise}catch(e){t&&console.error("PDF render failed",e)}})(),()=>{t=!1}},[a,n]),l?j&&!a?r.jsx("div",{className:"muted",children:i("loading_pdf")}):r.jsxs("div",{style:{padding:12},children:[r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[r.jsx("button",{className:"btn",onClick:()=>u(t=>Math.max(1,t-1)),disabled:n<=1,children:i("previous")}),r.jsxs("span",{children:[n,s?` / ${s} `:""]}),r.jsx("button",{className:"btn",onClick:()=>u(t=>Math.min(s||1/0,t+1)),disabled:s?n>=s:!1,children:i("next")}),r.jsx("a",{className:"link",href:b(`/api/file?path=${encodeURIComponent(p)}`),download:p.split("/").pop(),children:i("download")})]}),r.jsx("div",{style:{marginTop:8},children:a?r.jsx("canvas",{ref:f,style:{maxWidth:"100%",borderRadius:6,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}):r.jsx("div",{className:"muted",children:i("no_preview")})})]}):r.jsx("div",{className:"muted",children:i("loading_pdf_support")})}export{Et as default};
