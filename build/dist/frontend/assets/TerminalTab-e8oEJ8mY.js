import{u as E,R as y,j as c}from"./vendor-react-Dv8eETpG.js";import{a as C,I,g as z,s as D,b as U}from"./index-DMWgBA1Y.js";import{x as A,o as L}from"./vendor-xterm-DOcMqDAd.js";import"./vendor-scheduler-DYLXRpC5.js";import"./vendor-devlop-Cl3hj7Sz.js";import"./vendor-extend-BByqELpg.js";import"./vendor-unified-CN3Pc_0x.js";import"./vendor-bail-FqpXQuLt.js";import"./vendor-is-plain-obj-C1gvLhAf.js";import"./vendor-trough-B_b8ryxu.js";import"./vendor-vfile-BCWrK60u.js";import"./vendor-vfile-message-DqhD22jI.js";import"./vendor-unist-util-stringify-position-Ch_qCilz.js";import"./vendor-remark-parse-CNDkPE6C.js";import"./vendor-mdast-util-from-markdown-CHHsmDpx.js";import"./vendor-micromark-util-decode-numeric-character-reference-CNs1qBpV.js";import"./vendor-micromark-util-decode-string-fHsnqYdj.js";import"./vendor-decode-named-character-reference-C3-224fz.js";import"./vendor-micromark-util-normalize-identifier-C9ANKk3v.js";import"./vendor-micromark-Dc687xHH.js";import"./vendor-micromark-util-combine-extensions-d8XJZrgA.js";import"./vendor-micromark-util-chunked-DrRIdSP-.js";import"./vendor-micromark-factory-space-BM4zcA-B.js";import"./vendor-micromark-util-character-Cn8n62xE.js";import"./vendor-micromark-core-commonmark-BEN53qso.js";import"./vendor-micromark-util-classify-character-Bc1Mydac.js";import"./vendor-micromark-util-resolve-all-PQCKh0dx.js";import"./vendor-micromark-util-subtokenize-BF1Jf29a.js";import"./vendor-micromark-factory-destination-QK-4WEtY.js";import"./vendor-micromark-factory-label-Bo_B4AwM.js";import"./vendor-micromark-factory-title-D-E2MfTG.js";import"./vendor-micromark-factory-whitespace-D8F2YPRT.js";import"./vendor-micromark-util-html-tag-name-DbKNfynz.js";import"./vendor-mdast-util-to-string-C_aolqmU.js";import"./vendor-remark-rehype-Eq-g-hA4.js";import"./vendor-mdast-util-to-hast-B4KFU5Q1.js";import"./vendor-ungap--gfxRhYI.js";import"./vendor-micromark-util-sanitize-uri-B-zxHmez.js";import"./vendor-unist-util-position-60F3QETU.js";import"./vendor-trim-lines-D8znQY54.js";import"./vendor-unist-util-visit-DyPrGnGc.js";import"./vendor-unist-util-visit-parents-CHe-IBUw.js";import"./vendor-unist-util-is-D9KQvrmg.js";import"./vendor-hast-util-to-jsx-runtime-48tnp6nG.js";import"./vendor-comma-separated-tokens-xMQ5YY98.js";import"./vendor-property-information-Bx45xMUt.js";import"./vendor-space-separated-tokens-DD3iYX1K.js";import"./vendor-style-to-js-CGcDVYOI.js";import"./vendor-style-to-object-COD_8__P.js";import"./vendor-inline-style-parser-CWBJcU5N.js";import"./vendor-hast-util-whitespace-D4Wp6AEg.js";import"./vendor-estree-util-is-identifier-name-BgBfM8ME.js";import"./vendor-html-url-attributes-D46m5wfe.js";import"./vendor-prism-DmEJSkZI.js";import"./vendor-html2canvas-BfYXEYrK.js";import"./vendor-i18next-BnqEsHlA.js";import"./vendor-i18next-browser-languagedetector-ClvlpAgo.js";function qt({shell:b,path:g,onExit:S}){const{t:m}=E(),h=y.useRef(null),p=y.useRef(null),j=y.useRef(null),u=y.useRef(null);return y.useEffect(()=>{if(!h.current)return;const t=new A.Terminal({cols:80,rows:24}),i=new L;t.loadAddon(i),t.open(h.current),i.fit(),j.current=i,p.current=t;let a=null,s=null;const v=(r,o)=>{s=r,u.current=r,s.binaryType="arraybuffer",s.onopen=()=>{t.write(`\r
`+o+`\r
`);try{const e={type:"resize",cols:t.cols||80,rows:t.rows||24};s&&s.send(JSON.stringify(e))}catch{}},s.onmessage=e=>{const f=typeof e.data=="string"?e.data:new TextDecoder().decode(e.data);t.write(f)},s.onclose=()=>{try{u.current&&(u.current=null)}catch{}if(S)try{S()}catch{}},t.onData(e=>{s&&s.readyState===WebSocket.OPEN&&s.send(e)})};(async r=>{try{const o=await D(r);return o&&o.isDir?r:o&&!o.isDir?r.replace(/\/[^/]*$/,"")||"/":r}catch{return r}})(g).then(r=>{const o=localStorage.getItem("mlcremote_token"),e=(l,d,w)=>{let n;try{n=new URL(l)}catch{n=new URL(l,location.origin)}n.protocol==="https:"?n.protocol="wss:":n.protocol==="http:"&&(n.protocol="ws:");const T=n.pathname.endsWith("/")?n.pathname.slice(0,-1):n.pathname,O=d.startsWith("/")?d:"/"+d;return n.pathname=T+O,Object.entries(w).forEach(([k,W])=>{n.searchParams.set(k,W)}),n.toString()},f=U()||location.origin,_="/ws/terminal",x={shell:b,cwd:r};o&&(x.token=o);const P=new URLSearchParams(x);C(`/api/terminal/new?${P.toString()}`).then(l=>l.json()).then(l=>{a=l.id;const d={...x,session:a||""},w=e(f,_,d),n=new WebSocket(w);v(n,m("terminal_connected_session",{id:a}))}).catch(()=>{const l={...x},d=e(f,_,l),w=new WebSocket(d);v(w,m("terminal_connected_ephemeral"))})});const N=()=>{var r;try{(r=j.current)==null||r.fit();const o=p.current,e=u.current;if(!o||!e||e.readyState!==WebSocket.OPEN)return;const f={type:"resize",cols:o.cols||80,rows:o.rows||24};e.send(JSON.stringify(f))}catch{}},R=new ResizeObserver(()=>{requestAnimationFrame(()=>N())});return h.current&&R.observe(h.current),()=>{R.disconnect();try{s&&s.close()}catch{}u.current=null;try{t.dispose()}catch{}}},[b,g,m]),c.jsxs("div",{className:"terminal-root",style:{display:"flex",flexDirection:"column",height:"100%"},children:[c.jsxs("div",{className:"editor-header",children:[c.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},children:[c.jsx(I,{name:z("terminal"),size:14}),c.jsx("strong",{children:m("terminal")})]}),c.jsx("div",{style:{display:"flex",flexDirection:"column"},children:c.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:c.jsx("span",{className:"muted",children:g})})}),c.jsxs("div",{className:"actions",children:[c.jsx("button",{className:"link",onClick:async()=>{var t;try{const i=p.current&&p.current.getSelection&&p.current.getSelection()||((t=window.getSelection())==null?void 0:t.toString())||"";if(!i)return;if(navigator.clipboard&&navigator.clipboard.writeText)await navigator.clipboard.writeText(i);else{const a=document.createElement("textarea");a.value=i,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a)}}catch(i){console.warn("copy failed",i)}},children:m("copy")}),c.jsx("button",{className:"link",onClick:async()=>{try{let t="";if(navigator.clipboard&&navigator.clipboard.readText?t=await navigator.clipboard.readText():t=window.prompt(m("paste_text_here"))||"",!t)return;const i=u.current;i&&i.readyState===WebSocket.OPEN?i.send(t):p.current&&p.current.write(t)}catch(t){console.warn("paste failed",t)}},children:m("paste")})]})]}),c.jsx("div",{className:"terminal-body",ref:h})]})}export{qt as default};
