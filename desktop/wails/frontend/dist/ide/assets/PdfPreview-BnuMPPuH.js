import{_ as y,a as P,m as b}from"./index-D8pYI_Vd.js";import{u as k,R as n,j as a}from"./vendor-react-DgaSUS5F.js";import"./vendor-prism-D73ALYcd.js";import"./vendor-html2canvas-BfYXEYrK.js";import"./vendor-xterm-DOcMqDAd.js";import"./vendor-i18next-BnqEsHlA.js";import"./vendor-i18next-browser-languagedetector-ClvlpAgo.js";import"./vendor-scheduler-DYLXRpC5.js";function I({path:d}){const{t:s}=k(),[c,g]=n.useState(null),[r,h]=n.useState(null),[o,m]=n.useState(1),[i,w]=n.useState(null),[j,x]=n.useState(!1),p=n.useRef(null);return n.useEffect(()=>{let e=!0;return(async()=>{try{const t=await y(()=>import("./vendor-pdfjs-dist-0-P3jM28GC.js"),[],import.meta.url);if(t.GlobalWorkerOptions.workerSrc="/pdf.worker.mjs",!e)return;g(t)}catch(t){console.error("Failed to load pdfjs",t)}})(),()=>{e=!1}},[]),n.useEffect(()=>{if(!c)return;let e=!1;return(async()=>{x(!0);try{const t=await P(`/api/file?path=${encodeURIComponent(d)}`);if(!t.ok)throw new Error("fetch failed");const l=await t.arrayBuffer(),f=await c.getDocument({data:l}).promise;if(e)return;h(f),w(f.numPages||null),m(1)}catch(t){console.error("Failed to load PDF",t),e||h(null)}finally{e||x(!1)}})(),()=>{e=!0}},[c,d]),n.useEffect(()=>{if(!r||!p.current)return;let e=!0;return(async()=>{try{const t=await r.getPage(o),l=t.getViewport({scale:1.25}),u=p.current,f=u.getContext("2d");u.width=Math.min(l.width,window.innerWidth*.9),u.height=l.height;const v={canvasContext:f,viewport:l};await t.render(v).promise}catch(t){e&&console.error("PDF render failed",t)}})(),()=>{e=!1}},[r,o]),c?j&&!r?a.jsx("div",{className:"muted",children:s("loading_pdf")}):a.jsxs("div",{style:{padding:12},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("button",{className:"btn",onClick:()=>m(e=>Math.max(1,e-1)),disabled:o<=1,children:s("previous")}),a.jsxs("span",{children:[o,i?` / ${i} `:""]}),a.jsx("button",{className:"btn",onClick:()=>m(e=>Math.min(i||1/0,e+1)),disabled:i?o>=i:!1,children:s("next")}),a.jsx("a",{className:"link",href:b(`/api/file?path=${encodeURIComponent(d)}`),download:d.split("/").pop(),children:s("download")})]}),a.jsx("div",{style:{marginTop:8},children:r?a.jsx("canvas",{ref:p,style:{maxWidth:"100%",borderRadius:6,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}):a.jsx("div",{className:"muted",children:s("no_preview")})})]}):a.jsx("div",{className:"muted",children:s("loading_pdf_support")})}export{I as default};
