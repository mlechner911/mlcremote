const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PdfPreview-iir0z1PV.js","./vendor-react-BXEsipma.js","./vendor-scheduler-CWG1rEj-.js","./vendor-prism-DbuqXO-2.js","./vendor-prism-Cg1sXqY3.css","./vendor-html2canvas-k0ITeQhV.js","./vendor-xterm-BXin3HzJ.js","./vendor-xterm-DFuMZ0ql.css","./ShellView-aIUta99y.js","./TerminalTab-BanViR7o.js"])))=>i.map(i=>d[i]);
import{r as X,R as s,j as e,c as wt}from"./vendor-react-BXEsipma.js";import{P as Ae}from"./vendor-prism-DbuqXO-2.js";import{h as jt}from"./vendor-html2canvas-k0ITeQhV.js";import"./vendor-xterm-BXin3HzJ.js";import"./vendor-scheduler-CWG1rEj-.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const u of o)if(u.type==="childList")for(const c of u.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function i(o){const u={};return o.integrity&&(u.integrity=o.integrity),o.referrerPolicy&&(u.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?u.credentials="include":o.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(o){if(o.ep)return;o.ep=!0;const u=i(o);fetch(o.href,u)}})();const bt="modulepreload",kt=function(t,n){return new URL(t,n).href},et={},Re=function(n,i,r){let o=Promise.resolve();if(i&&i.length>0){let w=function(C){return Promise.all(C.map(b=>Promise.resolve(b).then(R=>({status:"fulfilled",value:R}),R=>({status:"rejected",reason:R}))))};const c=document.getElementsByTagName("link"),d=document.querySelector("meta[property=csp-nonce]"),h=d?.nonce||d?.getAttribute("nonce");o=w(i.map(C=>{if(C=kt(C,r),C in et)return;et[C]=!0;const b=C.endsWith(".css"),R=b?'[rel="stylesheet"]':"";if(r)for(let _=c.length-1;_>=0;_--){const $=c[_];if($.href===C&&(!b||$.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${C}"]${R}`))return;const g=document.createElement("link");if(g.rel=b?"stylesheet":bt,b||(g.as="script"),g.crossOrigin="",g.href=C,h&&g.setAttribute("nonce",h),document.head.appendChild(g),b)return new Promise((_,$)=>{g.addEventListener("load",_),g.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${C}`)))})}))}function u(c){const d=new Event("vite:preloadError",{cancelable:!0});if(d.payload=c,window.dispatchEvent(d),!d.defaultPrevented)throw c}return o.then(c=>{for(const d of c||[])d.status==="rejected"&&u(d.reason);return n().catch(u)})},St=200,ke=[],Se=[];function nt(t,n){const i={ts:new Date().toISOString(),level:t,msg:n};for(ke.push(i);ke.length>St;)ke.shift();Se.forEach(r=>r())}function G(t){nt("info",t)}function Ce(t){nt("warn",t)}function Ct(){return ke.slice().reverse()}function Lt(t){return Se.push(t),()=>{const n=Se.indexOf(t);n>=0&&Se.splice(n,1)}}function Et(){ke.length=0,Se.forEach(t=>t())}function He(){try{return localStorage.getItem("mlcremote_token")}catch{return null}}function st(t){try{localStorage.setItem("mlcremote_token",t)}catch{}}let Te="";function Nt(t){Te=t.replace(/\/$/,"")}function In(){return Te}function Le(t){return!Te||typeof t!="string"||t.startsWith("http")?t:`${Te}${t}`}async function ie(t,n){const i=He(),r=new Headers(n?.headers);i&&r.set("X-Auth-Token",i);const o={...n||{},headers:r};let u=t;typeof t=="string"&&t.startsWith("/")&&(u=Le(t));const c=await fetch(u,o);if(c.status===401){try{localStorage.removeItem("mlcremote_token")}catch{}try{window.dispatchEvent(new CustomEvent("mlcremote:auth-failed",{detail:{url:typeof t=="string"?t:t.url}}))}catch{}}return c}async function Tt(t){G("POST /api/login");const n=await fetch(Le("/api/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})});if(G(`/api/login => ${n.status}`),!n.ok)throw new Error("login failed");const i=await n.json();if(i&&i.token)return st(i.token),i.token;throw new Error("no token in response")}async function Rt(){G("GET /health");const t=await ie("/health");if(G(`/health => ${t.status}`),!t.ok)throw Ce("/health not ok"),new Error("health failed");return t.json()}function Be(){try{const t=new URLSearchParams(window.location.search),n=t.get("token");n&&st(n);const i=t.get("api");return i&&Nt(i),!!n}catch{}return!1}async function It(){try{return(await ie("/api/auth/check")).status===200}catch{return!1}}async function rt(t="",n){const i=new URLSearchParams;t&&i.set("path",t),n?.showHidden&&i.set("showHidden","1");const r=i.toString()?`?${i.toString()}`:"";G(`GET /api/tree${r}`);const o=await ie(`/api/tree${r}`);if(G(`/api/tree${r} => ${o.status}`),!o.ok)throw Ce("/api/tree not ok"),new Error("tree failed");return o.json()}async function Dt(t){G(`GET /api/file?path=${t}`);const n=await ie(`/api/file?path=${encodeURIComponent(t)}`);if(G(`/api/file?path=${t} => ${n.status}`),!n.ok)throw Ce("/api/file read failed"),new Error("read failed");return n.text()}async function pe(t){G(`GET /api/stat?path=${t}`);const n=await ie(`/api/stat?path=${encodeURIComponent(t)}`);if(G(`/api/stat?path=${t} => ${n.status}`),!n.ok)throw new Error("stat failed");return n.json()}async function zt(t,n){G(`POST /api/file path=${t} size=${n.length}`);const i=await ie("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,content:n})});if(G(`/api/file POST => ${i.status}`),!i.ok)throw Ce("/api/file save failed"),new Error("save failed")}async function $t(t){G(`DELETE /api/file?path=${t}`);const n=await ie(`/api/file?path=${encodeURIComponent(t)}`,{method:"DELETE"});if(G(`/api/file delete => ${n.status}`),!n.ok)throw Ce("/api/file delete failed"),new Error("delete failed")}const it=X.createContext(null);function Mt({children:t}){const[n,i]=X.useState(null),[r,o]=X.useState(null),[u,c]=X.useState(navigator.onLine),[d,h]=X.useState(!1),[w,C]=X.useState(!1),[b,R]=X.useState(!1);s.useState(()=>{if(typeof window>"u")return;const B=new URLSearchParams(window.location.search).get("token");if(B){console.log("[Auth] Token found in URL (sync init):",B),localStorage.setItem("mlcremote_token",B);const q=window.location.protocol+"//"+window.location.host+window.location.pathname;window.history.replaceState({path:q},"",q)}});const g=X.useCallback(async()=>{if(navigator.onLine)try{const N=await Rt();i(N),o(Date.now()),await It()||(localStorage.removeItem("mlcremote_token"),N.password_auth?h(!0):N.auth_required&&C(!0))}catch{i(null)}},[]);X.useEffect(()=>{const N=()=>{c(!0),g()},B=()=>{c(!1),i(null)};window.addEventListener("online",N),window.addEventListener("offline",B);const q=setInterval(g,60*1e3);g();const O=()=>R(!0);return window.addEventListener("mlcremote:auth-failed",O),()=>{window.removeEventListener("online",N),window.removeEventListener("offline",B),window.removeEventListener("mlcremote:auth-failed",O),clearInterval(q)}},[g]),X.useEffect(()=>{if(!n){R(!1);return}const N=!!n.password_auth,B=!!n.auth_required&&!n.password_auth,q=localStorage.getItem("mlcremote_token");R(!!((N||B)&&!q))},[n]);const _=async N=>{await Tt(N),await g(),h(!1),R(!1)},$=N=>{localStorage.setItem("mlcremote_token",N),g(),C(!1),R(!1)},j=()=>{localStorage.removeItem("mlcremote_token"),g()};return e.jsx(it.Provider,{value:{health:n,isOnline:u,lastHealthAt:r,refreshHealth:g,login:_,setToken:$,logout:j,showLogin:d,setShowLogin:h,showTokenInput:w,setShowTokenInput:C,showAuthChooser:b,setShowAuthChooser:R},children:t})}function Pt(){const t=X.useContext(it);if(!t)throw new Error("useAuth must be used within AuthProvider");return t}const I=({name:t,className:n,title:i,size:r=16})=>{if(!t)return null;const o=`#${t}`;return e.jsxs("svg",{className:n,width:r,height:r,"aria-hidden":i?void 0:"true",role:i?"img":void 0,children:[i?e.jsx("title",{children:i}):null,e.jsx("use",{href:o})]})},_t={home:"icon-home",sun:"icon-sun",markdown:"icon-markdown",tar:"icon-archive",refresh:"icon-refresh",link:"icon-link",stop:"icon-stop",search:"icon-search",cr:"icon-chevron-right",upload:"icon-upload",close:"icon-close",bz2:"icon-archive",pdf:"icon-pdf",txt:"icon-text",gz:"icon-archive",js:"icon-js",mjs:"icon-js",jpg:"icon-image",jpeg:"icon-image",cfg:"icon-settings",x:"icon-close",shell:"icon-terminal",cl:"icon-chevron-left",user:"icon-user",server:"icon-server",md:"icon-markdown",run:"icon-play",view:"icon-view",moon:"icon-moon",zip:"icon-archive",json:"icon-json",info:"icon-info",warn:"icon-warning",up:"icon-up",screenshot:"icon-screenshot",log:"icon-log",trash:"icon-trash",download:"icon-download",settings:"icon-settings",sh:"icon-terminal",png:"icon-image",svg:"icon-image",copy:"icon-copy",dir:"icon-folder",gif:"icon-image",plus:"icon-plus",minus:"icon-minus"};function ge(t){if(t)return _t[t.toLowerCase()]}function at(t,n){if(n){const i=n.lastIndexOf(".");if(i>=0&&i<n.length-1){const r=n.slice(i+1).toLowerCase();return ge(r)}}}const F=t=>"icon-"+t;function Ot({x:t,y:n,items:i,onClose:r}){const o=s.useRef(null);s.useEffect(()=>{function d(h){o.current&&!o.current.contains(h.target)&&r()}return window.addEventListener("mousedown",d),window.addEventListener("scroll",r,!0),window.addEventListener("resize",r),()=>{window.removeEventListener("mousedown",d),window.removeEventListener("scroll",r,!0),window.removeEventListener("resize",r)}},[r]);const[u,c]=s.useState({x:t,y:n});return s.useLayoutEffect(()=>{if(o.current){const d=o.current.getBoundingClientRect();let h=t,w=n;h+d.width>window.innerWidth&&(h=window.innerWidth-d.width-8),w+d.height>window.innerHeight&&(w=window.innerHeight-d.height-8),c({x:h,y:w})}},[t,n]),e.jsx("div",{ref:o,style:{position:"fixed",left:u.x,top:u.y,background:"var(--panel)",border:"1px solid var(--border)",boxShadow:"0 4px 12px rgba(0,0,0,0.3)",borderRadius:6,padding:4,zIndex:99999,minWidth:160,display:"flex",flexDirection:"column"},onContextMenu:d=>{d.preventDefault(),r()},children:i.map((d,h)=>d.separator?e.jsx("div",{style:{height:1,background:"var(--border)",margin:"4px 0"}},h):e.jsxs("button",{className:"context-menu-item",onClick:()=>{r(),d.action()},style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",border:"none",background:"transparent",color:d.danger?"var(--danger)":"var(--text)",cursor:"pointer",textAlign:"left",borderRadius:4,fontSize:13},onMouseEnter:w=>w.currentTarget.style.background=d.danger?"rgba(239,68,68,0.1)":"var(--bg)",onMouseLeave:w=>w.currentTarget.style.background="transparent",children:[d.icon&&e.jsx("span",{style:{width:16,display:"flex"},children:d.icon}),d.label]},h))})}function Ft({onSelect:t,showHidden:n,onToggleHidden:i,autoOpen:r=!0,onView:o,onBackendActive:u,onChangeRoot:c,canChangeRoot:d,selectedPath:h,activeDir:w,onDirChange:C,focusRequest:b,reloadSignal:R}){const[g,_]=s.useState(""),[$,j]=s.useState([]),[N,B]=s.useState(!1),[q,O]=s.useState(""),[fe,te]=s.useState(null),[ae,oe]=s.useState(!1),[f,T]=s.useState(null),v=s.useCallback(async l=>{B(!0),O("");try{const L=await rt(l,{showHidden:n});j(L),_(l);try{W.current!==l&&(C?.(l),W.current=l)}catch{}u?.();try{const H=de.current;H&&requestAnimationFrame(()=>{const A=J.current;if(A)try{const se=A.querySelector(`[data-path="${CSS.escape(H)}"]`);se&&(se.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),se.focus())}catch{}})}catch{}}catch(L){O(L.message||"failed to list")}finally{B(!1)}},[n,u,C]),W=s.useRef("");s.useEffect(()=>{typeof w>"u"||w!==g&&v(w)},[w,g,v]),s.useEffect(()=>{v("")},[v]),s.useEffect(()=>{v(g||"")},[g,v,R]);const S=()=>{if(!g||g==="/"){v("");return}const l=g.split("/").filter(Boolean);l.pop();const L=`/${l.join("/")}`;v(L||"")},M=async(l,L)=>{if(!(!L||L.length===0)){oe(!0),O("");try{const H=new FormData;for(let Y=0;Y<L.length;Y++)H.append("file",L[Y],L[Y].name);const A=`?path=${encodeURIComponent(l)}`;if(!(await ie(`/api/upload${A}`,{method:"POST",body:H})).ok)throw new Error("upload failed");await v(l)}catch(H){O(H.message||"upload failed")}finally{oe(!1)}}},U=(l,L)=>{l.preventDefault(),te(null),M(L,l.dataTransfer.files)},K=(l,L)=>{l.preventDefault(),te(L)},ne=l=>{l.preventDefault(),te(null)},J=s.useRef(null),de=s.useRef("");s.useEffect(()=>{de.current=h||""},[h]),s.useEffect(()=>{if(h)try{const l=J.current;if(!l)return;const L=l.querySelector(`li[key="${CSS.escape(h)}"]`),H=l.querySelector(`[data-path="${h}"]`),A=L||H;if(A){A.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"});const se=A.querySelector("button.entry");se&&se.focus()}}catch{}},[h,g]),s.useEffect(()=>{if(b)try{const l=h||"";if(!l)return;const L=J.current;if(!L)return;const H=CSS.escape(l),A=L.querySelector(`[data-path="${H}"]`);A&&(A.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),A.focus())}catch{}},[b]);const ve=async l=>{if(confirm(`Are you sure you want to delete ${l}?`))try{await $t(l),v(g)}catch(L){alert("Delete failed: "+L.message)}},xe=(l,L)=>{l.preventDefault(),l.stopPropagation(),T({x:l.clientX,y:l.clientY,item:L})};return e.jsxs("div",{className:"explorer",children:[e.jsxs("div",{className:"explorer-header",children:[e.jsx("strong",{className:"hidden",children:e.jsx(I,{name:F("dir")})}),e.jsxs("div",{className:"explorer-controls",children:[e.jsx("button",{className:"link icon-btn",title:"Refresh",onClick:()=>v(g||""),children:e.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M23 4v6h-6"}),e.jsx("path",{d:"M1 20v-6h6"}),e.jsx("path",{d:"M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"})]})}),d&&typeof c=="function"&&e.jsx("button",{className:"link icon-btn","aria-label":"Change root",title:"Change root",onClick:async()=>{try{const l=await Promise.resolve(c(""))}catch{}},children:e.jsx(I,{name:F("dir")})})]}),e.jsxs("div",{className:"breadcrumbs",children:[e.jsx("button",{type:"button",className:"link",onClick:()=>v(""),children:"root"}),g&&g.split("/").filter(Boolean).map((l,L,H)=>{const A=`/${H.slice(0,L+1).join("/")}`;return e.jsxs("span",{children:[" / ",e.jsx("button",{className:"link",onClick:()=>v(A),children:l})]},A)})]})]}),e.jsxs("div",{className:"explorer-body",onDrop:l=>U(l,g||""),onDragOver:l=>K(l,g||""),onDragLeave:ne,children:[N&&e.jsx("div",{className:"muted",children:"Loading..."}),q&&e.jsx("div",{className:"error",children:q}),ae&&e.jsx("div",{className:"muted",children:"Uploading..."}),!N&&!q&&e.jsxs("ul",{className:"entry-list",ref:J,children:[g&&g!=="/"&&e.jsx("li",{children:e.jsx("button",{type:"button",className:"entry",onClick:S,children:".."})},"up"),$.map(l=>e.jsx("li",{onContextMenu:L=>xe(L,l),children:l.isDir?e.jsxs("button",{"data-path":l.path,type:"button",className:"entry"+(h===l.path?" selected":""),onClick:()=>{v(l.path),t(l.path,!0)},onDrop:L=>U(L,l.path),onDragOver:L=>K(L,l.path),onDragLeave:ne,children:[e.jsx("span",{className:"icon",children:e.jsx(I,{name:ge("dir")||F("dir")})})," ",l.name,l.isSymlink&&e.jsx("span",{title:"Symbolic Link",style:{marginLeft:4,opacity:.5},children:"ðŸ”—"}),l.isBroken&&e.jsx("span",{title:"Broken Link",style:{marginLeft:4},children:"âŒ"}),l.isExternal&&e.jsx("span",{title:"External Link",style:{marginLeft:4},children:"â†—ï¸"}),fe===l.path?e.jsx("span",{style:{marginLeft:8,fontSize:12,color:"#888"},children:"Drop to upload"}):null]}):e.jsxs("div",{style:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs("button",{"data-path":l.path,type:"button",className:"entry",style:{flex:1,textAlign:"left"},onClick:()=>{if(r===!1){t(l.path,!1);return}t(l.path,!1)},children:[e.jsx("span",{className:"icon",children:e.jsx(I,{name:at(void 0,l.name)||ge(l.name.split(".").pop()||"")||F("view")||"icon-text"})})," ",l.name,l.isSymlink&&e.jsx("span",{title:"Symbolic Link",style:{marginLeft:4,opacity:.5},children:"ðŸ”—"}),l.isBroken&&e.jsx("span",{title:"Broken Link",style:{marginLeft:4},children:"âŒ"}),l.isExternal&&e.jsx("span",{title:"External Link",style:{marginLeft:4},children:"â†—ï¸"})]}),r?null:e.jsx("button",{className:"btn",onClick:()=>o?o(l.path):t(l.path,!1),title:"View file",children:e.jsx(I,{name:F("view")})})]})},l.path))]})]}),f&&e.jsx(Ot,{x:f.x,y:f.y,onClose:()=>T(null),items:[{label:"Open",icon:e.jsx(I,{name:F("view")}),action:()=>{f.item.isDir?(v(f.item.path),t(f.item.path,!0)):r?t(f.item.path,!1):o?o(f.item.path):t(f.item.path,!1)}},{label:"Download",icon:e.jsx(I,{name:F("download")}),action:()=>{const l=document.createElement("a");l.href=Le(`/api/file?path=${encodeURIComponent(f.item.path)}${localStorage.getItem("mlcremote_token")?`&token=${encodeURIComponent(localStorage.getItem("mlcremote_token")||"")}`:""}`),l.download=f.item.name,document.body.appendChild(l),l.click(),document.body.removeChild(l)},separator:!0},{label:"Copy Full Path",icon:e.jsx(I,{name:F("copy")}),action:async()=>{try{await navigator.clipboard.writeText(f.item.path)}catch(l){console.error("Failed to copy",l)}}},{label:"Copy Relative Path",icon:e.jsx(I,{name:F("link")}),action:async()=>{try{const l=f.item.path.startsWith("/")?f.item.path.slice(1):f.item.path;await navigator.clipboard.writeText(l)}catch(l){console.error("Failed to copy",l)}}},{label:"Copy Name",icon:e.jsx(I,{name:F("text")}),action:async()=>{try{await navigator.clipboard.writeText(f.item.name)}catch(l){console.error(l)}},separator:!0},{label:"Delete",icon:e.jsx(I,{name:F("trash")}),danger:!0,action:()=>ve(f.item.path)}].filter(l=>!(l.label==="Download"&&f.item.isDir))})]})}function Bt({autoOpen:t,showHidden:n,onToggleAutoOpen:i,onToggleShowHidden:r,showLogs:o,onToggleLogs:u,hideMemoryUsage:c,onToggleHideMemoryUsage:d,onClose:h}){const[w,C]=X.useState(c);return e.jsx("div",{style:{position:"absolute",right:12,top:40,zIndex:60},children:e.jsxs("div",{style:{width:320,background:"var(--bg)",border:"1px solid var(--muted)",borderRadius:6,boxShadow:"0 6px 20px rgba(0,0,0,0.12)",padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Settings"}),e.jsx("button",{"aria-label":"Close settings",title:"Close",onClick:h,style:{background:"transparent",border:"none",cursor:"pointer"},children:e.jsx(I,{name:F("close"),title:"Close",size:16})})]}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:t,onChange:b=>i(b.target.checked)})," ","Auto open files"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:n,onChange:b=>r(b.target.checked)})," ","Show hidden files"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:o,onChange:b=>u(b.target.checked)})," Show server logs"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:w,onChange:b=>{C(b.target.checked),d(b.target.checked)}})," Hide memory usage gauge"]})})]})})}function Wt(){const[t,n]=s.useState(null),[i,r]=s.useState(!1),o=s.useCallback(async()=>{r(!0);try{const d=await ie("/api/trash/recent");if(!d.ok)throw new Error("fetch failed");const h=await d.json();Array.isArray(h)&&h.length>0?n(h[0]):n(null)}catch(d){console.warn("Failed to fetch trash",d)}finally{r(!1)}},[]);if(s.useEffect(()=>{o();const d=setInterval(o,1e4);return()=>clearInterval(d)},[o]),i&&!t)return e.jsx("div",{className:"muted",children:"Loading trashâ€¦"});if(!t)return e.jsx("div",{className:"muted",children:"Trash is empty"});const u=t.originalPath.split("/").pop()||t.originalPath,c=at(void 0,u)||ge(u.split(".").pop()||"")||"icon-trash";return e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx(I,{name:c,size:20}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{fontWeight:600},children:u}),e.jsx("div",{className:"muted",style:{fontSize:12},children:new Date(t.deletedAt).toLocaleString()})]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsxs("div",{className:"muted",children:["Original path: ",t.originalPath]}),e.jsxs("div",{className:"muted",children:["Trash path: ",t.trashPath]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("button",{className:"btn",disabled:!0,children:"Undo (coming)"}),(()=>{const d=He(),h=`/ api / file ? path = ${encodeURIComponent(t.trashPath)} `+(d?` & token=${encodeURIComponent(d)} `:"");return e.jsx("a",{className:"btn",style:{marginLeft:8},href:h,download:u,children:"Download"})})()]})]})}function he(t){if(!t||t<=0)return"0 B";const n=1024,i=n*1024,r=i*1024;return t>=r?`${(t/r).toFixed(2)} GB`:t>=i?`${(t/i).toFixed(2)} MB`:t>=n?`${(t/n).toFixed(2)} KB`:`${t} B`}const At=new Set(["txt","md","markdown","yaml","yml","json","js","ts","jsx","tsx","html","css","env","ini","cfg","conf","csh","gitignore","dockerfile","sql"]),Ht=new Set(["zip","gz","tar","rar","exe","dll","so","bin","jpg","jpeg","png","gif","webp","pdf"]);function Ue(t){const n=t.split("/"),i=n[n.length-1]||"",r=i.lastIndexOf(".");return r===-1?"":i.slice(r+1).toLowerCase()}function Ut(t){const n=Ue(t);return!n||At.has(n)?!0:!Ht.has(n)}async function Vt(t){if(!t)return{mime:"application/octet-stream",isText:!1,ext:""};try{const n=`?path=${encodeURIComponent(t)}`,i=await ie(`/api/filetype${n}`);if(!i.ok)throw new Error("probe failed");return await i.json()}catch{const i=Ue(t);return{mime:"application/octet-stream",isText:Ut(t),ext:i}}}function qt(t){if(!t)return null;const n=t.split("/"),r=(n[n.length-1]||"").toLowerCase();return r===".bashrc"||r==="bashrc"||r===".bash_profile"||r===".profile"?"bashrc":r===".zshrc"||r==="zshrc"?"zshrc":r===".bash_history"||r==="bash_history"?"bash_history":r==="makefile"?"makefile":r==="dockerfile"?"dockerfile":r==="nginx.conf"||r==="nginx.conf.default"?"conf":null}function Xt(t){const n=Ae.languages;switch(t){case"jsx":return n.jsx;case"tsx":return n.tsx;case"java":return n.java;case"ini":return n.ini;case"js":return n.javascript;case"ts":return n.typescript;case"go":return n.go;case"php":return n.php;case"json":return n.json;case"yaml":case"yml":return n.yaml;case"toml":return n.toml||n.markup;case"md":case"markdown":return n.markdown;case"c":case"h":return n.c;case"cpp":case"hpp":return n.cpp;case"py":return n.python;case"makefile":return n.makefile;case"bashrc":case"zshrc":case"bash_history":case"profile":return n.bash;case"sh":case"bash":return n.bash;case"xml":case"xml-doc":return n["xml-doc"];case"html":case"htm":return n.markup;case"css":case"sass":case"scss":return n.sass;case"sql":return n.sql;default:return n.javascript}}function be(t){switch(t){case"js":case"jsx":return"javascript";case"ts":case"tsx":return"typescript";case"go":return"go";case"php":return"php";case"json":return"json";case"yaml":case"yml":return"yaml";case"toml":return"toml";case"ini":return"ini";case"md":case"markdown":return"markdown";case"c":case"h":return"c";case"cpp":case"cxx":case"c++":case"hpp":return"cpp";case"py":return"python";case"makefile":return"makefile";case"dockerfile":return"dockerfile";case"sh":case"bash":case"csh":return"bash";case"bashrc":case"zshrc":case"bash_history":case"profile":return"bash";case"xml":case"xml-doc":return"xml-doc";case"html":case"htm":return"markup";case"sass":case"scss":return"sass";case"sql":return"sql";case"less":case"css":return"css";default:return"text"}}function tt(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function Kt(t,n){try{const i=Xt(n),r=be(n);return i?Ae.highlight(t,i,r):tt(t)}catch(i){return console.warn("Prism highlight failed",i),tt(t)}}function Yt({content:t,setContent:n,origContent:i,ext:r,alias:o,textareaId:u}){const c=s.useRef(null),d=s.useRef(null);return s.useEffect(()=>{const h=o||be(r);d.current&&d.current.setAttribute("data-grammar",h),c.current&&c.current.setAttribute("data-grammar",h);try{const w=d.current?.querySelector("code");w&&Ae.highlightElement(w)}catch{}},[o,t,r]),s.useEffect(()=>{c.current&&d.current&&(d.current.scrollTop=c.current.scrollTop,d.current.scrollLeft=c.current.scrollLeft)},[t]),e.jsxs("div",{className:"editor-edit-area",children:[e.jsx("pre",{"aria-hidden":!0,className:`highlight-wrap language-${o||be(r)}`,"data-grammar":o||be(r),ref:h=>{d.current=h},children:e.jsx("code",{className:`language-${o||be(r)}`,dangerouslySetInnerHTML:{__html:Kt(t||"",r)}})}),e.jsx("textarea",{ref:c,className:"textarea",wrap:"off",value:t,name:u||"editor",id:u,"data-grammar":o,onChange:h=>n(h.target.value),onScroll:()=>{c.current&&d.current&&(d.current.scrollTop=c.current.scrollTop,d.current.scrollLeft=c.current.scrollLeft)},placeholder:"Open or create a file to edit",spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",autoComplete:"off"})]})}function Gt({path:t,onDimensions:n}){const i=He(),r=Le(`/api/file?path=${encodeURIComponent(t)}${i?`&token=${encodeURIComponent(i)}`:""}`),[o,u]=s.useState(null),c=s.useRef(null);return e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"},children:e.jsx("img",{ref:c,src:r,alt:t.split("/").pop(),style:{maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",borderRadius:6,boxShadow:"0 2px 8px rgba(0,0,0,0.4)"},onLoad:()=>{try{const d=c.current;if(d&&d.naturalWidth&&d.naturalHeight){u({w:d.naturalWidth,h:d.naturalHeight});try{n&&n(d.naturalWidth,d.naturalHeight)}catch{}}}catch{}}})}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("a",{className:"link",href:r,download:t.split("/").pop(),children:"Download"}),o?e.jsxs("span",{className:"muted",style:{marginLeft:8},children:[o.w," Ã— ",o.h]}):null]})]})}const Jt=s.lazy(()=>Re(()=>import("./PdfPreview-iir0z1PV.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url));function Qt({path:t}){return e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading PDF previewâ€¦"}),children:e.jsx(Jt,{path:t})})}const Zt=s.lazy(()=>Re(()=>import("./ShellView-aIUta99y.js"),__vite__mapDeps([8,1,2,3,4,9,6,7,5]),import.meta.url)),en={name:"Shell",priority:100,matches:t=>!!(t.path&&t.path.startsWith("shell-")),view:({path:t})=>e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading shellâ€¦"}),children:e.jsx(Zt,{path:t})}),isEditable:!1},tn={name:"Directory",priority:90,matches:t=>!!(t.meta&&t.meta.isDir),view:({path:t,origContent:n})=>e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{fontWeight:600},children:["Directory: ",t]}),e.jsxs("div",{className:"muted",style:{marginTop:6},children:[n?n.split(`
`).length:"0"," entries"]}),e.jsx("pre",{style:{marginTop:8,maxHeight:240,overflow:"auto",padding:8,background:"var(--panel)"},children:n})]}),isEditable:!1},nn={name:"PDF",priority:80,matches:t=>t.probe&&t.probe.mime==="application/pdf"||!!t.path&&t.path.toLowerCase().endsWith(".pdf"),view:({path:t})=>e.jsx(Qt,{path:t}),isEditable:!1},sn={name:"Image",priority:70,matches:t=>{if(t.probe&&t.probe.mime&&t.probe.mime.startsWith("image/"))return!0;if(t.path){const n=t.path.toLowerCase();return n.endsWith(".png")||n.endsWith(".jpg")||n.endsWith(".jpeg")||n.endsWith(".gif")||n.endsWith(".svg")||n.endsWith(".webp")}return!1},view:({path:t,onDimensions:n})=>e.jsx(Gt,{path:t,onDimensions:n}),isEditable:!1},rn={name:"Text",priority:50,matches:t=>{if(t.probe&&t.probe.isText)return!0;if(t.path){const n=t.path.toLowerCase();return n.endsWith(".md")||n.endsWith(".txt")||n.endsWith(".json")||n.endsWith(".js")||n.endsWith(".ts")||n.endsWith(".tsx")||n.endsWith(".css")||n.endsWith(".html")||n.endsWith(".go")||n.endsWith(".py")||n.endsWith(".java")||n.endsWith(".c")||n.endsWith(".cpp")||n.endsWith(".h")||n.endsWith(".sh")||n.endsWith(".bat")||n.endsWith(".ps1")||n.endsWith(".yaml")||n.endsWith(".yml")||n.endsWith(".toml")||n.endsWith(".ini")}return!1},view:({content:t,setContent:n,origContent:i,ext:r,alias:o,textareaId:u})=>e.jsx(Yt,{content:t||"",setContent:n||(()=>{}),origContent:i||"",ext:r||"",alias:o,textareaId:u||"editor"}),isEditable:!0},an={name:"Binary",priority:10,matches:t=>!!(t.probe&&!t.probe.isText),view:({path:t})=>e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8},children:[e.jsx("a",{className:"link",href:Le(`/api/file?path=${encodeURIComponent(t)}`),download:t.split("/").pop(),children:"Download"}),e.jsx("span",{className:"muted",children:"(Binary or unsupported file type)"})]}),isEditable:!1},ot={name:"Unsupported",priority:0,matches:()=>!0,view:({path:t})=>e.jsxs("div",{style:{padding:12},className:"muted",children:["Unsupported file type: ",t]}),isEditable:!1},on=[en,tn,nn,sn,rn,an,ot].sort((t,n)=>n.priority-t.priority);function We(t){for(const n of on)if(n.matches(t))return n;return ot}function ln(t){return t.charCodeAt(0)===65279?{text:t.slice(1),hasBOM:!0}:{text:t,hasBOM:!1}}function cn(t){return"\uFEFF"+t}function dn({path:t,onSaved:n,settings:i,reloadTrigger:r,onUnsavedChange:o,onMeta:u}){const[c,d]=s.useState(""),[h,w]=s.useState(""),[C,b]=s.useState(!1),[R,g]=s.useState(""),[_,$]=s.useState(!1),[j,N]=s.useState(null),[B,q]=s.useState(!1),[O,fe]=s.useState(null),[te,ae]=s.useState(null),[oe,f]=s.useState(null),[T,v]=s.useState(null),[W,S]=s.useState(!1),M=s.useRef(null),U=s.useRef(null),K=s.useRef(null),ne=We({path:t,meta:j,probe:O}),J=ne.view,de=s.useCallback(async(E=!1)=>{if(t){$(!0),g("");try{const D=await pe(t);if(N(D),typeof u=="function"&&u(D),!E&&oe&&T&&D.modTime!==T&&!confirm("File has been modified externally. Reload?")){$(!1);return}v(D.modTime);const Q=await Vt(t);fe(Q);const ue=We({path:t,meta:D,probe:Q});if(D.isDir){d(""),$(!1);return}if(ue.name==="Text"){const ye=await Dt(t),{text:we,hasBOM:Ee}=ln(ye);d(we),w(we),b(Ee),f(Date.now()),S(!1)}else d(""),$(!1)}catch{O&&O.isText&&(g("Failed to load"),S(!0)),f(null)}finally{$(!1)}}},[t]),ve=10*1024*1024,xe=async(E,D=64*1024)=>{if(t){q(!0);try{const Q=`?path=${encodeURIComponent(t)}&offset=${E}&length=${D}`,ue=await ie(`/api/file/section${Q}`);if(!ue.ok)throw new Error("section fetch failed");const ye=await ue.text();d(ye),w(ye)}catch{g("Failed to load section")}finally{q(!1)}}},L=qt(t)||O&&O.ext||Ue(t),H=void 0,A=O&&O.ext?O.ext:"text",Y=(E=>E?"editor-"+E.replace(/[^a-z0-9_-]/gi,"-").replace(/-+/g,"-"):"editor")(t||"");s.useEffect(()=>{de()},[de]),s.useEffect(()=>{let E=!0;return(async()=>{if(!(!j||!j.isDir||!t))try{const D=await rt(t);if(!E)return;d(""),w(D.map(Q=>Q.name).join(`
`))}catch{}})(),()=>{E=!1}},[j,t]),s.useEffect(()=>{r&&r>0&&de(!0)},[r]),s.useEffect(()=>{M.current&&U.current&&(U.current.scrollTop=M.current.scrollTop,U.current.scrollLeft=M.current.scrollLeft)},[c]),s.useEffect(()=>{if(M.current&&U.current){const E=window.getComputedStyle(U.current),D=E.lineHeight,Q=E.paddingTop,ue=E.paddingBottom;D&&(M.current.style.lineHeight=D),Q&&(M.current.style.paddingTop=Q),ue&&(M.current.style.paddingBottom=ue)}},[c,t]),s.useEffect(()=>{U.current&&U.current.setAttribute("data-grammar",A),M.current&&(M.current.setAttribute("data-grammar",A),Y&&(M.current.id=Y));try{const E=U.current?.querySelector("code");E&&Prism.highlightElement(E)}catch{}},[A,c,Y]),s.useEffect(()=>{if(!o||!ne.isEditable)return;const E=c!==h;if(K.current===null||K.current!==E){try{o(t,E)}catch(D){console.warn("onUnsavedChange threw",D)}K.current=E}},[c,h,o,t,ne.isEditable]);const me=async()=>{if(t){g("Saving...");try{const E=C?cn(c):c;await zt(t,E),g("Saved"),setTimeout(()=>g(D=>D==="Saved"?"":D),1500),await de(!0),n&&n()}catch{g("Save failed")}}},Ie=async()=>{if(t&&!(c!==h&&!confirm("You have unsaved changes. Reloading will discard them. Continue?"))){g("Reloading...");try{await de(!0),g("Reloaded"),setTimeout(()=>g(E=>E==="Reloaded"?"":E),1500)}catch{g("Reload failed")}}};return s.useEffect(()=>{const E=D=>{(D.ctrlKey||D.metaKey)&&D.key==="s"&&(D.preventDefault(),me())};return window.addEventListener("keydown",E),()=>window.removeEventListener("keydown",E)},[me]),e.jsxs("div",{className:"editor",children:[e.jsxs("div",{className:"editor-header",children:[e.jsx("strong",{children:"Editor"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{className:"muted",children:j&&j.absPath?j.absPath:t||"Select a file"}),j&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"muted",style:{fontSize:11},children:[j.isDir?"directory":ne.name,"Â· ",j.mode," Â· ",new Date(j.modTime).toLocaleString()," ",j.size?`Â· ${he(j.size)}`:""]}),te&&ne.name==="Image"?e.jsxs("span",{style:{fontSize:11,marginLeft:8},className:"muted",children:[te.w," Ã— ",te.h]}):null]})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"link icon-btn",title:"Reload","aria-label":"Reload",onClick:Ie,disabled:!t,children:e.jsx(I,{name:ge("refresh")||"icon-refresh",title:"Reload",size:16})}),ne.isEditable&&c!==h&&e.jsx("button",{className:"link icon-btn",title:"Save","aria-label":"Save",onClick:me,disabled:!t,children:e.jsx(I,{name:ge("upload")||"icon-upload",title:"Save",size:16})})]}),j&&j.size&&j.size>ve&&ne.isEditable?e.jsxs("div",{style:{marginLeft:12},children:[e.jsxs("div",{className:"muted",style:{fontSize:12},children:["File is large (",he(j.size),"). Full edit disabled."]}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>xe(0,64*1024),children:"View head"}),e.jsx("button",{className:"btn",onClick:()=>xe(Math.max(0,(j.size||0)-64*1024),64*1024),children:"View tail"})]}),B&&e.jsx("div",{className:"muted",children:"Loading section..."})]}):null,R&&e.jsx("div",{className:"muted",children:R})]}),e.jsx("div",{className:"editor-body",children:_?e.jsx("div",{className:"muted",children:"Loading..."}):e.jsx(J,{path:t,content:c,setContent:d,origContent:h,ext:L,alias:H,textareaId:Y,onDimensions:(E,D)=>ae({w:E,h:D})})})]})}function un({path:t}){const[n,i]=s.useState(null),[r,o]=s.useState(null);return s.useEffect(()=>{let u=!0;return(async()=>{if(!t){i(null);return}try{const c=await pe(t);if(!u)return;i(c),o(null)}catch(c){if(!u)return;o(c?.message||"failed to fetch metadata"),i(null)}})(),()=>{u=!1}},[t]),t?e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:t.split("/").pop()}),e.jsx("div",{className:"muted",style:{fontSize:12},children:t})]}),e.jsx("div",{children:e.jsx("a",{className:"link",href:`/api/file?path=${encodeURIComponent(t)}`,download:t.split("/").pop(),children:"Download"})})]}),e.jsxs("div",{style:{marginTop:12},children:[r?e.jsx("div",{className:"error",children:r}):null,n?e.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{width:160,padding:6},className:"muted",children:"Full path"}),e.jsx("td",{style:{padding:6},children:n.path||t})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"MIME"}),e.jsx("td",{style:{padding:6},children:n.mime||"unknown"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Size"}),e.jsx("td",{style:{padding:6},children:n.size?he(n.size):"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Mode"}),e.jsx("td",{style:{padding:6},children:n.mode||"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Last Modified"}),e.jsx("td",{style:{padding:6},children:n.modTime?new Date(n.modTime).toLocaleString():"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Is Dir"}),e.jsx("td",{style:{padding:6},children:n.isDir?"yes":"no"})]})]})}):e.jsx("div",{className:"muted",children:"Loading metadataâ€¦"})]})]}):e.jsx("div",{style:{padding:12},className:"muted",children:"No file selected"})}function hn({openFiles:t,active:n,onActivate:i,onClose:r,onCloseOthers:o,onCloseLeft:u,titles:c,fullPaths:d,types:h,evictedTabs:w=[],onRestoreEvicted:C}){const[b,R]=s.useState(null),g=s.useRef(null),_=s.useRef(null),[$,j]=s.useState(!1),[N,B]=s.useState(!1),[q,O]=s.useState(!1),[fe,te]=s.useState(null),ae=()=>{const f=_.current;if(!f){j(!1),B(!1);return}j(f.scrollLeft>0),B(f.scrollWidth>f.clientWidth+f.scrollLeft+1)},oe=f=>{const T=_.current;T&&(T.scrollBy({left:f,behavior:"smooth"}),setTimeout(ae,220))};return s.useEffect(()=>{function f(v){g.current&&(v.target instanceof Node&&g.current.contains(v.target)||R(null))}function T(v){v.key==="Escape"&&R(null)}return document.addEventListener("click",f),document.addEventListener("keydown",T),()=>{document.removeEventListener("click",f),document.removeEventListener("keydown",T)}},[]),s.useEffect(()=>{ae();function f(){ae()}window.addEventListener("resize",f);function T(){const v=_.current,W=140;if(!v){te(null);return}const S=v.clientWidth,M=Math.max(1,Math.floor(S/W));te(M)}return window.addEventListener("resize",T),T(),()=>{window.removeEventListener("resize",f),window.removeEventListener("resize",T)}},[t]),e.jsxs("div",{className:"tabbar",ref:g,children:[(()=>{const T=_.current?_.current.clientWidth:600,v=fe??Math.max(1,Math.floor(T/140)),W=t.length>v?t.slice(0,t.length-v):[];return W.length===0?null:e.jsxs("div",{className:"tab-evicted-dropdown",style:{display:"flex",alignItems:"center",marginRight:8,position:"relative"},children:[e.jsx("button",{className:"btn",onClick:()=>O(S=>!S),children:"â‹¯"}),q&&e.jsx("div",{style:{position:"absolute",left:0,top:"100%",background:"var(--bg)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",padding:8,zIndex:50},children:W.map(S=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 8px"},children:[e.jsx("button",{className:"link",onClick:()=>{C&&C(S),O(!1)},style:{flex:1,textAlign:"left"},children:c&&c[S]||S.split("/").pop()}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{className:"btn btn-small",title:"Restore",onClick:()=>{C&&C(S),O(!1)},children:"â†º"}),e.jsx("button",{className:"btn btn-small",title:"Close",onClick:()=>{r&&r(S),O(!1)},children:"âœ•"}),e.jsx("button",{className:"btn btn-small",title:"Close Others",onClick:()=>{W.filter(M=>M!==S).forEach(M=>r&&r(M)),O(!1)},children:"â‹¯"})]})]},S))})]})})(),$&&e.jsx("button",{className:"tab-scroll tab-scroll-left","aria-label":"scroll left",onClick:()=>oe(-200),children:"â—€"}),e.jsx("div",{className:"tab-scroll-area",ref:_,onScroll:ae,children:t.map((f,T)=>e.jsx("div",{className:"tab-item",style:{display:"flex",alignItems:"center",gap:8,padding:"4px 8px"},children:e.jsxs("button",{className:f===n?"btn":"link",onClick:()=>i(f),onContextMenu:v=>{v.preventDefault(),R(T)},style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{className:"tab-icon",children:(()=>{if((h&&h[f])==="shell")return e.jsx(I,{name:F("terminal")});if((h&&h[f])==="dir")return e.jsx(I,{name:F("folder")});const v=(f.split(".").pop()||"").toLowerCase(),W=ge(v);return e.jsx(I,{name:W})})()},`${h?.[f]||"file"}-${f}`),(()=>{const v=c&&c[f]||f.split("/").pop()||f,W=v.length>10?v.slice(0,10)+"â€¦":v,S=c&&c[f]&&c[f].startsWith("*")?"tab-title tab-unsaved":"tab-title";return e.jsx("span",{title:d?.[f]||v,className:S,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:120},children:W})})()]})},f))}),b!==null&&(()=>{const f=t[b];if(!f)return null;const T=g.current,v=_.current;let W={position:"absolute",right:8,top:40,padding:8,display:"flex",flexDirection:"column",gap:6};try{const S=v?.querySelectorAll(".tab-item"),M=S?S[b]:null;if(M&&T){const U=T.getBoundingClientRect(),K=M.getBoundingClientRect();W={position:"absolute",left:K.left-U.left,top:K.bottom-U.top+6,padding:8,display:"flex",flexDirection:"column",gap:6}}}catch{}return e.jsxs("div",{className:"dropdown",style:W,children:[e.jsx("button",{ref:S=>{S&&S.focus()},className:"link",onClick:()=>{r?.(f),R(null)},children:"Close"}),e.jsx("button",{className:"link",onClick:()=>{o?.(f),R(null)},children:"Close Others"}),e.jsx("button",{className:"link",onClick:()=>{u?.(f),R(null)},children:"Close Left"})]})})(),N&&e.jsx("button",{className:"tab-scroll tab-scroll-right","aria-label":"scroll right",onClick:()=>oe(200),children:"â–¶"})]})}function fn({visible:t=!0,onClose:n}){const[,i]=s.useState(0);if(s.useEffect(()=>Lt(()=>i(c=>c+1)),[]),!t)return null;const r=Ct().slice(0,100);function o(u){const c=[],d=/([\w\/\.\-]+:\d+)/g;let h=0,w;for(;(w=d.exec(u))!==null;)w.index>h&&c.push({text:u.slice(h,w.index)}),c.push({text:w[0],cls:"log-path"}),h=w.index+w[0].length;return h<u.length&&c.push({text:u.slice(h)}),c.map((C,b)=>C.cls?e.jsx("span",{className:C.cls,children:C.text},b):e.jsx("span",{children:C.text},b))}return e.jsxs("div",{className:"log-overlay",children:[e.jsxs("div",{className:"log-header",children:[e.jsx("strong",{children:"Logs"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn",onClick:()=>Et(),children:"Clear"}),e.jsx("button",{className:"btn",onClick:()=>n&&n(),style:{marginLeft:8},children:"Close"})]})]}),e.jsx("div",{children:r.map((u,c)=>e.jsxs("div",{className:`log - entry log - level - ${(u.level||"").toLowerCase()} `,children:[e.jsxs("div",{className:"log-meta",children:[u.ts," ",e.jsx("span",{className:"log-level",children:u.level})]}),e.jsx("div",{className:"log-message",children:o(u.msg)})]},c))})]})}async function mn(t,n="mlcremote-screenshot.png"){const i=await jt(t,{backgroundColor:null,scale:2});return new Promise(r=>{i.toBlob(o=>{if(!o){r();return}const u=URL.createObjectURL(o),c=document.createElement("a");c.href=u,c.download=n,document.body.appendChild(c),c.click(),c.remove(),URL.revokeObjectURL(u),r()},"image/png")})}class pn{prefix;constructor(n=""){this.prefix=n}key(n){return`${this.prefix}${n}`}get(n,i,r=null){try{const o=localStorage.getItem(this.key(n)),u=i.read(o);return u===null?r:u}catch{return r}}getOrDefault(n,i,r){const o=this.get(n,i,null);return o===null?r:o}set(n,i,r){try{localStorage.setItem(this.key(n),r.write(i))}catch{}}remove(n){try{localStorage.removeItem(this.key(n))}catch{}}}const Fe={read:t=>t===null?null:t,write:t=>String(t)},ce={read:t=>t===null?null:t==="1"||t==="true",write:t=>t?"1":"0"},ee=new pn("mlc:");function gn({title:t,message:n,onClose:i}){return s.useEffect(()=>{const r=o=>{o.key==="Escape"&&i()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[i]),e.jsx("div",{className:"login-overlay",onClick:i,children:e.jsxs("div",{className:"login-box",onClick:r=>r.stopPropagation(),style:{minWidth:350,maxWidth:500},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[e.jsx("h3",{style:{margin:0,fontSize:18},children:t}),e.jsx("button",{className:"link icon-btn",onClick:i,"aria-label":"Close",children:e.jsx(I,{name:F("close"),size:16})})]}),e.jsx("div",{style:{marginBottom:24,fontSize:14,lineHeight:"1.5",color:"var(--text-muted)"},children:n}),e.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:e.jsx("button",{className:"btn",onClick:i,children:"Close"})})]})})}function xn({health:t,isOnline:n,hideMemoryUsage:i,lastHealthAt:r}){const[o,u]=s.useState(new Date);return s.useEffect(()=>{const c=window.setInterval(()=>u(new Date),1e3);return()=>window.clearInterval(c)},[]),e.jsxs("div",{className:"status-bar",style:{height:24,background:"var(--bg-alt)",borderTop:"1px solid var(--border)",display:"flex",alignItems:"center",padding:"0 8px",fontSize:12,color:"var(--text-muted)",justifyContent:"space-between",userSelect:"none"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},title:r?`Last checked: ${new Date(r).toLocaleTimeString()}`:"",children:[e.jsx("span",{style:{width:8,height:8,borderRadius:4,background:t&&t.host?"#10b981":n?"#f59e0b":"#ef4444"}}),e.jsx("span",{children:t&&t.host?t.host:n?"Connecting...":"Offline"})]}),e.jsxs("span",{className:n?"ok":"err",title:n?"Connected":"Disconnected",children:[e.jsx(I,{name:"icon-circle-filled",size:10})," ",n?"Online":"Offline"]}),t&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"sep"}),e.jsxs("span",{title:`PID: ${t.pid}`,children:["Host: ",t.host||"localhost"]}),t.os&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"sep"}),e.jsx("span",{title:`OS: ${t.os} ${t.distro||""}`,children:t.distro||t.os})]}),e.jsx("span",{className:"sep"}),e.jsx("span",{title:"Server Time",children:t.server_time?new Date(t.server_time).toLocaleTimeString():""})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16},children:[!i&&t&&t.sys_mem_total_bytes?(()=>{const c=t.sys_mem_total_bytes||1,d=t.sys_mem_free_bytes||0,h=c-d,w=Math.round(h/c*100);return e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6},title:`System Memory: ${he(h)} / ${he(c)}`,children:[e.jsx("span",{children:"Mem:"}),e.jsx("div",{style:{width:50,height:8,background:"rgba(255,255,255,0.1)",borderRadius:2,overflow:"hidden"},children:e.jsx("div",{style:{width:`${w}%`,height:"100%",background:w>80?"#ef4444":"#10b981"}})}),e.jsxs("span",{children:[w,"%"]})]})})():null,e.jsx("div",{title:o.toLocaleDateString(),children:new Intl.DateTimeFormat(void 0,{hour:"numeric",minute:"numeric",second:"numeric"}).format(o)})]})]})}function yn({direction:t="vertical",initialSize:n=50,minSize:i=10,onResize:r,children:o,className:u}){const[c,d]=X.useState(n);X.useEffect(()=>{d(n)},[n]);const h=X.useRef(null),w=X.useRef(!1),C=X.useRef(n),b=t==="vertical",R=$=>{$.preventDefault(),w.current=!0,C.current=c,document.addEventListener("mousemove",g),document.addEventListener("mouseup",_),document.body.style.cursor=b?"col-resize":"row-resize",document.body.style.userSelect="none";const j=document.createElement("div");j.id="split-drag-overlay",j.style.position="fixed",j.style.top="0",j.style.left="0",j.style.width="100%",j.style.height="100%",j.style.zIndex="9999",j.style.cursor=b?"col-resize":"row-resize",document.body.appendChild(j)},g=$=>{if(!w.current||!h.current)return;const j=h.current.getBoundingClientRect();let N=0;b?N=($.clientX-j.left)/j.width*100:N=($.clientY-j.top)/j.height*100,N=Math.max(i,Math.min(100-i,N)),d(N),C.current=N},_=()=>{w.current=!1,document.removeEventListener("mousemove",g),document.removeEventListener("mouseup",_),document.body.style.cursor="",document.body.style.userSelect="";const $=document.getElementById("split-drag-overlay");$&&$.remove(),r&&r(C.current)};return e.jsxs("div",{ref:h,className:`split-pane-container ${t} ${u||""}`,style:{display:"flex",flexDirection:b?"row":"column",width:"100%",height:"100%",overflow:"hidden"},children:[e.jsx("div",{style:{flexBasis:`${c}%`,flexGrow:0,flexShrink:0,overflow:"hidden",position:"relative"},children:o[0]}),e.jsx("div",{className:"split-resizer",style:{flexBasis:"4px",cursor:b?"col-resize":"row-resize",background:"var(--border-color, #444)",zIndex:100,transition:"background 0.2s",position:"relative",alignSelf:"stretch"},onMouseDown:R,children:e.jsx("div",{style:{position:"absolute",top:b?0:-4,bottom:b?0:-4,left:b?-4:0,right:b?-4:0,zIndex:10}})}),e.jsx("div",{style:{flex:1,overflow:"hidden",position:"relative"},children:o[1]})]})}const vn=s.lazy(()=>Re(()=>import("./TerminalTab-BanViR7o.js"),__vite__mapDeps([9,1,2,3,4,6,7,5]),import.meta.url));function wn(){const{health:t,isOnline:n,lastHealthAt:i,refreshHealth:r,login:o,setToken:u,logout:c,showLogin:d,setShowLogin:h,showTokenInput:w,setShowTokenInput:C,showAuthChooser:b,setShowAuthChooser:R}=Pt(),[g,_]=s.useState(0),$=s.useRef(null);s.useEffect(()=>{!$.current&&t&&_(Date.now()),$.current=t},[t]);const[j,N]=s.useState(""),[B,q]=s.useState(""),O=s.useCallback(a=>q(a),[]),[fe,te]=s.useState(0),[ae,oe]=s.useState(!0),[f,T]=s.useState({root:{id:"root",files:[],activeFile:null}}),[v,W]=s.useState({type:"leaf",paneId:"root"}),[S,M]=s.useState("root"),U=f[S]?.files||[],K=f[S]?.activeFile||"",ne=a=>{T(p=>{const m=p[S];if(!m)return p;const x=a(m.files);return{...p,[S]:{...m,files:x}}})},J=a=>{T(p=>{const m=p[S];return m?{...p,[S]:{...m,activeFile:a}}:p})},[de,ve]=s.useState([]),[xe,l]=s.useState(null),[L,H]=s.useState(()=>ee.getOrDefault("autoOpen",ce,!0)),A=a=>{H(a),ee.set("autoOpen",a,ce)},se=8;function Y(a){ne(p=>{if(p.includes(a))return p;const m=[...p,a];if(m.length<=se)return m;const x=m[0];try{ve(k=>k.includes(x)?k:[...k,x])}catch{}return m.slice(1)}),J(a),pe(a).then(p=>{Ge(m=>({...m,[a]:p}))}).catch(()=>{})}const[me,Ie]=s.useState({}),[E,D]=s.useState(()=>ee.getOrDefault("showHidden",ce,!1)),Q=a=>{D(a),ee.set("showHidden",a,ce)},[ue,ye]=s.useState(!1),[we,Ee]=s.useState(()=>ee.getOrDefault("showLogs",ce,!1)),[lt,De]=s.useState(!1),[ct,Ve]=s.useState(!1),[qe,dt]=s.useState(()=>ee.getOrDefault("hideMemoryUsage",ce,!1)),[jn,bn]=s.useState(!1),[ze,Xe]=s.useState(null),[Ke,ut]=s.useState(300),[Ne,ht]=s.useState(()=>ee.getOrDefault("theme",Fe,"dark")),[kn,ft]=s.useState(new Date),[$e,Ye]=s.useState(null),[mt,Sn]=s.useState({}),[pt,gt]=s.useState({}),[Cn,Ge]=s.useState({}),xt=s.useCallback((a,p)=>{gt(m=>({...m,[a]:p}))},[]),Me=s.useCallback(async()=>{await r()},[r]);s.useEffect(()=>{const a=window.setInterval(()=>ft(new Date),1e3);return()=>window.clearInterval(a)},[]),s.useEffect(()=>{fetch("/api/settings").then(m=>m.json()).then(m=>{Xe(m),m&&typeof m.allowChangeRoot<"u"&&ye(!!m.allowChangeRoot)}).catch(()=>Xe({allowDelete:!1,defaultShell:"bash"}));const p=new URLSearchParams(window.location.search).get("profileId");if(p){console.log("Restoring state for profile:",p);try{const m=localStorage.getItem(`workspace_state_${p}`);if(m){const x=JSON.parse(m);x.panes&&T(x.panes),x.layout&&W(x.layout),x.activePaneId&&M(x.activePaneId)}}catch(m){console.error("Failed to restore workspace state",m)}}},[]),s.useEffect(()=>{const p=new URLSearchParams(window.location.search).get("profileId");if(p){const m={panes:f,layout:v,activePaneId:S};localStorage.setItem(`workspace_state_${p}`,JSON.stringify(m))}},[f,v,S]),s.useEffect(()=>{Ne==="light"?document.documentElement.classList.add("theme-light"):document.documentElement.classList.remove("theme-light")},[Ne]);const Je=a=>{const p=`pane-${Date.now()}`,x=f[S]?.activeFile;T(k=>({...k,[p]:{id:p,files:x?[x]:[],activeFile:x||null}})),W(k=>{const Z=V=>V.type==="leaf"?V.paneId===S?{type:"branch",direction:a,size:50,children:[V,{type:"leaf",paneId:p}]}:V:{...V,children:[Z(V.children[0]),Z(V.children[1])]};return Z(k)}),M(p)},Qe=a=>{a==="root"&&v.type==="leaf"||(W(p=>{const m=k=>{if(k.type==="leaf")return k.paneId===a?null:k;const Z=m(k.children[0]),V=m(k.children[1]);return!Z&&!V?null:Z?V?{...k,children:[Z,V]}:Z:V};return m(p)||{type:"leaf",paneId:"root"}}),T(p=>{const m={...p};return delete m[a],m}),S===a&&M("root"))},yt=(a,p)=>{W(m=>{const x=k=>k===a?{...k,size:p}:k.type==="branch"?{...k,children:[x(k.children[0]),x(k.children[1])]}:k;return x(m)})},Pe=a=>a.type==="leaf"?vt(a.paneId):e.jsxs(yn,{direction:a.direction,initialSize:a.size,onResize:p=>yt(a,p),children:[Pe(a.children[0]),Pe(a.children[1])]}),vt=a=>{const p=f[a];if(!p)return e.jsx("div",{className:"muted",children:"Pane not found"});const m=p.files,x=p.activeFile||"",k=y=>{if(M(a),T(z=>{const P=z[a];return P?(y&&!y.startsWith("shell-")&&y.includes("."),{...z,[a]:{...P,activeFile:y}}):z}),y&&!y.startsWith("shell-")){const z=y.split("/").filter(Boolean);z.pop(),z.length&&`${z.join("/")}`}N(y),te(Date.now())},Z=y=>{T(z=>{const P=z[a];if(!P)return z;const re=P.files.filter(je=>je!==y);let le=P.activeFile;return P.activeFile===y&&(le=re[0]||null),{...z,[a]:{...P,files:re,activeFile:le}}})},V={};for(const y of m)if(y.startsWith("shell-")){const P=(me[y]||""||"/").split("/").filter(Boolean);let re="/";if(P.length){const le=P[P.length-1];le.includes(".")&&P.length>1?re=P[P.length-2]:re=le}V[y]=re}else{const z=y.split("/").pop()||y;V[y]=pt[y]?`*${z}`:z}const _e={},Oe={};for(const y of m)y.startsWith("shell-")?(_e[y]="shell",Oe[y]=me[y]||"/"):(_e[y]="file",Oe[y]=y);const Ze=a===S;return e.jsxs("div",{className:"pane-content",style:{height:"100%",display:"flex",flexDirection:"column",position:"relative"},onClick:()=>{Ze||M(a)},children:[Ze&&e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,height:2,background:"var(--accent)",zIndex:10}}),m.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{onContextMenu:y=>{y.preventDefault()},children:e.jsx(s.Suspense,{fallback:null,children:e.jsx(hn,{openFiles:m,active:x,titles:V,fullPaths:Oe,types:_e,onRestoreEvicted:()=>{},onActivate:k,onClose:Z,onCloseOthers:y=>{T(z=>{const P=z[a];if(!P)return z;const re=P.files.filter(le=>le===y);return{...z,[a]:{...P,files:re,activeFile:y}}})},onCloseLeft:y=>{T(z=>{const P=z[a];if(!P)return z;const re=P.files.indexOf(y);if(re<=0)return z;const le=P.files.slice(re);let je=P.activeFile;return le.includes(je||"")||(je=y),{...z,[a]:{...P,files:le,activeFile:je}}})}})})}),e.jsx("div",{style:{flex:1,position:"relative"},children:m.map(y=>e.jsx("div",{style:{display:y===x?"block":"none",height:"100%"},children:y.startsWith("shell-")?e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading terminalâ€¦"}),children:e.jsx(vn,{shell:ze&&ze.defaultShell||"bash",path:me[y]||"",onExit:()=>Z(y)},y)}):y==="trash"?e.jsx(Wt,{}):y==="binary"?e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loadingâ€¦"}),children:e.jsx(un,{path:xe||void 0})}):e.jsx(dn,{path:y,settings:ze||void 0,onSaved:()=>{},reloadTrigger:mt[y]||0,onUnsavedChange:xt,onMeta:z=>{z&&z.path&&Ge(P=>({...P,[y]:z}))}})},y))})]}):e.jsxs("div",{className:"welcome-message",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-muted)"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"10px",opacity:.2},children:e.jsx(I,{name:F("folder"),size:48})}),e.jsx("div",{style:{opacity:.5},children:"Empty Pane"}),a!=="root"&&e.jsx("button",{className:"btn link",onClick:()=>Qe(a),children:"Close Pane"})]})]})};return e.jsxs("div",{className:"app",children:[e.jsxs("header",{className:"app-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("img",{src:"/logo.png",alt:"MLCRemote logo",style:{height:28,display:"block"},onLoad:()=>oe(!0),onError:()=>oe(!1)}),!ae&&e.jsx("h1",{style:{margin:0},children:"MLCRemote"})]}),e.jsxs("div",{className:"status",children:[e.jsx("button",{className:"link icon-btn",onClick:async()=>{let a=j||"";try{if(a){const x=await pe(a);if(!x.isDir&&x.path){const k=x.path.split("/").filter(Boolean);k.pop(),a=k.length?`/${k.join("/")}`:""}}else if(K&&!K.startsWith("shell-"))try{const x=await pe(K);if(x.isDir)a=x.path||K;else if(x.path){const k=x.path.split("/").filter(Boolean);k.pop(),a=k.length?`/${k.join("/")}`:""}}catch{const k=K.split("/").filter(Boolean);k.pop(),a=k.length?`/${k.join("/")}`:""}}catch{}const p=`shell-${Date.now()}`;let m=a||"";if(m&&m.split("/").pop()?.includes(".")){const x=m.split("/").filter(Boolean);x.pop(),m=x.length?`/${x.join("/")}`:"/"}Ie(x=>({...x,[p]:m})),Y(p)},title:"Open shell","aria-label":"Open shell",children:e.jsx(I,{name:F("terminal"),title:"Open shell",size:16})}),e.jsx("button",{className:"link icon-btn","aria-label":"Toggle theme",onClick:()=>{const a=Ne==="dark"?"light":"dark";ht(a),ee.set("theme",a,Fe),a==="light"?document.documentElement.classList.add("theme-light"):document.documentElement.classList.remove("theme-light")},children:Ne==="dark"?e.jsx(I,{name:F("moon"),title:"Dark theme",size:16}):e.jsx(I,{name:F("sun"),title:"Light theme",size:16})}),e.jsx("button",{className:"link icon-btn",title:"About","aria-label":"About",onClick:()=>De(!0),children:e.jsx(I,{name:F("info"),title:"About",size:16})}),e.jsx("button",{className:"link icon-btn",title:"Screenshot","aria-label":"Screenshot",onClick:async()=>{const a=document.querySelector(".app");if(a)try{await mn(a,"mlcremote-screenshot.png")}catch(p){console.error("Screenshot failed",p)}},children:e.jsx(I,{name:F("screenshot"),title:"Screenshot",size:16})}),e.jsx("button",{className:"link icon-btn","aria-label":"Open settings",title:"Settings",onClick:()=>Ve(a=>!a),children:e.jsx(I,{name:F("settings"),title:"Settings",size:16})}),e.jsx("button",{className:"link icon-btn",title:"Trash","aria-label":"Trash",onClick:()=>{U.includes("trash")||Y("trash"),J("trash")},children:e.jsx(I,{name:"icon-trash",title:"Trash",size:16})}),e.jsx("button",{className:"link icon-btn",title:"Split Right","aria-label":"Split Right",onClick:()=>Je("vertical"),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",style:{display:"block"},children:[e.jsx("path",{fillRule:"evenodd",d:"M14 3H2a1 1 0 00-1 1v8a1 1 0 001 1h12a1 1 0 001-1V4a1 1 0 00-1-1zM2 2a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H2z",clipRule:"evenodd"}),e.jsx("path",{d:"M8 4v8H7V4h1z"})]})}),e.jsx("button",{className:"link icon-btn",title:"Split Down","aria-label":"Split Down",onClick:()=>Je("horizontal"),children:e.jsxs("svg",{width:"16",height:"16",viewBox:"0 0 16 16",fill:"currentColor",style:{display:"block"},children:[e.jsx("path",{fillRule:"evenodd",d:"M14 3H2a1 1 0 00-1 1v8a1 1 0 001 1h12a1 1 0 001-1V4a1 1 0 00-1-1zM2 2a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V4a2 2 0 00-2-2H2z",clipRule:"evenodd"}),e.jsx("path",{d:"M2 8h12v1H2V8z"})]})}),v.type!=="leaf"&&e.jsx("button",{className:"link icon-btn",title:"Close Active Pane","aria-label":"Close Active Pane",onClick:()=>Qe(S),style:{marginLeft:4},children:e.jsx(I,{name:F("close"),size:16})})]}),ct&&e.jsx(Bt,{autoOpen:L,showHidden:E,onToggleAutoOpen:a=>A(a),onToggleShowHidden:a=>Q(a),showLogs:we,onToggleLogs:a=>{Ee(a),ee.set("showLogs",a,ce)},hideMemoryUsage:qe,onToggleHideMemoryUsage:a=>{dt(a),ee.set("hideMemoryUsage",a,ce)},onClose:()=>Ve(!1)})]}),e.jsxs("div",{className:"app-body",style:{alignItems:"stretch"},children:[e.jsx("aside",{className:"sidebar",style:{width:Ke},children:e.jsx(Ft,{showHidden:E,autoOpen:L,onToggleHidden:a=>Q(a),selectedPath:j,activeDir:B,onDirChange:O,focusRequest:fe,reloadSignal:g,onSelect:(a,p)=>{if(N(a),p){J(a);return}(async()=>{try{const m=await pe(a),x=We({path:a,meta:m});if(x.name==="Binary"||x.name==="Unsupported"){U.includes("binary")||Y("binary"),l(a),J("binary");return}}catch(m){Ye({title:"Broken Link",message:`Cannot open file: ${m.message||"stat failed"}`});return}L?Y(a):J(a)})(),Me()},onView:a=>{U.includes(a)?J(a):Y(a),N(a),Me()},onBackendActive:Me,onChangeRoot:async()=>{if(!ue){alert("Changing root is not permitted by the server settings");return}const a=window.prompt("Enter the server directory path to use as new root (e.g. /home/user/project):",j||"/");if(!a)return;const p=a.trim();try{if(!(await pe(p)).isDir){alert("Selected path is not a directory");return}N(p);try{ee.set("lastRoot",p,Fe)}catch{}try{const x=ee.getOrDefault("showHidden",ce,!1);ee.set("showHidden",x,ce)}catch{}}catch(m){alert("Cannot access selected path: "+(m?.message||m))}}})}),e.jsx("div",{className:"resizer",onMouseDown:a=>{const p=a.clientX,m=Ke;function x(Z){const V=Z.clientX-p;ut(Math.max(160,Math.min(800,m+V)))}function k(){window.removeEventListener("mousemove",x),window.removeEventListener("mouseup",k)}window.addEventListener("mousemove",x),window.addEventListener("mouseup",k)},children:e.jsx("div",{className:"bar"})}),e.jsx("main",{className:"main",children:e.jsxs("div",{className:"main-content",children:[b&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Not Authenticated"}),e.jsx("p",{children:"You need to sign in or provide an access key to continue."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn",onClick:()=>{R(!1),h(!0)},children:"Sign in (password)"}),e.jsx("button",{className:"btn",onClick:()=>{R(!1),C(!0)},children:"I have an access key"})]})]})}),d&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Sign in"}),e.jsx("p",{children:"Please enter the server password to obtain an access token."}),e.jsx("input",{id:"mlc-login-pwd",type:"password",placeholder:"Password"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"btn",onClick:async()=>{const a=document.getElementById("mlc-login-pwd");if(a)try{await o(a.value)}catch(p){alert("Login failed: "+(p?.message||p))}},children:"Sign in"})})]})}),w&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Enter Access Token"}),e.jsx("p",{children:"The server requires an access token. Paste it here to continue."}),e.jsx("input",{id:"mlc-token-input",type:"text",placeholder:"token"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"btn",onClick:async()=>{const a=document.getElementById("mlc-token-input");if(a)try{u(a.value.trim())}catch(p){alert("Failed to store token: "+(p?.message||p))}},children:"Use token"})})]})}),$e&&e.jsx(gn,{title:$e.title,message:$e.message,onClose:()=>Ye(null)}),Pe(v)]})})]}),e.jsx(xn,{health:t,isOnline:n,hideMemoryUsage:qe,lastHealthAt:i}),e.jsx(fn,{visible:we,onClose:()=>Ee(!1)}),lt&&e.jsx("div",{className:"about-backdrop",onClick:()=>De(!1),children:e.jsxs("div",{className:"about-modal",onClick:a=>a.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"MLCRemote"}),e.jsx("button",{"aria-label":"Close about",title:"Close",onClick:()=>De(!1),style:{background:"transparent",border:"none",cursor:"pointer"},children:e.jsx(I,{name:"icon-close",size:16})})]}),e.jsxs("div",{style:{marginBottom:8},children:["Copyright Â© ",new Date().getFullYear()," Michael Lechner"]}),e.jsxs("div",{style:{marginBottom:8},children:["Version: ",t?`${t.status}@${t.version}`:"unknown"]}),t&&e.jsxs("div",{style:{maxHeight:"40vh",overflow:"auto",background:"#0b0b0b",color:"white",padding:12,borderRadius:6},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Host:"})," ",t.host]}),e.jsxs("div",{children:[e.jsx("strong",{children:"PID:"})," ",t.pid]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Version:"})," ",t.version]}),e.jsxs("div",{children:[e.jsx("strong",{children:"App Memory:"})," ",he(t.go_alloc_bytes)," (alloc) / ",he(t.go_sys_bytes)," (sys)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"System Memory:"})," ",he((t.sys_mem_total_bytes||0)-(t.sys_mem_free_bytes||0))," / ",he(t.sys_mem_total_bytes||0)," used"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"CPU:"})," ",Math.round((t.cpu_percent||0)*10)/10,"%"]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("strong",{children:"Server time:"})," ",t.server_time]}),e.jsxs("div",{style:{marginTop:4},children:[e.jsx("strong",{children:"Timezone:"})," ",t.timezone]}),e.jsxs("div",{className:"muted",style:{marginTop:8,fontSize:12},children:["Last refresh: ",i?new Date(i).toLocaleString():"n/a"]})]})]})})]})}console.log("MLCRemote: captureTokenFromURL type:",typeof Be);try{typeof Be=="function"?Be():console.error("MLCRemote: captureTokenFromURL is not a function!")}catch(t){console.error("MLCRemote: Initialization error",t)}(async()=>{try{const t=await Re(()=>import("./icons-sprite-D5Klruqr.js"),[],import.meta.url),n=t&&(t.default||t);if(n&&typeof document<"u"){const i=document.createElement("div");i.style.width="0",i.style.height="0",i.style.position="absolute",i.style.visibility="hidden",i.innerHTML=n,document.body.insertBefore(i,document.body.firstChild)}}catch(t){alert("Failed to load icon sprite: "+(t?.message||t))}})();wt.createRoot(document.getElementById("root")).render(e.jsx(Mt,{children:e.jsx(wn,{})}));export{Re as _,ie as a,In as g,Le as m,pe as s};
