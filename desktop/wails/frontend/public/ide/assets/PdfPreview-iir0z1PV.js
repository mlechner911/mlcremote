import{_ as v,a as P,m as y}from"./index-Fimewn2f.js";import{R as n,j as a}from"./vendor-react-BXEsipma.js";import"./vendor-prism-DbuqXO-2.js";import"./vendor-html2canvas-k0ITeQhV.js";import"./vendor-xterm-BXin3HzJ.js";import"./vendor-scheduler-CWG1rEj-.js";function E({path:l}){const[d,x]=n.useState(null),[r,p]=n.useState(null),[s,f]=n.useState(1),[o,g]=n.useState(null),[w,h]=n.useState(!1),m=n.useRef(null);return n.useEffect(()=>{let e=!0;return(async()=>{try{const t=await v(()=>import("./vendor-pdfjs-dist-0-CDpXphMs.js"),[],import.meta.url);if(t.GlobalWorkerOptions.workerSrc="/pdf.worker.mjs",!e)return;x(t)}catch(t){console.error("Failed to load pdfjs",t)}})(),()=>{e=!1}},[]),n.useEffect(()=>{if(!d)return;let e=!1;return(async()=>{h(!0);try{const t=await P(`/api/file?path=${encodeURIComponent(l)}`);if(!t.ok)throw new Error("fetch failed");const i=await t.arrayBuffer(),u=await d.getDocument({data:i}).promise;if(e)return;p(u),g(u.numPages||null),f(1)}catch(t){console.error("Failed to load PDF",t),e||p(null)}finally{e||h(!1)}})(),()=>{e=!0}},[d,l]),n.useEffect(()=>{if(!r||!m.current)return;let e=!0;return(async()=>{try{const t=await r.getPage(s),i=t.getViewport({scale:1.25}),c=m.current,u=c.getContext("2d");c.width=Math.min(i.width,window.innerWidth*.9),c.height=i.height;const j={canvasContext:u,viewport:i};await t.render(j).promise}catch(t){e&&console.error("PDF render failed",t)}})(),()=>{e=!1}},[r,s]),d?w&&!r?a.jsx("div",{className:"muted",children:"Loading PDF…"}):a.jsxs("div",{style:{padding:12},children:[a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("button",{className:"btn",onClick:()=>f(e=>Math.max(1,e-1)),disabled:s<=1,children:"Prev"}),a.jsxs("span",{children:[s,o?` / ${o} `:""]}),a.jsx("button",{className:"btn",onClick:()=>f(e=>Math.min(o||1/0,e+1)),disabled:o?s>=o:!1,children:"Next"}),a.jsx("a",{className:"link",href:y(`/api/file?path=${encodeURIComponent(l)}`),download:l.split("/").pop(),children:"Download"})]}),a.jsx("div",{style:{marginTop:8},children:r?a.jsx("canvas",{ref:m,style:{maxWidth:"100%",borderRadius:6,boxShadow:"0 2px 8px rgba(0,0,0,0.2)"}}):a.jsx("div",{className:"muted",children:"No preview"})})]}):a.jsx("div",{className:"muted",children:"Loading PDF support…"})}export{E as default};
