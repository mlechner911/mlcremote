const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PdfPreview-B2xLyUYc.js","assets/vendor-react-DS53xkUv.js","assets/vendor-scheduler-CWG1rEj-.js","assets/vendor-prism-DR-dfdyj.js","assets/vendor-prism-Cg1sXqY3.css","assets/vendor-html2canvas-k0ITeQhV.js","assets/vendor-xterm-BXin3HzJ.js","assets/vendor-xterm-DFuMZ0ql.css","assets/ShellView-CsEKaUjJ.js","assets/TerminalTab-DGW3NDWv.js"])))=>i.map(i=>d[i]);
import{j as e,R as r,r as $e,c as nt}from"./vendor-react-DS53xkUv.js";import{P as Ce}from"./vendor-prism-DR-dfdyj.js";import{h as rt}from"./vendor-html2canvas-k0ITeQhV.js";import"./vendor-xterm-BXin3HzJ.js";import"./vendor-scheduler-CWG1rEj-.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const d of l)if(d.type==="childList")for(const a of d.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function i(l){const d={};return l.integrity&&(d.integrity=l.integrity),l.referrerPolicy&&(d.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?d.credentials="include":l.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(l){if(l.ep)return;l.ep=!0;const d=i(l);fetch(l.href,d)}})();const it="modulepreload",at=function(t){return"/"+t},Oe={},pe=function(s,i,o){let l=Promise.resolve();if(i&&i.length>0){let p=function(w){return Promise.all(w.map(L=>Promise.resolve(L).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),u=a?.nonce||a?.getAttribute("nonce");l=p(i.map(w=>{if(w=at(w),w in Oe)return;Oe[w]=!0;const L=w.endsWith(".css"),b=L?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${w}"]${b}`))return;const T=document.createElement("link");if(T.rel=L?"stylesheet":it,L||(T.as="script"),T.crossOrigin="",T.href=w,u&&T.setAttribute("nonce",u),document.head.appendChild(T),L)return new Promise((j,x)=>{T.addEventListener("load",j),T.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${w}`)))})}))}function d(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return l.then(a=>{for(const u of a||[])u.status==="rejected"&&d(u.reason);return s().catch(d)})},ot=200,he=[],me=[];function He(t,s){const i={ts:new Date().toISOString(),level:t,msg:s};for(he.push(i);he.length>ot;)he.shift();me.forEach(o=>o())}function B(t){He("info",t)}function ge(t){He("warn",t)}function lt(){return he.slice().reverse()}function ct(t){return me.push(t),()=>{const s=me.indexOf(t);s>=0&&me.splice(s,1)}}function dt(){he.length=0,me.forEach(t=>t())}function Ee(){try{return localStorage.getItem("mlcremote_token")}catch{return null}}function Ae(t){try{localStorage.setItem("mlcremote_token",t)}catch{}}async function Z(t,s){const i=Ee(),o=new Headers(s?.headers);i&&o.set("X-Auth-Token",i);const l={...s||{},headers:o},d=await fetch(t,l);if(d.status===401){try{localStorage.removeItem("mlcremote_token")}catch{}try{window.dispatchEvent(new CustomEvent("mlcremote:auth-failed",{detail:{url:typeof t=="string"?t:t.url}}))}catch{}}return d}async function ut(t){B("POST /api/login");const s=await fetch("/api/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:t})});if(B(`/api/login => ${s.status}`),!s.ok)throw new Error("login failed");const i=await s.json();if(i&&i.token)return Ae(i.token),i.token;throw new Error("no token in response")}async function ke(){B("GET /health");const t=await Z("/health");if(B(`/health => ${t.status}`),!t.ok)throw ge("/health not ok"),new Error("health failed");return t.json()}function ht(){try{const s=new URLSearchParams(window.location.search).get("token");if(s)return Ae(s),!0}catch{}return!1}async function ze(){try{return(await Z("/api/auth/check")).status===200}catch{return!1}}async function Fe(t="",s){const i=new URLSearchParams;t&&i.set("path",t),s?.showHidden&&i.set("showHidden","1");const o=i.toString()?`?${i.toString()}`:"";B(`GET /api/tree${o}`);const l=await Z(`/api/tree${o}`);if(B(`/api/tree${o} => ${l.status}`),!l.ok)throw ge("/api/tree not ok"),new Error("tree failed");return l.json()}async function Pe(t){B(`GET /api/file?path=${t}`);const s=await Z(`/api/file?path=${encodeURIComponent(t)}`);if(B(`/api/file?path=${t} => ${s.status}`),!s.ok)throw ge("/api/file read failed"),new Error("read failed");return s.text()}async function ae(t){B(`GET /api/stat?path=${t}`);const s=await Z(`/api/stat?path=${encodeURIComponent(t)}`);if(B(`/api/stat?path=${t} => ${s.status}`),!s.ok)throw new Error("stat failed");return s.json()}async function mt(t,s){B(`POST /api/file path=${t} size=${s.length}`);const i=await Z("/api/file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:t,content:s})});if(B(`/api/file POST => ${i.status}`),!i.ok)throw ge("/api/file save failed"),new Error("save failed")}async function ft(t){B(`DELETE /api/file?path=${t}`);const s=await Z(`/api/file?path=${encodeURIComponent(t)}`,{method:"DELETE"});if(B(`/api/file delete => ${s.status}`),!s.ok)throw ge("/api/file delete failed"),new Error("delete failed")}const O=({name:t,className:s,title:i,size:o=16})=>{if(!t)return null;const l=`#${t}`;return e.jsxs("svg",{className:s,width:o,height:o,"aria-hidden":i?void 0:"true",role:i?"img":void 0,children:[i?e.jsx("title",{children:i}):null,e.jsx("use",{href:l})]})},pt={upload:"icon-upload",cr:"icon-chevron-right",user:"icon-user",view:"icon-view",js:"icon-js",download:"icon-download",x:"icon-close",info:"icon-info",cl:"icon-chevron-left",log:"icon-log",moon:"icon-moon",zip:"icon-archive",sh:"icon-terminal",stop:"icon-stop",server:"icon-server",sun:"icon-sun",jpg:"icon-image",jpeg:"icon-image",search:"icon-search",pdf:"icon-pdf",settings:"icon-settings",shell:"icon-terminal",run:"icon-play",plus:"icon-plus",minus:"icon-minus",home:"icon-home",screenshot:"icon-screenshot",md:"icon-markdown",gif:"icon-image",txt:"icon-text",refresh:"icon-refresh",up:"icon-up",bz2:"icon-archive",mjs:"icon-js",warn:"icon-warning",trash:"icon-trash",dir:"icon-folder",markdown:"icon-markdown",png:"icon-image",tar:"icon-archive",gz:"icon-archive",json:"icon-json",cfg:"icon-settings",close:"icon-close",svg:"icon-image"};function fe(t){if(t)return pt[t.toLowerCase()]}function Be(t,s){if(s){const i=s.lastIndexOf(".");if(i>=0&&i<s.length-1){const o=s.slice(i+1).toLowerCase();return fe(o)}}}const A=t=>"icon-"+t;function gt({onSelect:t,showHidden:s,onToggleHidden:i,autoOpen:o=!0,onView:l,onBackendActive:d,onChangeRoot:a,canChangeRoot:u,selectedPath:p,activeDir:w,onDirChange:L,focusRequest:b,reloadSignal:T}){const[j,x]=r.useState(""),[z,ie]=r.useState([]),[P,y]=r.useState(!1),[Q,H]=r.useState(""),[te,ee]=r.useState(null),[G,K]=r.useState(!1),m=r.useCallback(async h=>{y(!0),H("");try{const N=await Fe(h,{showHidden:s});ie(N),x(h);try{I.current!==h&&(L?.(h),I.current=h)}catch{}d?.();try{const _=se.current;_&&requestAnimationFrame(()=>{const D=Y.current;if(D)try{const W=D.querySelector(`[data-path="${CSS.escape(_)}"]`);W&&(W.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),W.focus())}catch{}})}catch{}}catch(N){H(N.message||"failed to list")}finally{y(!1)}},[s,d,L]),I=r.useRef("");r.useEffect(()=>{typeof w>"u"||w!==j&&m(w)},[w,j,m]),r.useEffect(()=>{m("")},[m]),r.useEffect(()=>{m(j||"")},[j,m,T]);const C=()=>{if(!j||j==="/"){m("");return}const h=j.split("/").filter(Boolean);h.pop();const N=`/${h.join("/")}`;m(N||"")},E=async(h,N)=>{if(!(!N||N.length===0)){K(!0),H("");try{const _=new FormData;for(let q=0;q<N.length;q++)_.append("file",N[q],N[q].name);const D=`?path=${encodeURIComponent(h)}`;if(!(await Z(`/api/upload${D}`,{method:"POST",body:_})).ok)throw new Error("upload failed");await m(h)}catch(_){H(_.message||"upload failed")}finally{K(!1)}}},k=(h,N)=>{h.preventDefault(),ee(null),E(N,h.dataTransfer.files)},M=(h,N)=>{h.preventDefault(),ee(N)},X=h=>{h.preventDefault(),ee(null)},Y=r.useRef(null),se=r.useRef("");return r.useEffect(()=>{se.current=p||""},[p]),r.useEffect(()=>{if(p)try{const h=Y.current;if(!h)return;const N=h.querySelector(`li[key="${CSS.escape(p)}"]`),_=h.querySelector(`[data-path="${p}"]`),D=N||_;if(D){D.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"});const W=D.querySelector("button.entry");W&&W.focus()}}catch{}},[p,j]),r.useEffect(()=>{if(b)try{const h=p||"";if(!h)return;const N=Y.current;if(!N)return;const _=CSS.escape(h),D=N.querySelector(`[data-path="${_}"]`);D&&(D.scrollIntoView({block:"nearest",inline:"nearest",behavior:"smooth"}),D.focus())}catch{}},[b]),e.jsxs("div",{className:"explorer",children:[e.jsxs("div",{className:"explorer-header",children:[e.jsx("strong",{className:"hidden",children:e.jsx(O,{name:A("dir")})}),e.jsx("div",{className:"explorer-controls",children:u&&typeof a=="function"&&e.jsx("button",{className:"link icon-btn","aria-label":"Change root",title:"Change root",onClick:async()=>{try{const h=await Promise.resolve(a(""))}catch{}},children:e.jsx(O,{name:A("dir")})})}),e.jsxs("div",{className:"breadcrumbs",children:[e.jsx("button",{type:"button",className:"link",onClick:()=>m(""),children:"root"}),j&&j.split("/").filter(Boolean).map((h,N,_)=>{const D=`/${_.slice(0,N+1).join("/")}`;return e.jsxs("span",{children:[" / ",e.jsx("button",{className:"link",onClick:()=>m(D),children:h})]},D)})]})]}),e.jsxs("div",{className:"explorer-body",onDrop:h=>k(h,j||""),onDragOver:h=>M(h,j||""),onDragLeave:X,children:[P&&e.jsx("div",{className:"muted",children:"Loading..."}),Q&&e.jsx("div",{className:"error",children:Q}),G&&e.jsx("div",{className:"muted",children:"Uploading..."}),!P&&!Q&&e.jsxs("ul",{className:"entry-list",ref:Y,children:[j&&j!=="/"&&e.jsx("li",{children:e.jsx("button",{type:"button",className:"entry",onClick:C,children:".."})},"up"),z.map(h=>e.jsx("li",{children:h.isDir?e.jsxs("button",{"data-path":h.path,type:"button",className:"entry"+(p===h.path?" selected":""),onClick:()=>{m(h.path),t(h.path,!0)},onDrop:N=>k(N,h.path),onDragOver:N=>M(N,h.path),onDragLeave:X,children:[e.jsx("span",{className:"icon",children:e.jsx(O,{name:fe("dir")||A("dir")})})," ",h.name,te===h.path?e.jsx("span",{style:{marginLeft:8,fontSize:12,color:"#888"},children:"Drop to upload"}):null]}):e.jsxs("div",{style:{display:"flex",gap:2,alignItems:"center"},children:[e.jsxs("button",{"data-path":h.path,type:"button",className:"entry",style:{flex:1,textAlign:"left"},onClick:()=>{if(o===!1){t(h.path,!1);return}t(h.path,!1)},children:[e.jsx("span",{className:"icon",children:e.jsx(O,{name:Be(void 0,h.name)||fe(h.name.split(".").pop()||"")||A("view")||"icon-text"})})," ",h.name]}),o?null:e.jsx("button",{className:"btn",onClick:()=>l?l(h.path):t(h.path,!1),title:"View file",children:e.jsx(O,{name:A("view")})}),e.jsx("a",{className:"btn",href:`/api/file?path=${encodeURIComponent(h.path)}${localStorage.getItem("mlcremote_token")?`&token=${encodeURIComponent(localStorage.getItem("mlcremote_token")||"")}`:""}`,download:h.name,style:{whiteSpace:"nowrap"},title:"Download","aria-label":`Download ${h.name}`,children:e.jsx(O,{name:A("download")})})]})},h.path))]})]})]})}function xt({autoOpen:t,showHidden:s,onToggleAutoOpen:i,onToggleShowHidden:o,showLogs:l,onToggleLogs:d,hideServerName:a,onToggleHideServerName:u,hideMemoryUsage:p,onToggleHideMemoryUsage:w,onClose:L}){const[b,T]=$e.useState(a),[j,x]=$e.useState(p);return e.jsx("div",{style:{position:"absolute",right:12,top:40,zIndex:60},children:e.jsxs("div",{style:{width:320,background:"var(--bg)",border:"1px solid var(--muted)",borderRadius:6,boxShadow:"0 6px 20px rgba(0,0,0,0.12)",padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("strong",{children:"Settings"}),e.jsx("button",{"aria-label":"Close settings",title:"Close",onClick:L,style:{background:"transparent",border:"none",cursor:"pointer"},children:e.jsx(O,{name:A("close"),title:"Close",size:16})})]}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:t,onChange:z=>i(z.target.checked)})," ","Auto open files"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:s,onChange:z=>o(z.target.checked)})," ","Show hidden files"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:l,onChange:z=>d(z.target.checked)})," Show server logs"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:b,onChange:z=>{T(z.target.checked),u(z.target.checked)}})," Hide server name in header"]})}),e.jsx("div",{style:{marginTop:8},children:e.jsxs("label",{style:{fontSize:13},children:[e.jsx("input",{type:"checkbox",checked:j,onChange:z=>{x(z.target.checked),w(z.target.checked)}})," Hide memory usage gauge"]})})]})})}function yt(){const[t,s]=r.useState(null),[i,o]=r.useState(!1),l=r.useCallback(async()=>{o(!0);try{const u=await Z("/api/trash/recent");if(!u.ok)throw new Error("fetch failed");const p=await u.json();Array.isArray(p)&&p.length>0?s(p[0]):s(null)}catch(u){console.warn("Failed to fetch trash",u)}finally{o(!1)}},[]);if(r.useEffect(()=>{l();const u=setInterval(l,1e4);return()=>clearInterval(u)},[l]),i&&!t)return e.jsx("div",{className:"muted",children:"Loading trash…"});if(!t)return e.jsx("div",{className:"muted",children:"Trash is empty"});const d=t.originalPath.split("/").pop()||t.originalPath,a=Be(void 0,d)||fe(d.split(".").pop()||"")||"icon-trash";return e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[e.jsx(O,{name:a,size:20}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{fontWeight:600},children:d}),e.jsx("div",{className:"muted",style:{fontSize:12},children:new Date(t.deletedAt).toLocaleString()})]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsxs("div",{className:"muted",children:["Original path: ",t.originalPath]}),e.jsxs("div",{className:"muted",children:["Trash path: ",t.trashPath]})]}),e.jsxs("div",{style:{marginTop:12},children:[e.jsx("button",{className:"btn",disabled:!0,children:"Undo (coming)"}),(()=>{const u=Ee(),p=`/api/file?path=${encodeURIComponent(t.trashPath)}`+(u?`&token=${encodeURIComponent(u)}`:"");return e.jsx("a",{className:"btn",style:{marginLeft:8},href:p,download:d,children:"Download"})})()]})]})}function re(t){if(!t||t<=0)return"0 B";const s=1024,i=s*1024,o=i*1024;return t>=o?`${(t/o).toFixed(2)} GB`:t>=i?`${(t/i).toFixed(2)} MB`:t>=s?`${(t/s).toFixed(2)} KB`:`${t} B`}const jt=new Set(["txt","md","markdown","yaml","yml","json","js","ts","jsx","tsx","html","css","env","ini","cfg","conf","csh","gitignore","dockerfile","sql"]),We=new Set(["zip","gz","tar","rar","exe","dll","so","bin","jpg","jpeg","png","gif","webp","pdf"]);function je(t){const s=t.split("/"),i=s[s.length-1]||"",o=i.lastIndexOf(".");return o===-1?"":i.slice(o+1).toLowerCase()}function qe(t){const s=je(t);return!s||jt.has(s)?!0:!We.has(s)}function vt(t){const s=je(t);return!(!s||We.has(s))}async function Me(t){if(!t)return{mime:"application/octet-stream",isText:!1,ext:""};try{const s=`?path=${encodeURIComponent(t)}`,i=await Z(`/api/filetype${s}`);if(!i.ok)throw new Error("probe failed");return await i.json()}catch{const i=je(t);return{mime:"application/octet-stream",isText:qe(t),ext:i}}}function wt(t){const s=Ce.languages;switch(t){case"jsx":return s.jsx;case"tsx":return s.tsx;case"java":return s.java;case"ini":return s.ini;case"js":return s.javascript;case"ts":return s.typescript;case"go":return s.go;case"php":return s.php;case"json":return s.json;case"yaml":case"yml":return s.yaml;case"toml":return s.toml||s.markup;case"md":case"markdown":return s.markdown;case"c":return s.c;case"cpp":return s.cpp;case"py":return s.python;case"bashrc":case"zshrc":case"bash_history":case"profile":return s.bash;case"sh":case"bash":return s.bash;case"xml":case"xml-doc":return s["xml-doc"];case"html":case"htm":return s.markup;case"css":case"sass":case"scss":return s.sass;case"sql":return s.sql;default:return s.javascript}}function ue(t){switch(t){case"js":case"jsx":return"javascript";case"ts":case"tsx":return"typescript";case"go":return"go";case"php":return"php";case"json":return"json";case"yaml":case"yml":return"yaml";case"toml":return"toml";case"ini":return"ini";case"md":case"markdown":return"markdown";case"c":return"c";case"cpp":case"cxx":case"c++":return"cpp";case"py":return"python";case"sh":case"bash":case"csh":return"bash";case"xml":case"xml-doc":return"xml-doc";case"html":case"htm":return"markup";case"sass":case"scss":return"sass";case"sql":return"sql";case"less":case"css":return"css";default:return"text"}}function Ue(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function bt(t,s){try{const i=wt(s),o=ue(s);return i?Ce.highlight(t,i,o):Ue(t)}catch(i){return console.warn("Prism highlight failed",i),Ue(t)}}function St({content:t,setContent:s,origContent:i,ext:o,alias:l,textareaId:d}){const a=r.useRef(null),u=r.useRef(null);return r.useEffect(()=>{const p=l||ue(o);u.current&&u.current.setAttribute("data-grammar",p),a.current&&a.current.setAttribute("data-grammar",p);try{const w=u.current?.querySelector("code");w&&Ce.highlightElement(w)}catch{}},[l,t,o]),r.useEffect(()=>{a.current&&u.current&&(u.current.scrollTop=a.current.scrollTop,u.current.scrollLeft=a.current.scrollLeft)},[t]),e.jsxs("div",{className:"editor-edit-area",children:[e.jsx("pre",{"aria-hidden":!0,className:`highlight-wrap language-${l||ue(o)}`,"data-grammar":l||ue(o),ref:p=>{u.current=p},children:e.jsx("code",{className:`language-${l||ue(o)}`,dangerouslySetInnerHTML:{__html:bt(t||"",o)}})}),e.jsx("textarea",{ref:a,className:"textarea",wrap:"off",value:t,name:d||"editor",id:d,"data-grammar":l,onChange:p=>s(p.target.value),onScroll:()=>{a.current&&u.current&&(u.current.scrollTop=a.current.scrollTop,u.current.scrollLeft=a.current.scrollLeft)},placeholder:"Open or create a file to edit",spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",autoComplete:"off"})]})}function kt({path:t,onDimensions:s}){const i=Ee(),o=`/api/file?path=${encodeURIComponent(t)}${i?`&token=${encodeURIComponent(i)}`:""}`,[l,d]=r.useState(null),a=r.useRef(null);return e.jsxs("div",{style:{marginTop:8},children:[e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",overflow:"hidden"},children:e.jsx("img",{ref:a,src:o,alt:t.split("/").pop(),style:{maxWidth:"100%",maxHeight:"80vh",objectFit:"contain",borderRadius:6,boxShadow:"0 2px 8px rgba(0,0,0,0.4)"},onLoad:()=>{try{const u=a.current;if(u&&u.naturalWidth&&u.naturalHeight){d({w:u.naturalWidth,h:u.naturalHeight});try{s&&s(u.naturalWidth,u.naturalHeight)}catch{}}}catch{}}})}),e.jsxs("div",{style:{marginTop:8,display:"flex",gap:8,alignItems:"center"},children:[e.jsx("a",{className:"link",href:o,download:t.split("/").pop(),children:"Download"}),l?e.jsxs("span",{className:"muted",style:{marginLeft:8},children:[l.w," × ",l.h]}):null]})]})}const Nt=r.lazy(()=>pe(()=>import("./PdfPreview-B2xLyUYc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])));function Ct({path:t}){return e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading PDF preview…"}),children:e.jsx(Nt,{path:t})})}r.lazy(()=>pe(()=>import("./PdfPreview-B2xLyUYc.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])));const Et=r.lazy(()=>pe(()=>import("./ShellView-CsEKaUjJ.js"),__vite__mapDeps([8,1,2,3,4,9,6,7,5])));function Lt({path:t,onSaved:s,settings:i,reloadTrigger:o,onUnsavedChange:l,onMeta:d}){const[a,u]=r.useState(""),[p,w]=r.useState(""),[L,b]=r.useState(""),[T,j]=r.useState(!1),[x,z]=r.useState(null),[ie,P]=r.useState(!1),[y,Q]=r.useState(null),[H,te]=r.useState(null),[ee,G]=r.useState(null),[K,m]=r.useState(null),[I,C]=r.useState(!1),E=r.useRef(null),k=r.useRef(null),M=r.useRef(null),X=r.useCallback(async(S=!1)=>{if(t){j(!0),b("");try{const R=await ae(t);if(z(R),typeof d=="function"&&d(R),!S&&ee&&K&&R.modTime!==K&&!confirm("File has been modified externally. Reload?")){j(!1);return}m(R.modTime);const U=await Me(t);if(Q(U),U.mime&&U.mime.startsWith("image/")){u(""),b(""),j(!1);return}if(U.mime&&U.mime==="application/pdf"){u(""),b(""),j(!1);return}if(!U.isText){u(""),b("no preview available — unsupported file type, use Download"),j(!1);return}const J=await Pe(t);u(J),w(J),G(Date.now()),C(!1)}catch{b("Failed to load"),C(!0),G(null)}finally{j(!1)}}},[t]),Y=10*1024*1024,se=async(S,R=64*1024)=>{if(t){P(!0);try{const U=`?path=${encodeURIComponent(t)}&offset=${S}&length=${R}`,J=await Z(`/api/file/section${U}`);if(!J.ok)throw new Error("section fetch failed");const ce=await J.text();u(ce),w(ce)}catch{b("Failed to load section")}finally{P(!1)}}},N=y&&y.ext?y.ext:je(t),_=void 0,D=y&&y.ext?y.ext:"text",q=(S=>S?"editor-"+S.replace(/[^a-z0-9_-]/gi,"-").replace(/-+/g,"-"):"editor")(t||"");r.useEffect(()=>{X()},[X]),r.useEffect(()=>{let S=!0;return(async()=>{if(!(!x||!x.isDir||!t))try{const R=await Fe(t);if(!S)return;u(""),w(R.map(U=>U.name).join(`
`))}catch{}})(),()=>{S=!1}},[x,t]),r.useEffect(()=>{o&&o>0&&X(!0)},[o]),r.useEffect(()=>{E.current&&k.current&&(k.current.scrollTop=E.current.scrollTop,k.current.scrollLeft=E.current.scrollLeft)},[a]),r.useEffect(()=>{if(E.current&&k.current){const S=window.getComputedStyle(k.current),R=S.lineHeight,U=S.paddingTop,J=S.paddingBottom;R&&(E.current.style.lineHeight=R),U&&(E.current.style.paddingTop=U),J&&(E.current.style.paddingBottom=J)}},[a,t]),r.useEffect(()=>{k.current&&k.current.setAttribute("data-grammar",D),E.current&&(E.current.setAttribute("data-grammar",D),q&&(E.current.id=q));try{const S=k.current?.querySelector("code");S&&Prism.highlightElement(S)}catch{}},[D,a,q]),r.useEffect(()=>{if(!l)return;const S=a!==p;if(M.current===null||M.current!==S){try{l(t,S)}catch(R){console.warn("onUnsavedChange threw",R)}M.current=S}},[a,p,l,t]);const ve=async()=>{if(t){b("Saving...");try{await mt(t,a),b("Saved"),w(a),s&&s();try{const S=await ae(t);z(S),typeof d=="function"&&d(S)}catch{}}catch{b("Save failed")}}},xe=async()=>{if(t&&confirm(`Delete ${t}? This will move the file to the server-side trash.`)){b("Deleting...");try{await ft(t),b("Deleted"),u("")}catch{b("Delete failed")}}},we=async()=>{if(t&&!(a!==p&&!confirm("You have unsaved changes. Reloading will discard them. Continue?"))){b("Reloading...");try{const S=await Me(t);if(Q(S),!S.isText){u(""),!S.mime||!S.mime.startsWith("image/")?b("?Binary or unsupported file type — use Download"+S.mime):b("");return}const R=await Pe(t);u(R),w(R),b("Reloaded")}catch{b("Reload failed")}}};return e.jsxs("div",{className:"editor",children:[e.jsxs("div",{className:"editor-header",children:[e.jsx("strong",{children:"Editor"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx("span",{className:"muted",children:x&&x.absPath?x.absPath:t||"Select a file"}),x&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"muted",style:{fontSize:11},children:[x.isDir?"directory":y&&y.mime&&y.mime.startsWith("image/")?"image":y&&y.mime==="application/pdf"?"pdf":y&&y.isText?"text":x.mime&&x.mime!=="text/plain"?x.mime:y&&y.mime?y.mime:x.mime||"file","· ",x.mode," · ",new Date(x.modTime).toLocaleString()," ",x.size?`· ${re(x.size)}`:""]}),y&&y.mime&&y.mime.startsWith("image/")&&H?e.jsxs("span",{style:{fontSize:11,marginLeft:8},className:"muted",children:[H.w," × ",H.h]}):null]})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn",onClick:we,disabled:!t,children:"Reload"}),t&&a!==p&&e.jsx("button",{className:"btn",onClick:ve,children:"Save"}),i&&i.allowDelete?e.jsx("button",{className:"btn btn-danger",onClick:xe,disabled:!t,children:"Delete"}):null]}),x&&x.size&&x.size>Y?e.jsxs("div",{style:{marginLeft:12},children:[e.jsxs("div",{className:"muted",style:{fontSize:12},children:["File is large (",re(x.size),"). Full edit disabled."]}),e.jsxs("div",{style:{marginTop:6,display:"flex",gap:8},children:[e.jsx("button",{className:"btn",onClick:()=>se(0,64*1024),children:"View head"}),e.jsx("button",{className:"btn",onClick:()=>se(Math.max(0,(x.size||0)-64*1024),64*1024),children:"View tail"}),e.jsx("button",{className:"btn",onClick:()=>{const S=Math.max(0,Math.floor((x.size||0)/2));se(S,64*1024)},children:"View middle"})]}),ie&&e.jsx("div",{className:"muted",children:"Loading section..."})]}):null,L&&e.jsx("div",{className:"muted",children:L})]}),e.jsx("div",{className:"editor-body",children:T?e.jsx("div",{className:"muted",children:"Loading..."}):x&&x.isDir?e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{fontWeight:600},children:["Directory: ",t]}),e.jsxs("div",{className:"muted",style:{marginTop:6},children:[p?p.split(`
`).length:"0"," entries"]}),e.jsx("pre",{style:{marginTop:8,maxHeight:240,overflow:"auto",padding:8,background:"var(--panel)"},children:p})]}):(y?.isText??qe(t))||vt(t)?e.jsx(St,{content:a,setContent:u,origContent:p,ext:N,alias:_,textareaId:q}):e.jsx("div",{children:t&&t.startsWith("shell-")?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading shell…"}),children:e.jsx(Et,{path:t})}):y&&y.mime&&y.mime==="application/pdf"?e.jsx(Ct,{path:t}):y&&y.mime&&y.mime.startsWith("image/")?e.jsx(kt,{path:t,onDimensions:(S,R)=>te({w:S,h:R})}):t?e.jsx("div",{style:{marginTop:8,display:"flex",gap:8},children:e.jsx("a",{className:"link",href:`/api/file?path=${encodeURIComponent(t)}`,download:t.split("/").pop(),children:"Download"})}):null})})]})}function Tt({path:t}){const[s,i]=r.useState(null),[o,l]=r.useState(null);return r.useEffect(()=>{let d=!0;return(async()=>{if(!t){i(null);return}try{const a=await ae(t);if(!d)return;i(a),l(null)}catch(a){if(!d)return;l(a?.message||"failed to fetch metadata"),i(null)}})(),()=>{d=!1}},[t]),t?e.jsxs("div",{style:{padding:12},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:600},children:t.split("/").pop()}),e.jsx("div",{className:"muted",style:{fontSize:12},children:t})]}),e.jsx("div",{children:e.jsx("a",{className:"link",href:`/api/file?path=${encodeURIComponent(t)}`,download:t.split("/").pop(),children:"Download"})})]}),e.jsxs("div",{style:{marginTop:12},children:[o?e.jsx("div",{className:"error",children:o}):null,s?e.jsx("table",{style:{width:"100%",borderCollapse:"collapse"},children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{style:{width:160,padding:6},className:"muted",children:"Full path"}),e.jsx("td",{style:{padding:6},children:s.path||t})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"MIME"}),e.jsx("td",{style:{padding:6},children:s.mime||"unknown"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Size"}),e.jsx("td",{style:{padding:6},children:s.size?re(s.size):"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Mode"}),e.jsx("td",{style:{padding:6},children:s.mode||"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Last Modified"}),e.jsx("td",{style:{padding:6},children:s.modTime?new Date(s.modTime).toLocaleString():"n/a"})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"muted",style:{padding:6},children:"Is Dir"}),e.jsx("td",{style:{padding:6},children:s.isDir?"yes":"no"})]})]})}):e.jsx("div",{className:"muted",children:"Loading metadata…"})]})]}):e.jsx("div",{style:{padding:12},className:"muted",children:"No file selected"})}function It({openFiles:t,active:s,onActivate:i,onClose:o,onCloseOthers:l,onCloseLeft:d,titles:a,fullPaths:u,types:p,evictedTabs:w=[],onRestoreEvicted:L}){const[b,T]=r.useState(null),j=r.useRef(null),x=r.useRef(null),[z,ie]=r.useState(!1),[P,y]=r.useState(!1),[Q,H]=r.useState(!1),[te,ee]=r.useState(null),G=()=>{const m=x.current;if(!m){ie(!1),y(!1);return}ie(m.scrollLeft>0),y(m.scrollWidth>m.clientWidth+m.scrollLeft+1)},K=m=>{const I=x.current;I&&(I.scrollBy({left:m,behavior:"smooth"}),setTimeout(G,220))};return r.useEffect(()=>{function m(C){j.current&&(C.target instanceof Node&&j.current.contains(C.target)||T(null))}function I(C){C.key==="Escape"&&T(null)}return document.addEventListener("click",m),document.addEventListener("keydown",I),()=>{document.removeEventListener("click",m),document.removeEventListener("keydown",I)}},[]),r.useEffect(()=>{G();function m(){G()}window.addEventListener("resize",m);function I(){const C=x.current,E=140;if(!C){ee(null);return}const k=C.clientWidth,M=Math.max(1,Math.floor(k/E));ee(M)}return window.addEventListener("resize",I),I(),()=>{window.removeEventListener("resize",m),window.removeEventListener("resize",I)}},[t]),e.jsxs("div",{className:"tabbar",ref:j,children:[(()=>{const I=x.current?x.current.clientWidth:600,C=te??Math.max(1,Math.floor(I/140)),E=t.length>C?t.slice(0,t.length-C):[];return E.length===0?null:e.jsxs("div",{className:"tab-evicted-dropdown",style:{display:"flex",alignItems:"center",marginRight:8,position:"relative"},children:[e.jsx("button",{className:"btn",onClick:()=>H(k=>!k),children:"⋯"}),Q&&e.jsx("div",{style:{position:"absolute",left:0,top:"100%",background:"var(--bg)",boxShadow:"0 4px 12px rgba(0,0,0,0.2)",padding:8,zIndex:50},children:E.map(k=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"4px 8px"},children:[e.jsx("button",{className:"link",onClick:()=>{L&&L(k),H(!1)},style:{flex:1,textAlign:"left"},children:a&&a[k]||k.split("/").pop()}),e.jsxs("div",{style:{display:"flex",gap:6},children:[e.jsx("button",{className:"btn btn-small",title:"Restore",onClick:()=>{L&&L(k),H(!1)},children:"↺"}),e.jsx("button",{className:"btn btn-small",title:"Close",onClick:()=>{o&&o(k),H(!1)},children:"✕"}),e.jsx("button",{className:"btn btn-small",title:"Close Others",onClick:()=>{E.filter(M=>M!==k).forEach(M=>o&&o(M)),H(!1)},children:"⋯"})]})]},k))})]})})(),z&&e.jsx("button",{className:"tab-scroll tab-scroll-left","aria-label":"scroll left",onClick:()=>K(-200),children:"◀"}),e.jsx("div",{className:"tab-scroll-area",ref:x,onScroll:G,children:t.map((m,I)=>e.jsx("div",{className:"tab-item",style:{display:"flex",alignItems:"center",gap:8,padding:"4px 8px"},children:e.jsxs("button",{className:m===s?"btn":"link",onClick:()=>i(m),onContextMenu:C=>{C.preventDefault(),T(I)},style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("span",{className:"tab-icon",children:(()=>{if((p&&p[m])==="shell")return e.jsx(O,{name:A("terminal")});if((p&&p[m])==="dir")return e.jsx(O,{name:A("folder")});const C=(m.split(".").pop()||"").toLowerCase(),E=fe(C);return e.jsx(O,{name:E})})()},`${p?.[m]||"file"}-${m}`),(()=>{const C=a&&a[m]||m.split("/").pop()||m,E=C.length>10?C.slice(0,10)+"…":C,k=a&&a[m]&&a[m].startsWith("*")?"tab-title tab-unsaved":"tab-title";return e.jsx("span",{title:u?.[m]||C,className:k,style:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:120},children:E})})()]})},m))}),b!==null&&(()=>{const m=t[b];if(!m)return null;const I=j.current,C=x.current;let E={position:"absolute",right:8,top:40,padding:8,display:"flex",flexDirection:"column",gap:6};try{const k=C?.querySelectorAll(".tab-item"),M=k?k[b]:null;if(M&&I){const X=I.getBoundingClientRect(),Y=M.getBoundingClientRect();E={position:"absolute",left:Y.left-X.left,top:Y.bottom-X.top+6,padding:8,display:"flex",flexDirection:"column",gap:6}}}catch{}return e.jsxs("div",{className:"dropdown",style:E,children:[e.jsx("button",{ref:k=>{k&&k.focus()},className:"link",onClick:()=>{o?.(m),T(null)},children:"Close"}),e.jsx("button",{className:"link",onClick:()=>{l?.(m),T(null)},children:"Close Others"}),e.jsx("button",{className:"link",onClick:()=>{d?.(m),T(null)},children:"Close Left"})]})})(),P&&e.jsx("button",{className:"tab-scroll tab-scroll-right","aria-label":"scroll right",onClick:()=>K(200),children:"▶"})]})}function _t({visible:t=!0,onClose:s}){const[,i]=r.useState(0);if(r.useEffect(()=>ct(()=>i(a=>a+1)),[]),!t)return null;const o=lt().slice(0,100);function l(d){const a=[],u=/([\w\/\.\-]+:\d+)/g;let p=0,w;for(;(w=u.exec(d))!==null;)w.index>p&&a.push({text:d.slice(p,w.index)}),a.push({text:w[0],cls:"log-path"}),p=w.index+w[0].length;return p<d.length&&a.push({text:d.slice(p)}),a.map((L,b)=>L.cls?e.jsx("span",{className:L.cls,children:L.text},b):e.jsx("span",{children:L.text},b))}return e.jsxs("div",{className:"log-overlay",children:[e.jsxs("div",{className:"log-header",children:[e.jsx("strong",{children:"Logs"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn",onClick:()=>dt(),children:"Clear"}),e.jsx("button",{className:"btn",onClick:()=>s&&s(),style:{marginLeft:8},children:"Close"})]})]}),e.jsx("div",{children:o.map((d,a)=>e.jsxs("div",{className:`log-entry log-level-${(d.level||"").toLowerCase()}`,children:[e.jsxs("div",{className:"log-meta",children:[d.ts," ",e.jsx("span",{className:"log-level",children:d.level})]}),e.jsx("div",{className:"log-message",children:l(d.msg)})]},a))})]})}async function Dt(t,s="mlcremote-screenshot.png"){const i=await rt(t,{backgroundColor:null,scale:2});return new Promise(o=>{i.toBlob(l=>{if(!l){o();return}const d=URL.createObjectURL(l),a=document.createElement("a");a.href=d,a.download=s,document.body.appendChild(a),a.click(),a.remove(),URL.revokeObjectURL(d),o()},"image/png")})}class Rt{prefix;constructor(s=""){this.prefix=s}key(s){return`${this.prefix}${s}`}get(s,i,o=null){try{const l=localStorage.getItem(this.key(s)),d=i.read(l);return d===null?o:d}catch{return o}}getOrDefault(s,i,o){const l=this.get(s,i,null);return l===null?o:l}set(s,i,o){try{localStorage.setItem(this.key(s),o.write(i))}catch{}}remove(s){try{localStorage.removeItem(this.key(s))}catch{}}}const Ne={read:t=>t===null?null:t,write:t=>String(t)},V={read:t=>t===null?null:t==="1"||t==="true",write:t=>t?"1":"0"},F=new Rt("mlc:"),$t=r.lazy(()=>pe(()=>import("./TerminalTab-DGW3NDWv.js"),__vite__mapDeps([9,1,2,3,4,6,7,5])));function Ot(){const[t,s]=r.useState(null),[i,o]=r.useState(null),[l,d]=r.useState(""),[a,u]=r.useState(""),p=r.useCallback(n=>u(n),[]),[w,L]=r.useState(0),[b,T]=r.useState(!0),[j,x]=r.useState([]),[z,ie]=r.useState([]),[P,y]=r.useState(""),[Q,H]=r.useState(null),[te,ee]=r.useState(()=>F.getOrDefault("autoOpen",V,!0)),G=n=>{ee(n),F.set("autoOpen",n,V)},K=8;function m(n){x(f=>{if(f.includes(n))return f;const g=[...f,n];if(g.length<=K)return g;const c=g[0];try{ie(v=>v.includes(c)?v:[...v,c])}catch{}return g.slice(1)}),y(n),ae(n).then(f=>{_e(g=>({...g,[n]:f}))}).catch(()=>{})}const[I,C]=r.useState({}),[E,k]=r.useState(()=>F.getOrDefault("showHidden",V,!1)),M=n=>{k(n),F.set("showHidden",n,V)},[X,Y]=r.useState(!1),[se,h]=r.useState(()=>F.getOrDefault("showLogs",V,!1)),[N,_]=r.useState(!1),[D,W]=r.useState(!1),[q,ve]=r.useState(()=>F.getOrDefault("hideServerName",V,!1)),[xe,we]=r.useState(()=>F.getOrDefault("hideMemoryUsage",V,!1)),[S,R]=r.useState(!1),[U,J]=r.useState(null),[ce,Ve]=r.useState(300),[ye,Ge]=r.useState(()=>F.getOrDefault("theme",Ne,"dark")),[Ke,Xe]=r.useState(new Date),[ne,Le]=r.useState(navigator.onLine),[Ye,zt]=r.useState({}),[Te,Ie]=r.useState(()=>{try{return ht()?Date.now():0}catch{return 0}}),[Je,Ze]=r.useState({}),[Pt,_e]=r.useState({}),Qe=r.useCallback((n,f)=>{Ze(g=>({...g,[n]:f}))},[]),be=r.useCallback(async()=>{if(ne)try{const n=await ke();s(n),o(Date.now())}catch{s(null)}},[ne]);r.useEffect(()=>{const n=window.setInterval(()=>Xe(new Date),1e3);return()=>window.clearInterval(n)},[]),r.useEffect(()=>{let n=!0;async function f(){if(ne)try{const c=await ke();if(!n)return;s(c),o(Date.now()),await ze()||(localStorage.removeItem("mlcremote_token"),c.password_auth?De(!0):c.auth_required&&le(!0))}catch{if(!n)return;s(null)}}f();const g=setInterval(f,60*1e3);return()=>{n=!1,clearInterval(g)}},[ne]);const[Mt,De]=r.useState(!1),[et,Se]=r.useState(!1),[tt,oe]=r.useState(!1);r.useEffect(()=>{if(!t){oe(!1);return}const n=!!t.password_auth,f=!!t.auth_required&&!t.password_auth,g=localStorage.getItem("mlcremote_token");oe(!!((n||f)&&!g))},[t]),r.useEffect(()=>{const n=f=>oe(!0);return window.addEventListener("mlcremote:auth-failed",n),()=>window.removeEventListener("mlcremote:auth-failed",n)},[]),r.useEffect(()=>{try{localStorage.getItem("mlcremote_token")&&(oe(!1),Se(!1),le(!1))}catch{}},[Te]);const[st,le]=r.useState(!1);return r.useEffect(()=>{if(!t)return;const n=!!t.auth_required&&!t.password_auth,f=localStorage.getItem("mlcremote_token");le(!!(n&&!f))},[t]),r.useEffect(()=>{fetch("/api/settings").then(n=>n.json()).then(n=>{J(n),n&&typeof n.allowChangeRoot<"u"&&Y(!!n.allowChangeRoot)}).catch(()=>J({allowDelete:!1,defaultShell:"bash"}))},[]),r.useEffect(()=>{ye==="light"?document.documentElement.classList.add("theme-light"):document.documentElement.classList.remove("theme-light")},[ye]),r.useEffect(()=>{const n=()=>{Le(!0),ke().then(async g=>{s(g),o(Date.now()),await ze()||(localStorage.removeItem("mlcremote_token"),g.password_auth?De(!0):g.auth_required&&le(!0))}).catch(()=>{s(null)})},f=()=>{Le(!1),s(null)};return window.addEventListener("online",n),window.addEventListener("offline",f),()=>{window.removeEventListener("online",n),window.removeEventListener("offline",f)}},[]),e.jsxs("div",{className:"app",children:[e.jsxs("header",{className:"app-header",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("img",{src:"/logo.png",alt:"MLCRemote logo",style:{height:28,display:"block"},onLoad:()=>T(!0),onError:()=>T(!1)}),!b&&e.jsx("h1",{style:{margin:0},children:"MLCRemote"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginLeft:8},children:[e.jsx("span",{style:{width:10,height:10,borderRadius:6,background:t&&t.host?"#10b981":ne?"#f59e0b":"#ef4444",display:"inline-block"}}),!q&&e.jsx("button",{className:"link icon-btn",style:{marginLeft:0,fontSize:12,padding:0},onClick:()=>_(!0),children:t&&t.host?t.host:ne?"connecting...":"browser offline"})]})]}),e.jsxs("div",{className:"status",children:[e.jsxs("span",{style:{display:"flex",alignItems:"center",gap:8},children:[!ne&&e.jsx("span",{className:t?"badge badge-ok":"badge badge-error",children:ne?"":"offline"}),e.jsx("div",{style:{display:"inline-flex",alignItems:"center",gap:8},children:t&&t.server_time&&null})]}),!xe&&t&&t.sys_mem_total_bytes?(()=>{const n=t.sys_mem_total_bytes||1,f=t.sys_mem_free_bytes||0,g=n-f,c=Math.round(g/n*100);return e.jsxs("div",{style:{marginLeft:8,display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:120,height:10,background:"rgba(255,255,255,0.06)",borderRadius:6,border:"1px solid rgba(0,0,0,0.12)",overflow:"hidden"},children:e.jsx("div",{style:{width:`${c}%`,height:"100%",background:c>80?"#e11d48":"#10b981",borderRadius:6,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.06)"}})}),e.jsxs("div",{className:"muted",style:{fontSize:12},title:`Memory usage: ${re(g)} / ${re(n)} (${c}%)`,children:[c,"%"]})]})})():null,e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("div",{className:"muted",style:{fontSize:12},children:new Intl.DateTimeFormat(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}).format(Ke)}),e.jsx("button",{className:"link icon-btn",onClick:async()=>{let n=l||"";try{if(n){const c=await ae(n);if(!c.isDir&&c.path){const v=c.path.split("/").filter(Boolean);v.pop(),n=v.length?`/${v.join("/")}`:""}}else if(P&&!P.startsWith("shell-"))try{const c=await ae(P);if(c.isDir)n=c.path||P;else if(c.path){const v=c.path.split("/").filter(Boolean);v.pop(),n=v.length?`/${v.join("/")}`:""}}catch{const v=P.split("/").filter(Boolean);v.pop(),n=v.length?`/${v.join("/")}`:""}}catch{}const f=`shell-${Date.now()}`;let g=n||"";if(g&&g.split("/").pop()?.includes(".")){const c=g.split("/").filter(Boolean);c.pop(),g=c.length?`/${c.join("/")}`:"/"}C(c=>({...c,[f]:g})),m(f)},title:"Open shell","aria-label":"Open shell",children:e.jsx(O,{name:A("terminal"),title:"Open shell",size:16})})]}),e.jsx("button",{className:"link icon-btn","aria-label":"Toggle theme",onClick:()=>{const n=ye==="dark"?"light":"dark";Ge(n),F.set("theme",n,Ne),n==="light"?document.documentElement.classList.add("theme-light"):document.documentElement.classList.remove("theme-light")},children:ye==="dark"?e.jsx(O,{name:A("moon"),title:"Dark theme",size:16}):e.jsx(O,{name:A("sun"),title:"Light theme",size:16})}),e.jsx("button",{className:"link icon-btn",title:"About","aria-label":"About",onClick:()=>_(!0),children:e.jsx(O,{name:A("info"),title:"About",size:16})}),e.jsx("button",{className:"link icon-btn ",title:"Screenshot","aria-label":"Screenshot",onClick:async()=>{const n=document.querySelector(".app");if(n)try{await Dt(n,"mlcremote-screenshot.png")}catch(f){console.error("Screenshot failed",f)}},children:e.jsx(O,{name:A("screenshot"),title:"Screenshot",size:16})}),e.jsx("button",{className:"link icon-btn","aria-label":"Open settings",title:"Settings",onClick:()=>W(n=>!n),children:e.jsx(O,{name:A("settings"),title:"Settings",size:16})}),e.jsx("button",{className:"link icon-btn",title:"Trash","aria-label":"Trash",onClick:()=>{j.includes("trash")||m("trash"),y("trash")},children:e.jsx(O,{name:"icon-trash",title:"Trash",size:16})})]}),D&&e.jsx(xt,{autoOpen:te,showHidden:E,onToggleAutoOpen:n=>G(n),onToggleShowHidden:n=>M(n),showLogs:se,onToggleLogs:n=>{h(n),F.set("showLogs",n,V)},hideServerName:q,onToggleHideServerName:n=>{ve(n),F.set("hideServerName",n,V)},hideMemoryUsage:xe,onToggleHideMemoryUsage:n=>{we(n),F.set("hideMemoryUsage",n,V)},onClose:()=>W(!1)})]}),e.jsxs("div",{className:"app-body",style:{alignItems:"stretch"},children:[e.jsx("aside",{className:"sidebar",style:{width:ce},children:e.jsx(gt,{showHidden:E,autoOpen:te,onToggleHidden:n=>M(n),selectedPath:l,activeDir:a,onDirChange:p,focusRequest:w,reloadSignal:Te,onSelect:(n,f)=>{if(d(n),f){y(n);return}(async()=>{try{const g=await ae(n);if(!g.isDir&&g.mime&&!g.mime.startsWith("text/")&&!g.mime.startsWith("image/")&&g.mime!=="application/pdf"){j.includes("binary")||m("binary"),H(n),y("binary");return}}catch{}te?m(n):y(n)})(),be()},onView:n=>{j.includes(n)?y(n):m(n),d(n),be()},onBackendActive:be,onChangeRoot:async()=>{if(!X){alert("Changing root is not permitted by the server settings");return}const n=window.prompt("Enter the server directory path to use as new root (e.g. /home/user/project):",l||"/");if(!n)return;const f=n.trim();try{if(!(await ae(f)).isDir){alert("Selected path is not a directory");return}d(f);try{F.set("lastRoot",f,Ne)}catch{}try{const c=F.getOrDefault("showHidden",V,!1);F.set("showHidden",c,V)}catch{}}catch(g){alert("Cannot access selected path: "+(g?.message||g))}}})}),e.jsx("div",{className:"resizer",onMouseDown:n=>{const f=n.clientX,g=ce;function c($){const de=$.clientX-f;Ve(Math.max(160,Math.min(800,g+de)))}function v(){window.removeEventListener("mousemove",c),window.removeEventListener("mouseup",v)}window.addEventListener("mousemove",c),window.addEventListener("mouseup",v)},children:e.jsx("div",{className:"bar"})}),e.jsx("main",{className:"main",children:e.jsxs("div",{className:"main-content",children:[tt&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Not Authenticated"}),e.jsx("p",{children:"You need to sign in or provide an access key to continue."}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{className:"btn",onClick:()=>{oe(!1),Se(!0)},children:"Sign in (password)"}),e.jsx("button",{className:"btn",onClick:()=>{oe(!1),le(!0)},children:"I have an access key"})]})]})}),et&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Sign in"}),e.jsx("p",{children:"Please enter the server password to obtain an access token."}),e.jsx("input",{id:"mlc-login-pwd",type:"password",placeholder:"Password"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"btn",onClick:async()=>{const n=document.getElementById("mlc-login-pwd");if(n)try{const f=await ut(n.value);console.log("login token",f),Se(!1),Ie(Date.now())}catch(f){alert("Login failed: "+(f?.message||f))}},children:"Sign in"})})]})}),st&&e.jsx("div",{className:"login-overlay",children:e.jsxs("div",{className:"login-box",children:[e.jsx("h3",{children:"Enter Access Token"}),e.jsx("p",{children:"The server requires an access token. Paste it here to continue."}),e.jsx("input",{id:"mlc-token-input",type:"text",placeholder:"token"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("button",{className:"btn",onClick:async()=>{const n=document.getElementById("mlc-token-input");if(n)try{localStorage.setItem("mlcremote_token",n.value.trim()),le(!1),Ie(Date.now())}catch(f){alert("Failed to store token: "+(f?.message||f))}},children:"Use token"})})]})}),e.jsx("div",{}),j.length>0&&e.jsx("div",{children:e.jsx(r.Suspense,{fallback:null,children:(()=>{const n={};for(const c of j)if(c.startsWith("shell-")){const $=(I[c]||""||"/").split("/").filter(Boolean);let de="/";if($.length){const Re=$[$.length-1];Re.includes(".")&&$.length>1?de=$[$.length-2]:de=Re}n[c]=de}else{const v=c.split("/").pop()||c;n[c]=Je[c]?`*${v}`:v}const f={},g={};for(const c of j)c.startsWith("shell-")?(f[c]="shell",g[c]=I[c]||"/"):(f[c]="file",g[c]=c);return e.jsx(It,{openFiles:j,active:P,titles:n,fullPaths:g,types:f,onRestoreEvicted:c=>{x(v=>v.includes(c)?v:[c,...v].slice(0,K)),y(c),d(c),L(Date.now())},onActivate:c=>{if(c&&!c.startsWith("shell-")){const v=c.split("/").filter(Boolean);v.pop();const $=v.length?`/${v.join("/")}`:"";$!==a&&u($)}d(c),L(Date.now()),y(c)},onClose:c=>{x(v=>v.filter($=>$!==c)),P===c&&y(j.filter(v=>v!==c)[0]||"")},onCloseOthers:c=>{x(v=>v.filter($=>$===c||$===P))},onCloseLeft:c=>{x(v=>{const $=v.indexOf(c);return $<=0?v:v.slice($)})}})})()})}),j.map(n=>e.jsx("div",{style:{display:n===P?"block":"none",height:"100%"},children:n.startsWith("shell-")?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading terminal…"}),children:e.jsx($t,{shell:U&&U.defaultShell||"bash",path:I[n]||"",onExit:()=>{x(f=>f.filter(g=>g!==n)),P===n&&y(j.filter(f=>f!==n)[0]||""),C(f=>{const g={...f};return delete g[n],g})}},n)}):n==="trash"?e.jsx(yt,{}):n==="binary"?e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"muted",children:"Loading…"}),children:e.jsx(Tt,{path:Q||void 0})}):e.jsx(Lt,{path:n,settings:U||void 0,onSaved:()=>{},reloadTrigger:Ye[n]||0,onUnsavedChange:Qe,onMeta:f=>{f&&f.path&&_e(g=>({...g,[n]:f}))}})},n)),j.length===0&&e.jsxs("div",{className:"welcome-message",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-muted)",fontSize:"18px",textAlign:"center",padding:"20px"},children:[e.jsx("div",{style:{fontSize:"48px",marginBottom:"20px"},children:e.jsx(O,{name:A("folder"),size:48})}),e.jsx("div",{children:"Welcome to MLCRemote"}),e.jsx("div",{style:{fontSize:"14px",marginTop:"10px"},children:"Select a file from the explorer to start editing"})]})]})})]}),e.jsx(_t,{visible:se,onClose:()=>h(!1)}),N&&e.jsx("div",{className:"about-backdrop",onClick:()=>_(!1),children:e.jsxs("div",{className:"about-modal",onClick:n=>n.stopPropagation(),children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{margin:0},children:"MLCRemote"}),e.jsx("button",{"aria-label":"Close about",title:"Close",onClick:()=>_(!1),style:{background:"transparent",border:"none",cursor:"pointer"},children:e.jsx(O,{name:"icon-close",size:16})})]}),e.jsxs("div",{style:{marginBottom:8},children:["Copyright © ",new Date().getFullYear()," Michael Lechner"]}),e.jsxs("div",{style:{marginBottom:8},children:["Version: ",t?`${t.status}@${t.version}`:"unknown"]}),t&&e.jsxs("div",{style:{maxHeight:"40vh",overflow:"auto",background:"#0b0b0b",color:"white",padding:12,borderRadius:6},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Host:"})," ",t.host]}),e.jsxs("div",{children:[e.jsx("strong",{children:"PID:"})," ",t.pid]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Version:"})," ",t.version]}),e.jsxs("div",{children:[e.jsx("strong",{children:"App Memory:"})," ",re(t.go_alloc_bytes)," (alloc) / ",re(t.go_sys_bytes)," (sys)"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"System Memory:"})," ",re((t.sys_mem_total_bytes||0)-(t.sys_mem_free_bytes||0))," / ",re(t.sys_mem_total_bytes||0)," used"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"CPU:"})," ",Math.round((t.cpu_percent||0)*10)/10,"%"]}),e.jsxs("div",{style:{marginTop:8},children:[e.jsx("strong",{children:"Server time:"})," ",t.server_time]}),e.jsxs("div",{style:{marginTop:4},children:[e.jsx("strong",{children:"Timezone:"})," ",t.timezone]}),e.jsxs("div",{className:"muted",style:{marginTop:8,fontSize:12},children:["Last refresh: ",i?new Date(i).toLocaleString():"n/a"]})]})]})})]})}(async()=>{try{const t=await pe(()=>import("./icons-sprite-DMD419kj.js"),[]),s=t&&(t.default||t);if(s&&typeof document<"u"){const i=document.createElement("div");i.style.width="0",i.style.height="0",i.style.position="absolute",i.style.visibility="hidden",i.innerHTML=s,document.body.insertBefore(i,document.body.firstChild)}}catch{}})();nt.createRoot(document.getElementById("root")).render(e.jsx(Ot,{}));export{pe as _,Z as a,ae as s};
